85a77e258ed5b044f676dc1cc6e7f4c2
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty3 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = useNavigationCache;

var React = _interopRequireWildcard(require("react"));

var _routers = require("@react-navigation/routers");

var _NavigationContext = _interopRequireDefault(require("./NavigationContext"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function _getRequireWildcardCache() {
  if (typeof WeakMap !== "function") return null;
  var cache = new WeakMap();

  _getRequireWildcardCache = function _getRequireWildcardCache() {
    return cache;
  };

  return cache;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  }

  if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
    return {
      default: obj
    };
  }

  var cache = _getRequireWildcardCache();

  if (cache && cache.has(obj)) {
    return cache.get(obj);
  }

  var newObj = {};
  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;

  for (var key in obj) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;

      if (desc && (desc.get || desc.set)) {
        Object.defineProperty(newObj, key, desc);
      } else {
        newObj[key] = obj[key];
      }
    }
  }

  newObj.default = obj;

  if (cache) {
    cache.set(obj, newObj);
  }

  return newObj;
}

function _objectWithoutProperties(source, excluded) {
  if (source == null) return {};

  var target = _objectWithoutPropertiesLoose(source, excluded);

  var key, i;

  if (Object.getOwnPropertySymbols) {
    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);

    for (i = 0; i < sourceSymbolKeys.length; i++) {
      key = sourceSymbolKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
      target[key] = source[key];
    }
  }

  return target;
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function useNavigationCache(_ref) {
  var state = _ref.state,
      getState = _ref.getState,
      navigation = _ref.navigation,
      _setOptions = _ref.setOptions,
      router = _ref.router,
      emitter = _ref.emitter;
  var parentNavigation = React.useContext(_NavigationContext.default);
  var cache = React.useMemo(function () {
    return {
      current: {}
    };
  }, [getState, navigation, _setOptions, router, emitter, parentNavigation]);

  var actions = _objectSpread({}, router.actionCreators, {}, _routers.CommonActions);

  cache.current = state.routes.reduce(function (acc, route, index) {
    var previous = cache.current[route.key];

    if (previous) {
      acc[route.key] = previous;
    } else {
      var emit = navigation.emit,
          rest = _objectWithoutProperties(navigation, ["emit"]);

      var dispatch = function dispatch(action) {
        var payload = typeof action === 'function' ? action(getState()) : action;
        navigation.dispatch(typeof payload === 'object' && payload != null ? _objectSpread({
          source: route.key
        }, payload) : payload);
      };

      var helpers = Object.keys(actions).reduce(function (acc, name) {
        acc[name] = function () {
          return dispatch(actions[name].apply(actions, arguments));
        };

        return acc;
      }, {});
      acc[route.key] = _objectSpread({}, rest, {}, helpers, {}, emitter.create(route.key), {
        dangerouslyGetParent: function dangerouslyGetParent() {
          return parentNavigation;
        },
        dangerouslyGetState: getState,
        dispatch: dispatch,
        setOptions: function setOptions(options) {
          return _setOptions(function (o) {
            return _objectSpread({}, o, (0, _defineProperty3.default)({}, route.key, _objectSpread({}, o[route.key], {}, options)));
          });
        },
        isFocused: function isFocused() {
          var state = getState();

          if (index !== state.index) {
            return false;
          }

          return navigation ? navigation.isFocused() : true;
        }
      });
    }

    return acc;
  }, {});
  return cache.current;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZU5hdmlnYXRpb25DYWNoZS50c3giXSwibmFtZXMiOlsic2V0T3B0aW9ucyIsImVtaXR0ZXIiLCJwYXJlbnROYXZpZ2F0aW9uIiwiUmVhY3QiLCJOYXZpZ2F0aW9uQ29udGV4dCIsImNhY2hlIiwiY3VycmVudCIsImFjdGlvbnMiLCJyb3V0ZXIiLCJDb21tb25BY3Rpb25zIiwicHJldmlvdXMiLCJyb3V0ZSIsImFjYyIsImVtaXQiLCJkaXNwYXRjaCIsImFjdGlvbiIsInBheWxvYWQiLCJnZXRTdGF0ZSIsIm5hdmlnYXRpb24iLCJzb3VyY2UiLCJrZXkiLCJoZWxwZXJzIiwiZGFuZ2Vyb3VzbHlHZXRQYXJlbnQiLCJkYW5nZXJvdXNseUdldFN0YXRlIiwib3B0aW9ucyIsIm8iLCJpc0ZvY3VzZWQiLCJzdGF0ZSIsImluZGV4Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLElBQUEsS0FBQSxHQUFBLHVCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLE9BQUEsQ0FBQSwyQkFBQSxDQUFBOztBQVFBLElBQUEsa0JBQUEsR0FBQSxzQkFBQSxDQUFBLE9BQUEsdUJBQUEsQ0FBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCZSxTQUFBLGtCQUFBLENBQUEsSUFBQSxFQVVJO0FBQUEsTUFQakIsS0FPaUIsR0FBQSxJQUFBLENBUGpCLEtBT2lCO0FBQUEsTUFQakIsUUFPaUIsR0FBQSxJQUFBLENBUGpCLFFBT2lCO0FBQUEsTUFQakIsVUFPaUIsR0FBQSxJQUFBLENBUGpCLFVBT2lCO0FBQUEsTUFQakIsV0FPaUIsR0FBQSxJQUFBLENBSGpCQSxVQUdpQjtBQUFBLE1BUGpCLE1BT2lC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LENBQUNkLEtBQUssQ0FBekIsR0FBbUIsQ0FBbkIsRUFBQSxFQUFBLEVBQUEsT0FBQSxDQUZVLEVBQUE7QUFBQSxXQUFGLENBREE7QUFBQSxTQVBkQztBQVlFYyxRQUFBQSxTQUFTLEVBQUUscUJBQU07QUFDZixjQUFNQyxLQUFLLEdBQUdWLFFBQWQsRUFBQTs7QUFFQSxjQUFJVyxLQUFLLEtBQUtELEtBQUssQ0FBbkIsS0FBQSxFQUEyQjtBQUN6QixtQkFBQSxLQUFBO0FBSmE7O0FBU2YsaUJBQU9ULFVBQVUsR0FBR0EsVUFBVSxDQUFiLFNBQUdBLEVBQUgsR0FBakIsSUFBQTtBQUNEO0FBdEJITixPQUFBQSxDQUFBQTtBQXdCRDs7QUFFRCxXQUFBLEdBQUE7QUEzRFksR0FBQSxFQUFoQlAsRUFBZ0IsQ0FBaEJBO0FBZ0VBLFNBQU9BLEtBQUssQ0FBWixPQUFBO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBDb21tb25BY3Rpb25zLFxuICBOYXZpZ2F0aW9uQWN0aW9uLFxuICBQYXJhbUxpc3RCYXNlLFxuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIFJvdXRlcixcbn0gZnJvbSAnQHJlYWN0LW5hdmlnYXRpb24vcm91dGVycyc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uRXZlbnRFbWl0dGVyIH0gZnJvbSAnLi91c2VFdmVudEVtaXR0ZXInO1xuaW1wb3J0IE5hdmlnYXRpb25Db250ZXh0IGZyb20gJy4vTmF2aWdhdGlvbkNvbnRleHQnO1xuXG5pbXBvcnQgeyBOYXZpZ2F0aW9uSGVscGVycywgTmF2aWdhdGlvblByb3AgfSBmcm9tICcuL3R5cGVzJztcblxudHlwZSBPcHRpb25zPFN0YXRlIGV4dGVuZHMgTmF2aWdhdGlvblN0YXRlPiA9IHtcbiAgc3RhdGU6IFN0YXRlO1xuICBnZXRTdGF0ZTogKCkgPT4gU3RhdGU7XG4gIG5hdmlnYXRpb246IE5hdmlnYXRpb25IZWxwZXJzPFBhcmFtTGlzdEJhc2U+ICZcbiAgICBQYXJ0aWFsPE5hdmlnYXRpb25Qcm9wPFBhcmFtTGlzdEJhc2UsIHN0cmluZywgYW55LCBhbnksIGFueT4+O1xuICBzZXRPcHRpb25zOiAoXG4gICAgY2I6IChvcHRpb25zOiBSZWNvcmQ8c3RyaW5nLCBvYmplY3Q+KSA9PiBSZWNvcmQ8c3RyaW5nLCBvYmplY3Q+XG4gICkgPT4gdm9pZDtcbiAgcm91dGVyOiBSb3V0ZXI8U3RhdGUsIE5hdmlnYXRpb25BY3Rpb24+O1xuICBlbWl0dGVyOiBOYXZpZ2F0aW9uRXZlbnRFbWl0dGVyO1xufTtcblxudHlwZSBOYXZpZ2F0aW9uQ2FjaGU8XG4gIFN0YXRlIGV4dGVuZHMgTmF2aWdhdGlvblN0YXRlLFxuICBTY3JlZW5PcHRpb25zIGV4dGVuZHMgb2JqZWN0XG4+ID0ge1xuICBba2V5OiBzdHJpbmddOiBOYXZpZ2F0aW9uUHJvcDxQYXJhbUxpc3RCYXNlLCBzdHJpbmcsIFN0YXRlLCBTY3JlZW5PcHRpb25zPjtcbn07XG5cbi8qKlxuICogSG9vayB0byBjYWNoZSBuYXZpZ2F0aW9uIG9iamVjdHMgZm9yIGVhY2ggc2NyZWVuIGluIHRoZSBuYXZpZ2F0b3IuXG4gKiBJdCdzIGltcG9ydGFudCB0byBjYWNoZSB0aGVtIHRvIG1ha2Ugc3VyZSBuYXZpZ2F0aW9uIG9iamVjdHMgZG9uJ3QgY2hhbmdlIGJldHdlZW4gcmVuZGVycy5cbiAqIFRoaXMgbGV0cyB1cyBhcHBseSBvcHRpbWl6YXRpb25zIGxpa2UgYFJlYWN0Lm1lbW9gIHRvIG1pbmltaXplIHJlLXJlbmRlcmluZyBzY3JlZW5zLlxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB1c2VOYXZpZ2F0aW9uQ2FjaGU8XG4gIFN0YXRlIGV4dGVuZHMgTmF2aWdhdGlvblN0YXRlLFxuICBTY3JlZW5PcHRpb25zIGV4dGVuZHMgb2JqZWN0XG4+KHtcbiAgc3RhdGUsXG4gIGdldFN0YXRlLFxuICBuYXZpZ2F0aW9uLFxuICBzZXRPcHRpb25zLFxuICByb3V0ZXIsXG4gIGVtaXR0ZXIsXG59OiBPcHRpb25zPFN0YXRlPikge1xuICAvLyBDYWNoZSBvYmplY3Qgd2hpY2ggaG9sZHMgbmF2aWdhdGlvbiBvYmplY3RzIGZvciBlYWNoIHNjcmVlblxuICAvLyBXZSB1c2UgYFJlYWN0LnVzZU1lbW9gIGluc3RlYWQgb2YgYFJlYWN0LnVzZVJlZmAgY296IHdlIHdhbnQgdG8gaW52YWxpZGF0ZSBpdCB3aGVuIGRlcHMgY2hhbmdlXG4gIC8vIEluIHJlYWxpdHksIHRoZXNlIGRlcHMgd2lsbCByYXJlbHkgY2hhbmdlLCBpZiBldmVyXG4gIGNvbnN0IHBhcmVudE5hdmlnYXRpb24gPSBSZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KTtcblxuICBjb25zdCBjYWNoZSA9IFJlYWN0LnVzZU1lbW8oXG4gICAgKCkgPT4gKHsgY3VycmVudDoge30gYXMgTmF2aWdhdGlvbkNhY2hlPFN0YXRlLCBTY3JlZW5PcHRpb25zPiB9KSxcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgW2dldFN0YXRlLCBuYXZpZ2F0aW9uLCBzZXRPcHRpb25zLCByb3V0ZXIsIGVtaXR0ZXIsIHBhcmVudE5hdmlnYXRpb25dXG4gICk7XG5cbiAgY29uc3QgYWN0aW9ucyA9IHtcbiAgICAuLi5yb3V0ZXIuYWN0aW9uQ3JlYXRvcnMsXG4gICAgLi4uQ29tbW9uQWN0aW9ucyxcbiAgfTtcblxuICBjYWNoZS5jdXJyZW50ID0gc3RhdGUucm91dGVzLnJlZHVjZTxOYXZpZ2F0aW9uQ2FjaGU8U3RhdGUsIFNjcmVlbk9wdGlvbnM+PihcbiAgICAoYWNjLCByb3V0ZSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHByZXZpb3VzID0gY2FjaGUuY3VycmVudFtyb3V0ZS5rZXldO1xuXG4gICAgICBpZiAocHJldmlvdXMpIHtcbiAgICAgICAgLy8gSWYgYSBjYWNoZWQgbmF2aWdhdGlvbiBvYmplY3QgYWxyZWFkeSBleGlzdHMsIHJldXNlIGl0XG4gICAgICAgIGFjY1tyb3V0ZS5rZXldID0gcHJldmlvdXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgICAgIGNvbnN0IHsgZW1pdCwgLi4ucmVzdCB9ID0gbmF2aWdhdGlvbjtcblxuICAgICAgICBjb25zdCBkaXNwYXRjaCA9IChcbiAgICAgICAgICBhY3Rpb246IE5hdmlnYXRpb25BY3Rpb24gfCAoKHN0YXRlOiBTdGF0ZSkgPT4gTmF2aWdhdGlvbkFjdGlvbilcbiAgICAgICAgKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGF5bG9hZCA9XG4gICAgICAgICAgICB0eXBlb2YgYWN0aW9uID09PSAnZnVuY3Rpb24nID8gYWN0aW9uKGdldFN0YXRlKCkpIDogYWN0aW9uO1xuXG4gICAgICAgICAgbmF2aWdhdGlvbi5kaXNwYXRjaChcbiAgICAgICAgICAgIHR5cGVvZiBwYXlsb2FkID09PSAnb2JqZWN0JyAmJiBwYXlsb2FkICE9IG51bGxcbiAgICAgICAgICAgICAgPyB7IHNvdXJjZTogcm91dGUua2V5LCAuLi5wYXlsb2FkIH1cbiAgICAgICAgICAgICAgOiBwYXlsb2FkXG4gICAgICAgICAgKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBoZWxwZXJzID0gT2JqZWN0LmtleXMoYWN0aW9ucykucmVkdWNlPFJlY29yZDxzdHJpbmcsICgpID0+IHZvaWQ+PihcbiAgICAgICAgICAoYWNjLCBuYW1lKSA9PiB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBhY2NbbmFtZV0gPSAoLi4uYXJnczogYW55KSA9PiBkaXNwYXRjaChhY3Rpb25zW25hbWVdKC4uLmFyZ3MpKTtcbiAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7fVxuICAgICAgICApO1xuXG4gICAgICAgIGFjY1tyb3V0ZS5rZXldID0ge1xuICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgLi4uaGVscGVycyxcbiAgICAgICAgICAuLi5lbWl0dGVyLmNyZWF0ZShyb3V0ZS5rZXkpLFxuICAgICAgICAgIGRhbmdlcm91c2x5R2V0UGFyZW50OiAoKSA9PiBwYXJlbnROYXZpZ2F0aW9uIGFzIGFueSxcbiAgICAgICAgICBkYW5nZXJvdXNseUdldFN0YXRlOiBnZXRTdGF0ZSxcbiAgICAgICAgICBkaXNwYXRjaCxcbiAgICAgICAgICBzZXRPcHRpb25zOiAob3B0aW9uczogb2JqZWN0KSA9PlxuICAgICAgICAgICAgc2V0T3B0aW9ucyhvID0+ICh7XG4gICAgICAgICAgICAgIC4uLm8sXG4gICAgICAgICAgICAgIFtyb3V0ZS5rZXldOiB7IC4uLm9bcm91dGUua2V5XSwgLi4ub3B0aW9ucyB9LFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIGlzRm9jdXNlZDogKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBnZXRTdGF0ZSgpO1xuXG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IHN0YXRlLmluZGV4KSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gSWYgdGhlIGN1cnJlbnQgc2NyZWVuIGlzIGZvY3VzZWQsIHdlIGFsc28gbmVlZCB0byBjaGVjayBpZiBwYXJlbnQgbmF2aWdhdG9yIGlzIGZvY3VzZWRcbiAgICAgICAgICAgIC8vIFRoaXMgbWFrZXMgc3VyZSB0aGF0IHdlIHJldHVybiB0aGUgZm9jdXMgc3RhdGUgaW4gdGhlIHdob2xlIHRyZWUsIG5vdCBqdXN0IHRoaXMgbmF2aWdhdG9yXG4gICAgICAgICAgICByZXR1cm4gbmF2aWdhdGlvbiA/IG5hdmlnYXRpb24uaXNGb2N1c2VkKCkgOiB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSxcbiAgICB7fVxuICApO1xuXG4gIHJldHVybiBjYWNoZS5jdXJyZW50O1xufVxuIl19