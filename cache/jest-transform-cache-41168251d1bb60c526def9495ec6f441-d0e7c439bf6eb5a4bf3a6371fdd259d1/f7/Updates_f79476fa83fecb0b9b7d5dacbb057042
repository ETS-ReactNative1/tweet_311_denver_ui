98d15c3a8907387d7f15487fd66c859f
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.reload = reload;
exports.reloadFromCache = reloadFromCache;
exports.checkForUpdateAsync = checkForUpdateAsync;
exports.fetchUpdateAsync = fetchUpdateAsync;
exports.clearUpdateCacheExperimentalAsync = clearUpdateCacheExperimentalAsync;
exports.addListener = addListener;
exports.EventType = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _core = require("@unimodules/core");

var _fbemitter = require("fbemitter");

var _ExponentUpdates = _interopRequireDefault(require("./ExponentUpdates"));

function reload() {
  return _regenerator.default.async(function reload$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          _context.next = 2;
          return _regenerator.default.awrap(_ExponentUpdates.default.reload());

        case 2:
        case "end":
          return _context.stop();
      }
    }
  });
}

function reloadFromCache() {
  return _regenerator.default.async(function reloadFromCache$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          _context2.next = 2;
          return _regenerator.default.awrap(_ExponentUpdates.default.reloadFromCache());

        case 2:
        case "end":
          return _context2.stop();
      }
    }
  });
}

function checkForUpdateAsync() {
  var result;
  return _regenerator.default.async(function checkForUpdateAsync$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          if (_ExponentUpdates.default.checkForUpdateAsync) {
            _context3.next = 2;
            break;
          }

          throw new _core.UnavailabilityError('Updates', 'checkForUpdateAsync');

        case 2:
          _context3.next = 4;
          return _regenerator.default.awrap(_ExponentUpdates.default.checkForUpdateAsync());

        case 4:
          result = _context3.sent;

          if (result) {
            _context3.next = 7;
            break;
          }

          return _context3.abrupt("return", {
            isAvailable: false
          });

        case 7:
          return _context3.abrupt("return", {
            isAvailable: true,
            manifest: typeof result === 'string' ? JSON.parse(result) : result
          });

        case 8:
        case "end":
          return _context3.stop();
      }
    }
  });
}

function fetchUpdateAsync() {
  var _ref,
      eventListener,
      subscription,
      result,
      _args4 = arguments;

  return _regenerator.default.async(function fetchUpdateAsync$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          _ref = _args4.length > 0 && _args4[0] !== undefined ? _args4[0] : {}, eventListener = _ref.eventListener;

          if (_ExponentUpdates.default.fetchUpdateAsync) {
            _context4.next = 3;
            break;
          }

          throw new _core.UnavailabilityError('Updates', 'fetchUpdateAsync');

        case 3:
          if (eventListener && typeof eventListener === 'function') {
            subscription = addListener(eventListener);
          }

          _context4.prev = 4;
          _context4.next = 7;
          return _regenerator.default.awrap(_ExponentUpdates.default.fetchUpdateAsync());

        case 7:
          result = _context4.sent;

        case 8:
          _context4.prev = 8;
          subscription && subscription.remove();
          return _context4.finish(8);

        case 11:
          if (result) {
            _context4.next = 13;
            break;
          }

          return _context4.abrupt("return", {
            isNew: false
          });

        case 13:
          return _context4.abrupt("return", {
            isNew: true,
            manifest: typeof result === 'string' ? JSON.parse(result) : result
          });

        case 14:
        case "end":
          return _context4.stop();
      }
    }
  }, null, null, [[4,, 8, 11]]);
}

function clearUpdateCacheExperimentalAsync(abiVersion) {
  return _regenerator.default.async(function clearUpdateCacheExperimentalAsync$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          if (_ExponentUpdates.default.clearUpdateCacheAsync) {
            _context5.next = 2;
            break;
          }

          throw new _core.UnavailabilityError('Updates', 'clearUpdateCacheAsync');

        case 2:
          return _context5.abrupt("return", _ExponentUpdates.default.clearUpdateCacheAsync(abiVersion));

        case 3:
        case "end":
          return _context5.stop();
      }
    }
  });
}

var _emitter;

function _getEmitter() {
  if (!_emitter) {
    _emitter = new _fbemitter.EventEmitter();

    _core.RCTDeviceEventEmitter.addListener('Exponent.nativeUpdatesEvent', _emitEvent);
  }

  return _emitter;
}

function _emitEvent(params) {
  var newParams = params;

  if (typeof params === 'string') {
    newParams = JSON.parse(params);
  }

  if (newParams.manifestString) {
    newParams.manifest = JSON.parse(newParams.manifestString);
    delete newParams.manifestString;
  }

  if (!_emitter) {
    throw new Error("EventEmitter must be initialized to use from its listener");
  }

  _emitter.emit('Exponent.updatesEvent', newParams);
}

function addListener(listener) {
  var emitter = _getEmitter();

  return emitter.addListener('Exponent.updatesEvent', listener);
}

var EventType = {
  DOWNLOAD_STARTED: 'downloadStart',
  DOWNLOAD_PROGRESS: 'downloadProgress',
  DOWNLOAD_FINISHED: 'downloadFinished',
  NO_UPDATE_AVAILABLE: 'noUpdateAvailable',
  ERROR: 'error'
};
exports.EventType = EventType;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9VcGRhdGVzL1VwZGF0ZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBRUE7O0FBRUE7O0FBZU8sU0FBZSxNQUFmO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLDRDQUNDLHlCQUFnQixNQUFoQixFQUREOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQUlBLFNBQWUsZUFBZjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSw0Q0FDQyx5QkFBZ0IsZUFBaEIsRUFERDs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7QUFJQSxTQUFlLG1CQUFmO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGNBQ0EseUJBQWdCLG1CQURoQjtBQUFBO0FBQUE7QUFBQTs7QUFBQSxnQkFFRyxJQUFJLHlCQUFKLENBQXdCLFNBQXhCLEVBQW1DLHFCQUFuQyxDQUZIOztBQUFBO0FBQUE7QUFBQSw0Q0FJZ0IseUJBQWdCLG1CQUFoQixFQUpoQjs7QUFBQTtBQUlDLFVBQUEsTUFKRDs7QUFBQSxjQUtBLE1BTEE7QUFBQTtBQUFBO0FBQUE7O0FBQUEsNENBTUk7QUFBRSxZQUFBLFdBQVcsRUFBRTtBQUFmLFdBTko7O0FBQUE7QUFBQSw0Q0FTRTtBQUNMLFlBQUEsV0FBVyxFQUFFLElBRFI7QUFFTCxZQUFBLFFBQVEsRUFBRSxPQUFPLE1BQVAsS0FBa0IsUUFBbEIsR0FBNkIsSUFBSSxDQUFDLEtBQUwsQ0FBVyxNQUFYLENBQTdCLEdBQWtEO0FBRnZELFdBVEY7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBZUEsU0FBZSxnQkFBZjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSw0RUFFc0MsRUFGdEMsRUFDTCxhQURLLFFBQ0wsYUFESzs7QUFBQSxjQUdBLHlCQUFnQixnQkFIaEI7QUFBQTtBQUFBO0FBQUE7O0FBQUEsZ0JBSUcsSUFBSSx5QkFBSixDQUF3QixTQUF4QixFQUFtQyxrQkFBbkMsQ0FKSDs7QUFBQTtBQVFMLGNBQUksYUFBYSxJQUFJLE9BQU8sYUFBUCxLQUF5QixVQUE5QyxFQUEwRDtBQUN4RCxZQUFBLFlBQVksR0FBRyxXQUFXLENBQUMsYUFBRCxDQUExQjtBQUNEOztBQVZJO0FBQUE7QUFBQSw0Q0FZWSx5QkFBZ0IsZ0JBQWhCLEVBWlo7O0FBQUE7QUFZSCxVQUFBLE1BWkc7O0FBQUE7QUFBQTtBQWNILFVBQUEsWUFBWSxJQUFJLFlBQVksQ0FBQyxNQUFiLEVBQWhCO0FBZEc7O0FBQUE7QUFBQSxjQWlCQSxNQWpCQTtBQUFBO0FBQUE7QUFBQTs7QUFBQSw0Q0FrQkk7QUFBRSxZQUFBLEtBQUssRUFBRTtBQUFULFdBbEJKOztBQUFBO0FBQUEsNENBcUJFO0FBQ0wsWUFBQSxLQUFLLEVBQUUsSUFERjtBQUVMLFlBQUEsUUFBUSxFQUFFLE9BQU8sTUFBUCxLQUFrQixRQUFsQixHQUE2QixJQUFJLENBQUMsS0FBTCxDQUFXLE1BQVgsQ0FBN0IsR0FBa0Q7QUFGdkQsV0FyQkY7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBMkJBLFNBQWUsaUNBQWYsQ0FBaUQsVUFBakQ7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGNBQ0EseUJBQWdCLHFCQURoQjtBQUFBO0FBQUE7QUFBQTs7QUFBQSxnQkFFRyxJQUFJLHlCQUFKLENBQXdCLFNBQXhCLEVBQW1DLHVCQUFuQyxDQUZIOztBQUFBO0FBQUEsNENBSUUseUJBQWdCLHFCQUFoQixDQUFzQyxVQUF0QyxDQUpGOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOztBQU9QLElBQUksUUFBSjs7QUFFQSxTQUFTLFdBQVQsR0FBb0I7QUFDbEIsTUFBSSxDQUFDLFFBQUwsRUFBZTtBQUNiLElBQUEsUUFBUSxHQUFHLElBQUksdUJBQUosRUFBWDs7QUFDQSxnQ0FBc0IsV0FBdEIsQ0FBa0MsNkJBQWxDLEVBQWlFLFVBQWpFO0FBQ0Q7O0FBQ0QsU0FBTyxRQUFQO0FBQ0Q7O0FBRUQsU0FBUyxVQUFULENBQW9CLE1BQXBCLEVBQTBCO0FBQ3hCLE1BQUksU0FBUyxHQUFHLE1BQWhCOztBQUNBLE1BQUksT0FBTyxNQUFQLEtBQWtCLFFBQXRCLEVBQWdDO0FBQzlCLElBQUEsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFMLENBQVcsTUFBWCxDQUFaO0FBQ0Q7O0FBQ0QsTUFBSSxTQUFTLENBQUMsY0FBZCxFQUE4QjtBQUM1QixJQUFBLFNBQVMsQ0FBQyxRQUFWLEdBQXFCLElBQUksQ0FBQyxLQUFMLENBQVcsU0FBUyxDQUFDLGNBQXJCLENBQXJCO0FBQ0EsV0FBTyxTQUFTLENBQUMsY0FBakI7QUFDRDs7QUFFRCxNQUFJLENBQUMsUUFBTCxFQUFlO0FBQ2IsVUFBTSxJQUFJLEtBQUosNkRBQU47QUFDRDs7QUFDRCxFQUFBLFFBQVEsQ0FBQyxJQUFULENBQWMsdUJBQWQsRUFBdUMsU0FBdkM7QUFDRDs7QUFFSyxTQUFVLFdBQVYsQ0FBc0IsUUFBdEIsRUFBd0M7QUFDNUMsTUFBSSxPQUFPLEdBQUcsV0FBVyxFQUF6Qjs7QUFDQSxTQUFPLE9BQU8sQ0FBQyxXQUFSLENBQW9CLHVCQUFwQixFQUE2QyxRQUE3QyxDQUFQO0FBQ0Q7O0FBRU0sSUFBTSxTQUFTLEdBQUc7QUFDdkIsRUFBQSxnQkFBZ0IsRUFBRSxlQURLO0FBRXZCLEVBQUEsaUJBQWlCLEVBQUUsa0JBRkk7QUFHdkIsRUFBQSxpQkFBaUIsRUFBRSxrQkFISTtBQUl2QixFQUFBLG1CQUFtQixFQUFFLG1CQUpFO0FBS3ZCLEVBQUEsS0FBSyxFQUFFO0FBTGdCLENBQWxCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUkNURGV2aWNlRXZlbnRFbWl0dGVyLCBVbmF2YWlsYWJpbGl0eUVycm9yIH0gZnJvbSAnQHVuaW1vZHVsZXMvY29yZSc7XG5pbXBvcnQgQ29uc3RhbnRzIGZyb20gJ2V4cG8tY29uc3RhbnRzJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciwgRXZlbnRTdWJzY3JpcHRpb24gfSBmcm9tICdmYmVtaXR0ZXInO1xuXG5pbXBvcnQgRXhwb25lbnRVcGRhdGVzIGZyb20gJy4vRXhwb25lbnRVcGRhdGVzJztcblxudHlwZSBNYW5pZmVzdCA9IHR5cGVvZiBDb25zdGFudHMubWFuaWZlc3Q7XG5cbnR5cGUgVXBkYXRlQ2hlY2tSZXN1bHQgPSB7IGlzQXZhaWxhYmxlOiBmYWxzZSB9IHwgeyBpc0F2YWlsYWJsZTogdHJ1ZTsgbWFuaWZlc3Q6IE1hbmlmZXN0IH07XG5cbnR5cGUgVXBkYXRlRmV0Y2hSZXN1bHQgPSB7IGlzTmV3OiBmYWxzZSB9IHwgeyBpc05ldzogdHJ1ZTsgbWFuaWZlc3Q6IE1hbmlmZXN0IH07XG5cbnR5cGUgVXBkYXRlRXZlbnQgPVxuICB8IHsgdHlwZTogJ2Rvd25sb2FkU3RhcnQnIHwgJ2Rvd25sb2FkUHJvZ3Jlc3MnIHwgJ25vVXBkYXRlQXZhaWxhYmxlJyB9XG4gIHwgeyB0eXBlOiAnZG93bmxvYWRGaW5pc2hlZCc7IG1hbmlmZXN0OiBNYW5pZmVzdCB9XG4gIHwgeyB0eXBlOiAnZXJyb3InOyBtZXNzYWdlOiBzdHJpbmcgfTtcblxudHlwZSBVcGRhdGVFdmVudExpc3RlbmVyID0gKGV2ZW50OiBVcGRhdGVFdmVudCkgPT4gdm9pZDtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlbG9hZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgYXdhaXQgRXhwb25lbnRVcGRhdGVzLnJlbG9hZCgpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVsb2FkRnJvbUNhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBFeHBvbmVudFVwZGF0ZXMucmVsb2FkRnJvbUNhY2hlKCk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja0ZvclVwZGF0ZUFzeW5jKCk6IFByb21pc2U8VXBkYXRlQ2hlY2tSZXN1bHQ+IHtcbiAgaWYgKCFFeHBvbmVudFVwZGF0ZXMuY2hlY2tGb3JVcGRhdGVBc3luYykge1xuICAgIHRocm93IG5ldyBVbmF2YWlsYWJpbGl0eUVycm9yKCdVcGRhdGVzJywgJ2NoZWNrRm9yVXBkYXRlQXN5bmMnKTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBFeHBvbmVudFVwZGF0ZXMuY2hlY2tGb3JVcGRhdGVBc3luYygpO1xuICBpZiAoIXJlc3VsdCkge1xuICAgIHJldHVybiB7IGlzQXZhaWxhYmxlOiBmYWxzZSB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpc0F2YWlsYWJsZTogdHJ1ZSxcbiAgICBtYW5pZmVzdDogdHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKHJlc3VsdCkgOiByZXN1bHQsXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmZXRjaFVwZGF0ZUFzeW5jKHtcbiAgZXZlbnRMaXN0ZW5lcixcbn06IHsgZXZlbnRMaXN0ZW5lcj86IFVwZGF0ZUV2ZW50TGlzdGVuZXIgfSA9IHt9KTogUHJvbWlzZTxVcGRhdGVGZXRjaFJlc3VsdD4ge1xuICBpZiAoIUV4cG9uZW50VXBkYXRlcy5mZXRjaFVwZGF0ZUFzeW5jKSB7XG4gICAgdGhyb3cgbmV3IFVuYXZhaWxhYmlsaXR5RXJyb3IoJ1VwZGF0ZXMnLCAnZmV0Y2hVcGRhdGVBc3luYycpO1xuICB9XG4gIGxldCBzdWJzY3JpcHRpb247XG4gIGxldCByZXN1bHQ7XG4gIGlmIChldmVudExpc3RlbmVyICYmIHR5cGVvZiBldmVudExpc3RlbmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgc3Vic2NyaXB0aW9uID0gYWRkTGlzdGVuZXIoZXZlbnRMaXN0ZW5lcik7XG4gIH1cbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBhd2FpdCBFeHBvbmVudFVwZGF0ZXMuZmV0Y2hVcGRhdGVBc3luYygpO1xuICB9IGZpbmFsbHkge1xuICAgIHN1YnNjcmlwdGlvbiAmJiBzdWJzY3JpcHRpb24ucmVtb3ZlKCk7XG4gIH1cblxuICBpZiAoIXJlc3VsdCkge1xuICAgIHJldHVybiB7IGlzTmV3OiBmYWxzZSB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpc05ldzogdHJ1ZSxcbiAgICBtYW5pZmVzdDogdHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKHJlc3VsdCkgOiByZXN1bHQsXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjbGVhclVwZGF0ZUNhY2hlRXhwZXJpbWVudGFsQXN5bmMoYWJpVmVyc2lvbjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmICghRXhwb25lbnRVcGRhdGVzLmNsZWFyVXBkYXRlQ2FjaGVBc3luYykge1xuICAgIHRocm93IG5ldyBVbmF2YWlsYWJpbGl0eUVycm9yKCdVcGRhdGVzJywgJ2NsZWFyVXBkYXRlQ2FjaGVBc3luYycpO1xuICB9XG4gIHJldHVybiBFeHBvbmVudFVwZGF0ZXMuY2xlYXJVcGRhdGVDYWNoZUFzeW5jKGFiaVZlcnNpb24pO1xufVxuXG5sZXQgX2VtaXR0ZXI6IEV2ZW50RW1pdHRlciB8IG51bGw7XG5cbmZ1bmN0aW9uIF9nZXRFbWl0dGVyKCk6IEV2ZW50RW1pdHRlciB7XG4gIGlmICghX2VtaXR0ZXIpIHtcbiAgICBfZW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBSQ1REZXZpY2VFdmVudEVtaXR0ZXIuYWRkTGlzdGVuZXIoJ0V4cG9uZW50Lm5hdGl2ZVVwZGF0ZXNFdmVudCcsIF9lbWl0RXZlbnQpO1xuICB9XG4gIHJldHVybiBfZW1pdHRlcjtcbn1cblxuZnVuY3Rpb24gX2VtaXRFdmVudChwYXJhbXMpOiB2b2lkIHtcbiAgbGV0IG5ld1BhcmFtcyA9IHBhcmFtcztcbiAgaWYgKHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnKSB7XG4gICAgbmV3UGFyYW1zID0gSlNPTi5wYXJzZShwYXJhbXMpO1xuICB9XG4gIGlmIChuZXdQYXJhbXMubWFuaWZlc3RTdHJpbmcpIHtcbiAgICBuZXdQYXJhbXMubWFuaWZlc3QgPSBKU09OLnBhcnNlKG5ld1BhcmFtcy5tYW5pZmVzdFN0cmluZyk7XG4gICAgZGVsZXRlIG5ld1BhcmFtcy5tYW5pZmVzdFN0cmluZztcbiAgfVxuXG4gIGlmICghX2VtaXR0ZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEV2ZW50RW1pdHRlciBtdXN0IGJlIGluaXRpYWxpemVkIHRvIHVzZSBmcm9tIGl0cyBsaXN0ZW5lcmApO1xuICB9XG4gIF9lbWl0dGVyLmVtaXQoJ0V4cG9uZW50LnVwZGF0ZXNFdmVudCcsIG5ld1BhcmFtcyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRMaXN0ZW5lcihsaXN0ZW5lcjogRnVuY3Rpb24pOiBFdmVudFN1YnNjcmlwdGlvbiB7XG4gIGxldCBlbWl0dGVyID0gX2dldEVtaXR0ZXIoKTtcbiAgcmV0dXJuIGVtaXR0ZXIuYWRkTGlzdGVuZXIoJ0V4cG9uZW50LnVwZGF0ZXNFdmVudCcsIGxpc3RlbmVyKTtcbn1cblxuZXhwb3J0IGNvbnN0IEV2ZW50VHlwZSA9IHtcbiAgRE9XTkxPQURfU1RBUlRFRDogJ2Rvd25sb2FkU3RhcnQnLFxuICBET1dOTE9BRF9QUk9HUkVTUzogJ2Rvd25sb2FkUHJvZ3Jlc3MnLFxuICBET1dOTE9BRF9GSU5JU0hFRDogJ2Rvd25sb2FkRmluaXNoZWQnLFxuICBOT19VUERBVEVfQVZBSUxBQkxFOiAnbm9VcGRhdGVBdmFpbGFibGUnLFxuICBFUlJPUjogJ2Vycm9yJyxcbn07XG4iXSwic291cmNlUm9vdCI6IiJ9