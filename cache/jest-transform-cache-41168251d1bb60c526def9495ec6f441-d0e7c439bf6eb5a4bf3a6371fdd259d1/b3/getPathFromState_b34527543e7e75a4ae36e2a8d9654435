e1efdf4adea26de0cc9d0ed65191998e
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _slicedToArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/slicedToArray"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = getPathFromState;

var _queryString = _interopRequireDefault(require("query-string"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function getPathFromState(state) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if (state === undefined) {
    throw Error('NavigationState not passed');
  }

  var path = '/';
  var current = state;

  while (current) {
    var index = typeof current.index === 'number' ? current.index : 0;
    var route = current.routes[index];
    var currentOptions = options;
    var pattern = route.name;

    while (route.name in currentOptions) {
      if (typeof currentOptions[route.name] === 'string') {
        pattern = currentOptions[route.name];
        break;
      } else if (typeof currentOptions[route.name] === 'object') {
        if (!currentOptions[route.name].screens) {
          pattern = currentOptions[route.name].path;
          break;
        } else {
          if (route.state === undefined) {
            pattern = currentOptions[route.name].path;
            break;
          } else {
            index = typeof route.state.index === 'number' ? route.state.index : 0;
            var nextRoute = route.state.routes[index];
            var deeperConfig = currentOptions[route.name].screens;

            if (nextRoute.name in deeperConfig) {
              route = nextRoute;
              currentOptions = deeperConfig;
            } else {
              pattern = currentOptions[route.name].path;
              break;
            }
          }
        }
      }
    }

    if (pattern !== '') {
      (function () {
        var config = currentOptions[route.name] !== undefined ? currentOptions[route.name].stringify : undefined;
        var params = route.params ? Object.entries(route.params).reduce(function (acc, _ref) {
          var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
              key = _ref2[0],
              value = _ref2[1];

          acc[key] = (config === null || config === void 0 ? void 0 : config[key]) ? config[key](value) : String(value);
          return acc;
        }, {}) : undefined;

        if (currentOptions[route.name] !== undefined) {
          path += pattern.split('/').map(function (p) {
            var name = p.replace(/^:/, '');

            if (params && name in params && p.startsWith(':')) {
              var value = params[name];
              delete params[name];
              return encodeURIComponent(value);
            }

            return encodeURIComponent(p);
          }).join('/');
        } else {
          path += encodeURIComponent(route.name);
        }

        if (route.state) {
          path += '/';
        } else if (params) {
          var query = _queryString.default.stringify(params);

          if (query) {
            path += "?".concat(query);
          }
        }
      })();
    }

    current = route.state;
  }

  path = path !== '/' && path.slice(path.length - 1) === '/' ? path.slice(0, -1) : path;
  return path;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdldFBhdGhGcm9tU3RhdGUudHN4Il0sIm5hbWVzIjpbIm9wdGlvbnMiLCJzdGF0ZSIsIkVycm9yIiwicGF0aCIsImN1cnJlbnQiLCJpbmRleCIsInJvdXRlIiwiY3VycmVudE9wdGlvbnMiLCJwYXR0ZXJuIiwibmV4dFJvdXRlIiwiZGVlcGVyQ29uZmlnIiwiY29uZmlnIiwicGFyYW1zIiwiT2JqZWN0IiwiYWNjIiwiU3RyaW5nIiwicCIsIm5hbWUiLCJ2YWx1ZSIsImVuY29kZVVSSUNvbXBvbmVudCIsInF1ZXJ5IiwicXVlcnlTdHJpbmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsSUFBQSxZQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsY0FBQSxDQUFBLENBQUE7Ozs7Ozs7O0FBZ0RlLFNBQUEsZ0JBQUEsQ0FBQSxLQUFBLEVBR0w7QUFBQSxNQURSQSxPQUNRLEdBQUEsU0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLElBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxLQUFBLFNBQUEsR0FBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLEdBRFcsRUFDWDs7QUFDUixNQUFJQyxLQUFLLEtBQVQsU0FBQSxFQUF5QjtBQUN2QixVQUFNQyxLQUFLLENBQVgsNEJBQVcsQ0FBWDtBQUNEOztBQUNELE1BQUlDLElBQUksR0FBUixHQUFBO0FBRUEsTUFBSUMsT0FBMEIsR0FBOUIsS0FBQTs7QUFFQSxTQUFBLE9BQUEsRUFBZ0I7QUFDZCxRQUFJQyxLQUFLLEdBQUcsT0FBT0QsT0FBTyxDQUFkLEtBQUEsS0FBQSxRQUFBLEdBQW9DQSxPQUFPLENBQTNDLEtBQUEsR0FBWixDQUFBO0FBQ0EsUUFBSUUsS0FBSyxHQUFHRixPQUFPLENBQVBBLE1BQUFBLENBQVosS0FBWUEsQ0FBWjtBQUdBLFFBQUlHLGNBQWMsR0FBbEIsT0FBQTtBQUNBLFFBQUlDLE9BQU8sR0FBR0YsS0FBSyxDQUFuQixJQUFBOztBQUVBLFdBQU9BLEtBQUssQ0FBTEEsSUFBQUEsSUFBUCxjQUFBLEVBQXFDO0FBQ25DLFVBQUksT0FBT0MsY0FBYyxDQUFDRCxLQUFLLENBQTNCLElBQXFCLENBQXJCLEtBQUosUUFBQSxFQUFvRDtBQUNsREUsUUFBQUEsT0FBTyxHQUFHRCxjQUFjLENBQUNELEtBQUssQ0FBOUJFLElBQXdCLENBQXhCQTtBQUNBO0FBRkYsT0FBQSxNQUdPLElBQUksT0FBT0QsY0FBYyxDQUFDRCxLQUFLLENBQTNCLElBQXFCLENBQXJCLEtBQUosUUFBQSxFQUFvRDtBQUV6RCxZQUNFLENBQUVDLGNBQWMsQ0FBQ0QsS0FBSyxDQUFyQixJQUFlLENBQWRDLENBREosT0FBQSxFQUlFO0FBQ0FDLFVBQUFBLE9BQU8sR0FBSUQsY0FBYyxDQUFDRCxLQUFLLENBQXJCLElBQWUsQ0FBZEMsQ0FBWEMsSUFBQUE7QUFDQTtBQU5GLFNBQUEsTUFPTztBQUVMLGNBQUlGLEtBQUssQ0FBTEEsS0FBQUEsS0FBSixTQUFBLEVBQStCO0FBQzdCRSxZQUFBQSxPQUFPLEdBQUlELGNBQWMsQ0FBQ0QsS0FBSyxDQUFyQixJQUFlLENBQWRDLENBQVhDLElBQUFBO0FBQ0E7QUFGRixXQUFBLE1BR087QUFDTEgsWUFBQUEsS0FBSyxHQUNILE9BQU9DLEtBQUssQ0FBTEEsS0FBQUEsQ0FBUCxLQUFBLEtBQUEsUUFBQSxHQUF3Q0EsS0FBSyxDQUFMQSxLQUFBQSxDQUF4QyxLQUFBLEdBREZELENBQUFBO0FBRUEsZ0JBQU1JLFNBQVMsR0FBR0gsS0FBSyxDQUFMQSxLQUFBQSxDQUFBQSxNQUFBQSxDQUFsQixLQUFrQkEsQ0FBbEI7QUFDQSxnQkFBTUksWUFBWSxHQUFJSCxjQUFjLENBQUNELEtBQUssQ0FBckIsSUFBZSxDQUFkQyxDQUpqQixPQUlMOztBQUlBLGdCQUFJRSxTQUFTLENBQVRBLElBQUFBLElBQUosWUFBQSxFQUFvQztBQUNsQ0gsY0FBQUEsS0FBSyxHQUFMQSxTQUFBQTtBQUNBQyxjQUFBQSxjQUFjLEdBQWRBLFlBQUFBO0FBRkYsYUFBQSxNQUdPO0FBRUxDLGNBQUFBLE9BQU8sR0FBSUQsY0FBYyxDQUFDRCxLQUFLLENBQXJCLElBQWUsQ0FBZEMsQ0FBWEMsSUFBQUE7QUFDQTtBQUNEO0FBQ0Y7QUFDRjtBQUNGO0FBNUNXOztBQWdEZCxRQUFJQSxPQUFPLEtBQVgsRUFBQSxFQUFvQjtBQUFBO0FBQ2xCLFlBQU1HLE1BQU0sR0FDVkosY0FBYyxDQUFDRCxLQUFLLENBQXBCQyxJQUFjLENBQWRBLEtBQUFBLFNBQUFBLEdBQ0tBLGNBQWMsQ0FBQ0QsS0FBSyxDQUFyQixJQUFlLENBQWRDLENBRExBLFNBQUFBLEdBREYsU0FBQTtBQU1BLFlBQU1LLE1BQU0sR0FBRyxLQUFLLENBQUwsTUFBQSxHQUVYQyxNQUFNLENBQU5BLE9BQUFBLENBQWVQLEtBQUssQ0FBcEJPLE1BQUFBLEVBQUFBLE1BQUFBLENBRUcsVUFBQSxHQUFBLEVBQUEsSUFBQSxFQUF1QjtBQUFBLG1EQUFBLElBQUE7QUFBQSxjQUFqQixHQUFpQjtBQUFBLGNBQWpCLEtBQWlCOztBQUN4QkMsVUFBQUEsR0FBRyxDQUFIQSxHQUFHLENBQUhBLEdBQVcsQ0FBQSxNQUFNLEtBQU4sSUFBQSxJQUFBLE1BQU0sS0FBQSxLQUFOLENBQUEsR0FBQSxLQUFBLENBQUEsR0FBQSxNQUFNLENBQU4sR0FBTSxDQUFOLElBQWdCSCxNQUFNLENBQU5BLEdBQU0sQ0FBTkEsQ0FBaEIsS0FBZ0JBLENBQWhCLEdBQXFDSSxNQUFNLENBQXRERCxLQUFzRCxDQUF0REE7QUFDQSxpQkFBQSxHQUFBO0FBSkZELFNBQUFBLEVBRlcsRUFFWEEsQ0FGVyxHQUFmLFNBQUE7O0FBVUEsWUFBSU4sY0FBYyxDQUFDRCxLQUFLLENBQXBCQyxJQUFjLENBQWRBLEtBQUosU0FBQSxFQUE4QztBQUM1Q0osVUFBQUEsSUFBSSxJQUFJLE9BQU8sQ0FBUCxLQUFBLENBQUEsR0FBQSxFQUFBLEdBQUEsQ0FFRGEsVUFBQUEsQ0FBQyxFQUFJO0FBQ1IsZ0JBQU1DLElBQUksR0FBR0QsQ0FBQyxDQUFEQSxPQUFBQSxDQUFBQSxJQUFBQSxFQURMLEVBQ0tBLENBQWI7O0FBR0EsZ0JBQUlKLE1BQU0sSUFBSUssSUFBSSxJQUFkTCxNQUFBQSxJQUE0QkksQ0FBQyxDQUFEQSxVQUFBQSxDQUFoQyxHQUFnQ0EsQ0FBaEMsRUFBbUQ7QUFDakQsa0JBQU1FLEtBQUssR0FBR04sTUFBTSxDQUQ2QixJQUM3QixDQUFwQjtBQUdBLHFCQUFPQSxNQUFNLENBQWIsSUFBYSxDQUFiO0FBQ0EscUJBQU9PLGtCQUFrQixDQUF6QixLQUF5QixDQUF6QjtBQUNEOztBQUVELG1CQUFPQSxrQkFBa0IsQ0FBekIsQ0FBeUIsQ0FBekI7QUFkSSxXQUFBLEVBQUEsSUFBQSxDQUFSaEIsR0FBUSxDQUFSQTtBQURGLFNBQUEsTUFrQk87QUFDTEEsVUFBQUEsSUFBSSxJQUFJZ0Isa0JBQWtCLENBQUNiLEtBQUssQ0FBaENILElBQTBCLENBQTFCQTtBQUNEOztBQUVELFlBQUlHLEtBQUssQ0FBVCxLQUFBLEVBQWlCO0FBQ2ZILFVBQUFBLElBQUksSUFBSkEsR0FBQUE7QUFERixTQUFBLE1BRU8sSUFBQSxNQUFBLEVBQVk7QUFDakIsY0FBTWlCLEtBQUssR0FBR0MsWUFBQUEsQ0FBQUEsT0FBQUEsQ0FBQUEsU0FBQUEsQ0FBZCxNQUFjQSxDQUFkOztBQUVBLGNBQUEsS0FBQSxFQUFXO0FBQ1RsQixZQUFBQSxJQUFJLElBQUEsSUFBQSxNQUFBLENBQUpBLEtBQUksQ0FBSkE7QUFDRDtBQUNGO0FBL0NpQjtBQWdEbkI7O0FBRURDLElBQUFBLE9BQU8sR0FBR0UsS0FBSyxDQUFmRixLQUFBQTtBQUNEOztBQUVERCxFQUFBQSxJQUFJLEdBQ0ZBLElBQUksS0FBSkEsR0FBQUEsSUFBZ0JBLElBQUksQ0FBSkEsS0FBQUEsQ0FBV0EsSUFBSSxDQUFKQSxNQUFBQSxHQUFYQSxDQUFBQSxNQUFoQkEsR0FBQUEsR0FDSUEsSUFBSSxDQUFKQSxLQUFBQSxDQUFBQSxDQUFBQSxFQUFjLENBRGxCQSxDQUNJQSxDQURKQSxHQURGQSxJQUFBQTtBQUtBLFNBQUEsSUFBQTtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHF1ZXJ5U3RyaW5nIGZyb20gJ3F1ZXJ5LXN0cmluZyc7XG5pbXBvcnQge1xuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIFBhcnRpYWxTdGF0ZSxcbiAgUm91dGUsXG59IGZyb20gJ0ByZWFjdC1uYXZpZ2F0aW9uL3JvdXRlcnMnO1xuXG50eXBlIFN0YXRlID0gTmF2aWdhdGlvblN0YXRlIHwgT21pdDxQYXJ0aWFsU3RhdGU8TmF2aWdhdGlvblN0YXRlPiwgJ3N0YWxlJz47XG5cbnR5cGUgU3RyaW5naWZ5Q29uZmlnID0gUmVjb3JkPHN0cmluZywgKHZhbHVlOiBhbnkpID0+IHN0cmluZz47XG5cbnR5cGUgT3B0aW9ucyA9IHtcbiAgW3JvdXRlTmFtZTogc3RyaW5nXTpcbiAgICB8IHN0cmluZ1xuICAgIHwge1xuICAgICAgICBwYXRoPzogc3RyaW5nO1xuICAgICAgICBzdHJpbmdpZnk/OiBTdHJpbmdpZnlDb25maWc7XG4gICAgICAgIHNjcmVlbnM/OiBPcHRpb25zO1xuICAgICAgfTtcbn07XG5cbi8qKlxuICogVXRpbGl0eSB0byBzZXJpYWxpemUgYSBuYXZpZ2F0aW9uIHN0YXRlIG9iamVjdCB0byBhIHBhdGggc3RyaW5nLlxuICpcbiAqIEV4YW1wbGU6XG4gKiBgYGBqc1xuICogZ2V0UGF0aEZyb21TdGF0ZShcbiAqICAge1xuICogICAgIHJvdXRlczogW1xuICogICAgICAge1xuICogICAgICAgICBuYW1lOiAnQ2hhdCcsXG4gKiAgICAgICAgIHBhcmFtczogeyBhdXRob3I6ICdKYW5lJywgaWQ6IDQyIH0sXG4gKiAgICAgICB9LFxuICogICAgIF0sXG4gKiAgIH0sXG4gKiAgIHtcbiAqICAgICBDaGF0OiB7XG4gKiAgICAgICBwYXRoOiAnY2hhdC86YXV0aG9yLzppZCcsXG4gKiAgICAgICBzdHJpbmdpZnk6IHsgYXV0aG9yOiBhdXRob3IgPT4gYXV0aG9yLnRvTG93ZXJDYXNlKCkgfVxuICogICAgIH1cbiAqICAgfVxuICogKVxuICogYGBgXG4gKlxuICogQHBhcmFtIHN0YXRlIE5hdmlnYXRpb24gc3RhdGUgdG8gc2VyaWFsaXplLlxuICogQHBhcmFtIG9wdGlvbnMgRXh0cmEgb3B0aW9ucyB0byBmaW5lLXR1bmUgaG93IHRvIHNlcmlhbGl6ZSB0aGUgcGF0aC5cbiAqIEByZXR1cm5zIFBhdGggcmVwcmVzZW50aW5nIHRoZSBzdGF0ZSwgZS5nLiAvZm9vL2Jhcj9jb3VudD00Mi5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZ2V0UGF0aEZyb21TdGF0ZShcbiAgc3RhdGU/OiBTdGF0ZSxcbiAgb3B0aW9uczogT3B0aW9ucyA9IHt9XG4pOiBzdHJpbmcge1xuICBpZiAoc3RhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IEVycm9yKCdOYXZpZ2F0aW9uU3RhdGUgbm90IHBhc3NlZCcpO1xuICB9XG4gIGxldCBwYXRoID0gJy8nO1xuXG4gIGxldCBjdXJyZW50OiBTdGF0ZSB8IHVuZGVmaW5lZCA9IHN0YXRlO1xuXG4gIHdoaWxlIChjdXJyZW50KSB7XG4gICAgbGV0IGluZGV4ID0gdHlwZW9mIGN1cnJlbnQuaW5kZXggPT09ICdudW1iZXInID8gY3VycmVudC5pbmRleCA6IDA7XG4gICAgbGV0IHJvdXRlID0gY3VycmVudC5yb3V0ZXNbaW5kZXhdIGFzIFJvdXRlPHN0cmluZz4gJiB7XG4gICAgICBzdGF0ZT86IFN0YXRlO1xuICAgIH07XG4gICAgbGV0IGN1cnJlbnRPcHRpb25zID0gb3B0aW9ucztcbiAgICBsZXQgcGF0dGVybiA9IHJvdXRlLm5hbWU7XG5cbiAgICB3aGlsZSAocm91dGUubmFtZSBpbiBjdXJyZW50T3B0aW9ucykge1xuICAgICAgaWYgKHR5cGVvZiBjdXJyZW50T3B0aW9uc1tyb3V0ZS5uYW1lXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcGF0dGVybiA9IGN1cnJlbnRPcHRpb25zW3JvdXRlLm5hbWVdIGFzIHN0cmluZztcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjdXJyZW50T3B0aW9uc1tyb3V0ZS5uYW1lXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gYHNjcmVlbnNgIHByb3BlcnR5LCB3ZSByZXR1cm4gcGF0dGVyblxuICAgICAgICBpZiAoXG4gICAgICAgICAgIShjdXJyZW50T3B0aW9uc1tyb3V0ZS5uYW1lXSBhcyB7XG4gICAgICAgICAgICBzY3JlZW5zOiBPcHRpb25zO1xuICAgICAgICAgIH0pLnNjcmVlbnNcbiAgICAgICAgKSB7XG4gICAgICAgICAgcGF0dGVybiA9IChjdXJyZW50T3B0aW9uc1tyb3V0ZS5uYW1lXSBhcyB7IHBhdGg6IHN0cmluZyB9KS5wYXRoO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGlmIGl0IGlzIHRoZSBlbmQgb2Ygc3RhdGUsIHdlIHJldHVybiBwYXR0ZXJuXG4gICAgICAgICAgaWYgKHJvdXRlLnN0YXRlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHBhdHRlcm4gPSAoY3VycmVudE9wdGlvbnNbcm91dGUubmFtZV0gYXMgeyBwYXRoOiBzdHJpbmcgfSkucGF0aDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpbmRleCA9XG4gICAgICAgICAgICAgIHR5cGVvZiByb3V0ZS5zdGF0ZS5pbmRleCA9PT0gJ251bWJlcicgPyByb3V0ZS5zdGF0ZS5pbmRleCA6IDA7XG4gICAgICAgICAgICBjb25zdCBuZXh0Um91dGUgPSByb3V0ZS5zdGF0ZS5yb3V0ZXNbaW5kZXhdO1xuICAgICAgICAgICAgY29uc3QgZGVlcGVyQ29uZmlnID0gKGN1cnJlbnRPcHRpb25zW3JvdXRlLm5hbWVdIGFzIHtcbiAgICAgICAgICAgICAgc2NyZWVuczogT3B0aW9ucztcbiAgICAgICAgICAgIH0pLnNjcmVlbnM7XG4gICAgICAgICAgICAvLyBpZiB0aGVyZSBpcyBjb25maWcgZm9yIG5leHQgcm91dGUgbmFtZSwgd2UgZ28gZGVlcGVyXG4gICAgICAgICAgICBpZiAobmV4dFJvdXRlLm5hbWUgaW4gZGVlcGVyQ29uZmlnKSB7XG4gICAgICAgICAgICAgIHJvdXRlID0gbmV4dFJvdXRlIGFzIFJvdXRlPHN0cmluZz4gJiB7IHN0YXRlPzogU3RhdGUgfTtcbiAgICAgICAgICAgICAgY3VycmVudE9wdGlvbnMgPSBkZWVwZXJDb25maWc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBpZiBub3QsIHRoZXJlIGlzIG5vIHNlbnNlIGluIGdvaW5nIGRlZXBlciBpbiBjb25maWdcbiAgICAgICAgICAgICAgcGF0dGVybiA9IChjdXJyZW50T3B0aW9uc1tyb3V0ZS5uYW1lXSBhcyB7IHBhdGg6IHN0cmluZyB9KS5wYXRoO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB3ZSBkb24ndCBhZGQgZW1wdHkgcGF0aCBzdHJpbmdzIHRvIHBhdGhcbiAgICBpZiAocGF0dGVybiAhPT0gJycpIHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9XG4gICAgICAgIGN1cnJlbnRPcHRpb25zW3JvdXRlLm5hbWVdICE9PSB1bmRlZmluZWRcbiAgICAgICAgICA/IChjdXJyZW50T3B0aW9uc1tyb3V0ZS5uYW1lXSBhcyB7IHN0cmluZ2lmeT86IFN0cmluZ2lmeUNvbmZpZyB9KVxuICAgICAgICAgICAgICAuc3RyaW5naWZ5XG4gICAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAgIGNvbnN0IHBhcmFtcyA9IHJvdXRlLnBhcmFtc1xuICAgICAgICA/IC8vIFN0cmluZ2lmeSBhbGwgb2YgdGhlIHBhcmFtIHZhbHVlcyBiZWZvcmUgd2UgdXNlIHRoZW1cbiAgICAgICAgICBPYmplY3QuZW50cmllcyhyb3V0ZS5wYXJhbXMpLnJlZHVjZTx7XG4gICAgICAgICAgICBba2V5OiBzdHJpbmddOiBzdHJpbmc7XG4gICAgICAgICAgfT4oKGFjYywgW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgICBhY2Nba2V5XSA9IGNvbmZpZz8uW2tleV0gPyBjb25maWdba2V5XSh2YWx1ZSkgOiBTdHJpbmcodmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICB9LCB7fSlcbiAgICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAgIGlmIChjdXJyZW50T3B0aW9uc1tyb3V0ZS5uYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHBhdGggKz0gcGF0dGVyblxuICAgICAgICAgIC5zcGxpdCgnLycpXG4gICAgICAgICAgLm1hcChwID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBwLnJlcGxhY2UoL146LywgJycpO1xuXG4gICAgICAgICAgICAvLyBJZiB0aGUgcGF0aCBoYXMgYSBwYXR0ZXJuIGZvciBhIHBhcmFtLCBwdXQgdGhlIHBhcmFtIGluIHRoZSBwYXRoXG4gICAgICAgICAgICBpZiAocGFyYW1zICYmIG5hbWUgaW4gcGFyYW1zICYmIHAuc3RhcnRzV2l0aCgnOicpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcGFyYW1zW25hbWVdO1xuICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHVzZWQgdmFsdWUgZnJvbSB0aGUgcGFyYW1zIG9iamVjdCBzaW5jZSB3ZSdsbCB1c2UgdGhlIHJlc3QgZm9yIHF1ZXJ5IHN0cmluZ1xuICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWR5bmFtaWMtZGVsZXRlXG4gICAgICAgICAgICAgIGRlbGV0ZSBwYXJhbXNbbmFtZV07XG4gICAgICAgICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHApO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmpvaW4oJy8nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhdGggKz0gZW5jb2RlVVJJQ29tcG9uZW50KHJvdXRlLm5hbWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAocm91dGUuc3RhdGUpIHtcbiAgICAgICAgcGF0aCArPSAnLyc7XG4gICAgICB9IGVsc2UgaWYgKHBhcmFtcykge1xuICAgICAgICBjb25zdCBxdWVyeSA9IHF1ZXJ5U3RyaW5nLnN0cmluZ2lmeShwYXJhbXMpO1xuXG4gICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgIHBhdGggKz0gYD8ke3F1ZXJ5fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjdXJyZW50ID0gcm91dGUuc3RhdGU7XG4gIH1cblxuICBwYXRoID1cbiAgICBwYXRoICE9PSAnLycgJiYgcGF0aC5zbGljZShwYXRoLmxlbmd0aCAtIDEpID09PSAnLydcbiAgICAgID8gcGF0aC5zbGljZSgwLCAtMSlcbiAgICAgIDogcGF0aDtcblxuICByZXR1cm4gcGF0aDtcbn1cbiJdfQ==