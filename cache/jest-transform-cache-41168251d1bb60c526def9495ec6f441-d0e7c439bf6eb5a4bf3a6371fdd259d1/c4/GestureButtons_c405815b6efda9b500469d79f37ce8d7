0725f6dba375ed63ff904b4fc309126b
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
Object.defineProperty(exports, "PureNativeButton", {
  enumerable: true,
  get: function get() {
    return _GestureHandlerButton.default;
  }
});
exports.BorderlessButton = exports.RectButton = exports.BaseButton = exports.RawButton = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _react = _interopRequireDefault(require("react"));

var _reactNative = require("react-native");

var _createNativeWrapper = _interopRequireDefault(require("./createNativeWrapper"));

var _GestureHandlerButton = _interopRequireDefault(require("./GestureHandlerButton"));

var _State = _interopRequireDefault(require("./State"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var RawButton = (0, _createNativeWrapper.default)(_GestureHandlerButton.default, {
  shouldCancelWhenOutside: false,
  shouldActivateOnStart: false
});
exports.RawButton = RawButton;

var BaseButton = function (_React$Component) {
  (0, _inherits2.default)(BaseButton, _React$Component);

  function BaseButton(props) {
    var _this;

    (0, _classCallCheck2.default)(this, BaseButton);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(BaseButton).call(this, props));

    _this._handleEvent = function (_ref) {
      var nativeEvent = _ref.nativeEvent;
      var state = nativeEvent.state,
          oldState = nativeEvent.oldState,
          pointerInside = nativeEvent.pointerInside;
      var active = pointerInside && state === _State.default.ACTIVE;

      if (active !== _this._lastActive && _this.props.onActiveStateChange) {
        _this.props.onActiveStateChange(active);
      }

      if (oldState === _State.default.ACTIVE && state !== _State.default.CANCELLED && _this._lastActive && _this.props.onPress) {
        _this.props.onPress(active);
      }

      _this._lastActive = active;
    };

    _this._onHandlerStateChange = function (e) {
      _this.props.onHandlerStateChange && _this.props.onHandlerStateChange(e);

      _this._handleEvent(e);
    };

    _this._onGestureEvent = function (e) {
      _this.props.onGestureEvent && _this.props.onGestureEvent(e);

      _this._handleEvent(e);
    };

    _this._lastActive = false;
    return _this;
  }

  (0, _createClass2.default)(BaseButton, [{
    key: "render",
    value: function render() {
      var _this$props = this.props,
          style = _this$props.style,
          rippleColor = _this$props.rippleColor,
          rest = (0, _objectWithoutProperties2.default)(_this$props, ["style", "rippleColor"]);
      return _react.default.createElement(RawButton, (0, _extends2.default)({
        style: [{
          overflow: 'hidden'
        }, style],
        rippleColor: (0, _reactNative.processColor)(rippleColor)
      }, rest, {
        onGestureEvent: this._onGestureEvent,
        onHandlerStateChange: this._onHandlerStateChange
      }));
    }
  }]);
  return BaseButton;
}(_react.default.Component);

exports.BaseButton = BaseButton;
BaseButton.propTypes = _objectSpread({}, RawButton.propTypes, {
  onPress: _propTypes.default.func,
  onActiveStateChange: _propTypes.default.func
});

var AnimatedBaseButton = _reactNative.Animated.createAnimatedComponent(BaseButton);

var btnStyles = _reactNative.StyleSheet.create({
  underlay: {
    position: 'absolute',
    left: 0,
    right: 0,
    bottom: 0,
    top: 0
  }
});

var RectButton = function (_React$Component2) {
  (0, _inherits2.default)(RectButton, _React$Component2);

  function RectButton(props) {
    var _this2;

    (0, _classCallCheck2.default)(this, RectButton);
    _this2 = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(RectButton).call(this, props));

    _this2._onActiveStateChange = function (active) {
      if (_reactNative.Platform.OS !== 'android') {
        _this2._opacity.setValue(active ? _this2.props.activeOpacity : 0);
      }

      _this2.props.onActiveStateChange && _this2.props.onActiveStateChange(active);
    };

    _this2._opacity = new _reactNative.Animated.Value(0);
    return _this2;
  }

  (0, _createClass2.default)(RectButton, [{
    key: "render",
    value: function render() {
      var _this$props2 = this.props,
          children = _this$props2.children,
          rest = (0, _objectWithoutProperties2.default)(_this$props2, ["children"]);
      return _react.default.createElement(BaseButton, (0, _extends2.default)({}, rest, {
        onActiveStateChange: this._onActiveStateChange
      }), _react.default.createElement(_reactNative.Animated.View, {
        style: [btnStyles.underlay, {
          opacity: this._opacity
        }, {
          backgroundColor: this.props.underlayColor
        }]
      }), children);
    }
  }]);
  return RectButton;
}(_react.default.Component);

exports.RectButton = RectButton;
RectButton.propTypes = BaseButton.propTypes;
RectButton.defaultProps = {
  activeOpacity: 0.105,
  underlayColor: 'black'
};

var BorderlessButton = function (_React$Component3) {
  (0, _inherits2.default)(BorderlessButton, _React$Component3);

  function BorderlessButton(props) {
    var _this3;

    (0, _classCallCheck2.default)(this, BorderlessButton);
    _this3 = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(BorderlessButton).call(this, props));

    _this3._onActiveStateChange = function (active) {
      if (_reactNative.Platform.OS !== 'android') {
        _this3._opacity.setValue(active ? _this3.props.activeOpacity : 1);
      }

      _this3.props.onActiveStateChange && _this3.props.onActiveStateChange(active);
    };

    _this3._opacity = new _reactNative.Animated.Value(1);
    return _this3;
  }

  (0, _createClass2.default)(BorderlessButton, [{
    key: "render",
    value: function render() {
      var _this$props3 = this.props,
          children = _this$props3.children,
          style = _this$props3.style,
          rest = (0, _objectWithoutProperties2.default)(_this$props3, ["children", "style"]);
      return _react.default.createElement(AnimatedBaseButton, (0, _extends2.default)({}, rest, {
        onActiveStateChange: this._onActiveStateChange,
        style: [style, _reactNative.Platform.OS === 'ios' && {
          opacity: this._opacity
        }]
      }), children);
    }
  }]);
  return BorderlessButton;
}(_react.default.Component);

exports.BorderlessButton = BorderlessButton;
BorderlessButton.propTypes = _objectSpread({}, BaseButton.propTypes, {
  borderless: _propTypes.default.bool
});
BorderlessButton.defaultProps = {
  activeOpacity: 0.3,
  borderless: true
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdlc3R1cmVCdXR0b25zLmpzIl0sIm5hbWVzIjpbIlJhd0J1dHRvbiIsIkdlc3R1cmVIYW5kbGVyQnV0dG9uIiwic2hvdWxkQ2FuY2VsV2hlbk91dHNpZGUiLCJzaG91bGRBY3RpdmF0ZU9uU3RhcnQiLCJCYXNlQnV0dG9uIiwicHJvcHMiLCJfaGFuZGxlRXZlbnQiLCJuYXRpdmVFdmVudCIsInN0YXRlIiwib2xkU3RhdGUiLCJwb2ludGVySW5zaWRlIiwiYWN0aXZlIiwiU3RhdGUiLCJBQ1RJVkUiLCJfbGFzdEFjdGl2ZSIsIm9uQWN0aXZlU3RhdGVDaGFuZ2UiLCJDQU5DRUxMRUQiLCJvblByZXNzIiwiX29uSGFuZGxlclN0YXRlQ2hhbmdlIiwiZSIsIm9uSGFuZGxlclN0YXRlQ2hhbmdlIiwiX29uR2VzdHVyZUV2ZW50Iiwib25HZXN0dXJlRXZlbnQiLCJzdHlsZSIsInJpcHBsZUNvbG9yIiwicmVzdCIsIm92ZXJmbG93IiwiUmVhY3QiLCJDb21wb25lbnQiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJmdW5jIiwiQW5pbWF0ZWRCYXNlQnV0dG9uIiwiQW5pbWF0ZWQiLCJjcmVhdGVBbmltYXRlZENvbXBvbmVudCIsImJ0blN0eWxlcyIsIlN0eWxlU2hlZXQiLCJjcmVhdGUiLCJ1bmRlcmxheSIsInBvc2l0aW9uIiwibGVmdCIsInJpZ2h0IiwiYm90dG9tIiwidG9wIiwiUmVjdEJ1dHRvbiIsIl9vbkFjdGl2ZVN0YXRlQ2hhbmdlIiwiUGxhdGZvcm0iLCJPUyIsIl9vcGFjaXR5Iiwic2V0VmFsdWUiLCJhY3RpdmVPcGFjaXR5IiwiVmFsdWUiLCJjaGlsZHJlbiIsIm9wYWNpdHkiLCJiYWNrZ3JvdW5kQ29sb3IiLCJ1bmRlcmxheUNvbG9yIiwiZGVmYXVsdFByb3BzIiwiQm9yZGVybGVzc0J1dHRvbiIsImJvcmRlcmxlc3MiLCJib29sIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUVB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QWEsRUFBRSxHQURLO0FBRXBCUSxFQUFBQSxVQUFVLEVBQUU7QUFGUSxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBBbmltYXRlZCwgUGxhdGZvcm0sIHByb2Nlc3NDb2xvciwgU3R5bGVTaGVldCB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmltcG9ydCBjcmVhdGVOYXRpdmVXcmFwcGVyIGZyb20gJy4vY3JlYXRlTmF0aXZlV3JhcHBlcic7XG5pbXBvcnQgR2VzdHVyZUhhbmRsZXJCdXR0b24gZnJvbSAnLi9HZXN0dXJlSGFuZGxlckJ1dHRvbic7XG5pbXBvcnQgU3RhdGUgZnJvbSAnLi9TdGF0ZSc7XG5cbmV4cG9ydCBjb25zdCBSYXdCdXR0b24gPSBjcmVhdGVOYXRpdmVXcmFwcGVyKEdlc3R1cmVIYW5kbGVyQnV0dG9uLCB7XG4gIHNob3VsZENhbmNlbFdoZW5PdXRzaWRlOiBmYWxzZSxcbiAgc2hvdWxkQWN0aXZhdGVPblN0YXJ0OiBmYWxzZSxcbn0pO1xuXG4vKiBCdXR0b25zICovXG5cbmV4cG9ydCBjbGFzcyBCYXNlQnV0dG9uIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAuLi5SYXdCdXR0b24ucHJvcFR5cGVzLFxuICAgIG9uUHJlc3M6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uQWN0aXZlU3RhdGVDaGFuZ2U6IFByb3BUeXBlcy5mdW5jLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuX2xhc3RBY3RpdmUgPSBmYWxzZTtcbiAgfVxuXG4gIF9oYW5kbGVFdmVudCA9ICh7IG5hdGl2ZUV2ZW50IH0pID0+IHtcbiAgICBjb25zdCB7IHN0YXRlLCBvbGRTdGF0ZSwgcG9pbnRlckluc2lkZSB9ID0gbmF0aXZlRXZlbnQ7XG4gICAgY29uc3QgYWN0aXZlID0gcG9pbnRlckluc2lkZSAmJiBzdGF0ZSA9PT0gU3RhdGUuQUNUSVZFO1xuXG4gICAgaWYgKGFjdGl2ZSAhPT0gdGhpcy5fbGFzdEFjdGl2ZSAmJiB0aGlzLnByb3BzLm9uQWN0aXZlU3RhdGVDaGFuZ2UpIHtcbiAgICAgIHRoaXMucHJvcHMub25BY3RpdmVTdGF0ZUNoYW5nZShhY3RpdmUpO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIG9sZFN0YXRlID09PSBTdGF0ZS5BQ1RJVkUgJiZcbiAgICAgIHN0YXRlICE9PSBTdGF0ZS5DQU5DRUxMRUQgJiZcbiAgICAgIHRoaXMuX2xhc3RBY3RpdmUgJiZcbiAgICAgIHRoaXMucHJvcHMub25QcmVzc1xuICAgICkge1xuICAgICAgdGhpcy5wcm9wcy5vblByZXNzKGFjdGl2ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5fbGFzdEFjdGl2ZSA9IGFjdGl2ZTtcbiAgfTtcblxuICAvLyBOb3JtYWxseSwgdGhlIHBhcmVudCB3b3VsZCBleGVjdXRlIGl0J3MgaGFuZGxlciBmaXJzdCxcbiAgLy8gdGhlbiBmb3J3YXJkIHRoZSBldmVudCB0byBsaXN0ZW5lcnMuIEhvd2V2ZXIsIGhlcmUgb3VyIGhhbmRsZXJcbiAgLy8gaXMgdmlydHVhbGx5IG9ubHkgZm9yd2FyZGluZyBldmVudHMgdG8gbGlzdGVuZXJzLCBzbyB3ZSByZXZlcnNlIHRoZSBvcmRlclxuICAvLyB0byBrZWVwIHRoZSBwcm9wZXIgb3JkZXIgb2YgdGhlIGNhbGxiYWNrcyAoZnJvbSBcInJhd1wiIG9uZXMgdG8gXCJwcm9jZXNzZWRcIikuXG4gIF9vbkhhbmRsZXJTdGF0ZUNoYW5nZSA9IGUgPT4ge1xuICAgIHRoaXMucHJvcHMub25IYW5kbGVyU3RhdGVDaGFuZ2UgJiYgdGhpcy5wcm9wcy5vbkhhbmRsZXJTdGF0ZUNoYW5nZShlKTtcbiAgICB0aGlzLl9oYW5kbGVFdmVudChlKTtcbiAgfTtcblxuICBfb25HZXN0dXJlRXZlbnQgPSBlID0+IHtcbiAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUV2ZW50ICYmIHRoaXMucHJvcHMub25HZXN0dXJlRXZlbnQoZSk7XG4gICAgdGhpcy5faGFuZGxlRXZlbnQoZSk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgc3R5bGUsIHJpcHBsZUNvbG9yLCAuLi5yZXN0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxSYXdCdXR0b25cbiAgICAgICAgc3R5bGU9e1t7IG92ZXJmbG93OiAnaGlkZGVuJyB9LCBzdHlsZV19XG4gICAgICAgIHJpcHBsZUNvbG9yPXtwcm9jZXNzQ29sb3IocmlwcGxlQ29sb3IpfVxuICAgICAgICB7Li4ucmVzdH1cbiAgICAgICAgb25HZXN0dXJlRXZlbnQ9e3RoaXMuX29uR2VzdHVyZUV2ZW50fVxuICAgICAgICBvbkhhbmRsZXJTdGF0ZUNoYW5nZT17dGhpcy5fb25IYW5kbGVyU3RhdGVDaGFuZ2V9XG4gICAgICAvPlxuICAgICk7XG4gIH1cbn1cblxuY29uc3QgQW5pbWF0ZWRCYXNlQnV0dG9uID0gQW5pbWF0ZWQuY3JlYXRlQW5pbWF0ZWRDb21wb25lbnQoQmFzZUJ1dHRvbik7XG5cbmNvbnN0IGJ0blN0eWxlcyA9IFN0eWxlU2hlZXQuY3JlYXRlKHtcbiAgdW5kZXJsYXk6IHtcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICBsZWZ0OiAwLFxuICAgIHJpZ2h0OiAwLFxuICAgIGJvdHRvbTogMCxcbiAgICB0b3A6IDAsXG4gIH0sXG59KTtcblxuZXhwb3J0IGNsYXNzIFJlY3RCdXR0b24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0gQmFzZUJ1dHRvbi5wcm9wVHlwZXM7XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBhY3RpdmVPcGFjaXR5OiAwLjEwNSxcbiAgICB1bmRlcmxheUNvbG9yOiAnYmxhY2snLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuX29wYWNpdHkgPSBuZXcgQW5pbWF0ZWQuVmFsdWUoMCk7XG4gIH1cblxuICBfb25BY3RpdmVTdGF0ZUNoYW5nZSA9IGFjdGl2ZSA9PiB7XG4gICAgaWYgKFBsYXRmb3JtLk9TICE9PSAnYW5kcm9pZCcpIHtcbiAgICAgIHRoaXMuX29wYWNpdHkuc2V0VmFsdWUoYWN0aXZlID8gdGhpcy5wcm9wcy5hY3RpdmVPcGFjaXR5IDogMCk7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9wcy5vbkFjdGl2ZVN0YXRlQ2hhbmdlICYmIHRoaXMucHJvcHMub25BY3RpdmVTdGF0ZUNoYW5nZShhY3RpdmUpO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGNoaWxkcmVuLCAuLi5yZXN0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxCYXNlQnV0dG9uIHsuLi5yZXN0fSBvbkFjdGl2ZVN0YXRlQ2hhbmdlPXt0aGlzLl9vbkFjdGl2ZVN0YXRlQ2hhbmdlfT5cbiAgICAgICAgPEFuaW1hdGVkLlZpZXdcbiAgICAgICAgICBzdHlsZT17W1xuICAgICAgICAgICAgYnRuU3R5bGVzLnVuZGVybGF5LFxuICAgICAgICAgICAgeyBvcGFjaXR5OiB0aGlzLl9vcGFjaXR5IH0sXG4gICAgICAgICAgICB7IGJhY2tncm91bmRDb2xvcjogdGhpcy5wcm9wcy51bmRlcmxheUNvbG9yIH0sXG4gICAgICAgICAgXX1cbiAgICAgICAgLz5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9CYXNlQnV0dG9uPlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEJvcmRlcmxlc3NCdXR0b24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC4uLkJhc2VCdXR0b24ucHJvcFR5cGVzLFxuICAgIGJvcmRlcmxlc3M6IFByb3BUeXBlcy5ib29sLFxuICB9O1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgYWN0aXZlT3BhY2l0eTogMC4zLFxuICAgIGJvcmRlcmxlc3M6IHRydWUsXG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgdGhpcy5fb3BhY2l0eSA9IG5ldyBBbmltYXRlZC5WYWx1ZSgxKTtcbiAgfVxuXG4gIF9vbkFjdGl2ZVN0YXRlQ2hhbmdlID0gYWN0aXZlID0+IHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJykge1xuICAgICAgdGhpcy5fb3BhY2l0eS5zZXRWYWx1ZShhY3RpdmUgPyB0aGlzLnByb3BzLmFjdGl2ZU9wYWNpdHkgOiAxKTtcbiAgICB9XG5cbiAgICB0aGlzLnByb3BzLm9uQWN0aXZlU3RhdGVDaGFuZ2UgJiYgdGhpcy5wcm9wcy5vbkFjdGl2ZVN0YXRlQ2hhbmdlKGFjdGl2ZSk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgY2hpbGRyZW4sIHN0eWxlLCAuLi5yZXN0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxBbmltYXRlZEJhc2VCdXR0b25cbiAgICAgICAgey4uLnJlc3R9XG4gICAgICAgIG9uQWN0aXZlU3RhdGVDaGFuZ2U9e3RoaXMuX29uQWN0aXZlU3RhdGVDaGFuZ2V9XG4gICAgICAgIHN0eWxlPXtbc3R5bGUsIFBsYXRmb3JtLk9TID09PSAnaW9zJyAmJiB7IG9wYWNpdHk6IHRoaXMuX29wYWNpdHkgfV19PlxuICAgICAgICB7Y2hpbGRyZW59XG4gICAgICA8L0FuaW1hdGVkQmFzZUJ1dHRvbj5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCB7IGRlZmF1bHQgYXMgUHVyZU5hdGl2ZUJ1dHRvbiB9IGZyb20gJy4vR2VzdHVyZUhhbmRsZXJCdXR0b24nO1xuIl19