886f4708d260a24cb16f5cb7c7ee0275
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.lockAsync = lockAsync;
exports.lockPlatformAsync = lockPlatformAsync;
exports.unlockAsync = unlockAsync;
exports.getOrientationAsync = getOrientationAsync;
exports.getOrientationLockAsync = getOrientationLockAsync;
exports.getPlatformOrientationLockAsync = getPlatformOrientationLockAsync;
exports.supportsOrientationLockAsync = supportsOrientationLockAsync;
exports.addOrientationChangeListener = addOrientationChangeListener;
exports.removeOrientationChangeListeners = removeOrientationChangeListeners;
exports.removeOrientationChangeListener = removeOrientationChangeListener;
Object.defineProperty(exports, "Orientation", {
  enumerable: true,
  get: function get() {
    return _ScreenOrientation.Orientation;
  }
});
Object.defineProperty(exports, "OrientationLock", {
  enumerable: true,
  get: function get() {
    return _ScreenOrientation.OrientationLock;
  }
});
Object.defineProperty(exports, "SizeClassIOS", {
  enumerable: true,
  get: function get() {
    return _ScreenOrientation.SizeClassIOS;
  }
});
Object.defineProperty(exports, "WebOrientationLock", {
  enumerable: true,
  get: function get() {
    return _ScreenOrientation.WebOrientationLock;
  }
});

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _core = require("@unimodules/core");

var _ExpoScreenOrientation = _interopRequireDefault(require("./ExpoScreenOrientation"));

var _ScreenOrientation = require("./ScreenOrientation.types");

var _orientationChangeEmitter = new _core.EventEmitter(_ExpoScreenOrientation.default);

var _orientationChangeSubscribers = [];
var _lastOrientationLock = _ScreenOrientation.OrientationLock.UNKNOWN;

function lockAsync(orientationLock) {
  var orientationLocks;
  return _regenerator.default.async(function lockAsync$(_context) {
    while (1) {
      switch (_context.prev = _context.next) {
        case 0:
          if (_ExpoScreenOrientation.default.lockAsync) {
            _context.next = 2;
            break;
          }

          throw new _core.UnavailabilityError('ScreenOrientation', 'lockAsync');

        case 2:
          orientationLocks = Object.values(_ScreenOrientation.OrientationLock);

          if (orientationLocks.includes(orientationLock)) {
            _context.next = 5;
            break;
          }

          throw new TypeError("Invalid Orientation Lock: " + orientationLock);

        case 5:
          if (!(orientationLock === _ScreenOrientation.OrientationLock.OTHER)) {
            _context.next = 7;
            break;
          }

          return _context.abrupt("return");

        case 7:
          _context.next = 9;
          return _regenerator.default.awrap(_ExpoScreenOrientation.default.lockAsync(orientationLock));

        case 9:
          _lastOrientationLock = orientationLock;

        case 10:
        case "end":
          return _context.stop();
      }
    }
  });
}

function lockPlatformAsync(options) {
  var screenOrientationConstantAndroid, screenOrientationArrayIOS, screenOrientationLockWeb, platformOrientationParam, orientations, _iterator, _isArray, _i, _ref, _orientation, webOrientationLocks;

  return _regenerator.default.async(function lockPlatformAsync$(_context2) {
    while (1) {
      switch (_context2.prev = _context2.next) {
        case 0:
          if (_ExpoScreenOrientation.default.lockPlatformAsync) {
            _context2.next = 2;
            break;
          }

          throw new _core.UnavailabilityError('ScreenOrientation', 'lockPlatformAsync');

        case 2:
          screenOrientationConstantAndroid = options.screenOrientationConstantAndroid, screenOrientationArrayIOS = options.screenOrientationArrayIOS, screenOrientationLockWeb = options.screenOrientationLockWeb;

          if (!(_core.Platform.OS === 'android' && screenOrientationConstantAndroid)) {
            _context2.next = 9;
            break;
          }

          if (!isNaN(screenOrientationConstantAndroid)) {
            _context2.next = 6;
            break;
          }

          throw new TypeError("lockPlatformAsync Android platform: screenOrientationConstantAndroid cannot be called with " + screenOrientationConstantAndroid);

        case 6:
          platformOrientationParam = screenOrientationConstantAndroid;
          _context2.next = 37;
          break;

        case 9:
          if (!(_core.Platform.OS === 'ios' && screenOrientationArrayIOS)) {
            _context2.next = 32;
            break;
          }

          if (Array.isArray(screenOrientationArrayIOS)) {
            _context2.next = 12;
            break;
          }

          throw new TypeError("lockPlatformAsync iOS platform: screenOrientationArrayIOS cannot be called with " + screenOrientationArrayIOS);

        case 12:
          orientations = Object.values(_ScreenOrientation.Orientation);
          _iterator = screenOrientationArrayIOS, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[typeof Symbol === "function" ? typeof Symbol === "function" ? Symbol.iterator : "@@iterator" : "@@iterator"]();

        case 14:
          if (!_isArray) {
            _context2.next = 20;
            break;
          }

          if (!(_i >= _iterator.length)) {
            _context2.next = 17;
            break;
          }

          return _context2.abrupt("break", 29);

        case 17:
          _ref = _iterator[_i++];
          _context2.next = 24;
          break;

        case 20:
          _i = _iterator.next();

          if (!_i.done) {
            _context2.next = 23;
            break;
          }

          return _context2.abrupt("break", 29);

        case 23:
          _ref = _i.value;

        case 24:
          _orientation = _ref;

          if (orientations.includes(_orientation)) {
            _context2.next = 27;
            break;
          }

          throw new TypeError("lockPlatformAsync iOS platform: " + _orientation + " is not a valid Orientation");

        case 27:
          _context2.next = 14;
          break;

        case 29:
          platformOrientationParam = screenOrientationArrayIOS;
          _context2.next = 37;
          break;

        case 32:
          if (!(_core.Platform.OS === 'web' && screenOrientationLockWeb)) {
            _context2.next = 37;
            break;
          }

          webOrientationLocks = Object.values(_ScreenOrientation.WebOrientationLock);

          if (webOrientationLocks.includes(screenOrientationLockWeb)) {
            _context2.next = 36;
            break;
          }

          throw new TypeError("Invalid Web Orientation Lock: " + screenOrientationLockWeb);

        case 36:
          platformOrientationParam = screenOrientationLockWeb;

        case 37:
          if (platformOrientationParam) {
            _context2.next = 39;
            break;
          }

          throw new TypeError('lockPlatformAsync cannot be called with undefined option properties');

        case 39:
          _context2.next = 41;
          return _regenerator.default.awrap(_ExpoScreenOrientation.default.lockPlatformAsync(platformOrientationParam));

        case 41:
          _lastOrientationLock = _ScreenOrientation.OrientationLock.OTHER;

        case 42:
        case "end":
          return _context2.stop();
      }
    }
  });
}

function unlockAsync() {
  return _regenerator.default.async(function unlockAsync$(_context3) {
    while (1) {
      switch (_context3.prev = _context3.next) {
        case 0:
          if (_ExpoScreenOrientation.default.unlockAsync) {
            _context3.next = 2;
            break;
          }

          throw new _core.UnavailabilityError('ScreenOrientation', 'unlockAsync');

        case 2:
          _context3.next = 4;
          return _regenerator.default.awrap(_ExpoScreenOrientation.default.unlockAsync());

        case 4:
        case "end":
          return _context3.stop();
      }
    }
  });
}

function getOrientationAsync() {
  return _regenerator.default.async(function getOrientationAsync$(_context4) {
    while (1) {
      switch (_context4.prev = _context4.next) {
        case 0:
          if (_ExpoScreenOrientation.default.getOrientationAsync) {
            _context4.next = 2;
            break;
          }

          throw new _core.UnavailabilityError('ScreenOrientation', 'getOrientationAsync');

        case 2:
          _context4.next = 4;
          return _regenerator.default.awrap(_ExpoScreenOrientation.default.getOrientationAsync());

        case 4:
          return _context4.abrupt("return", _context4.sent);

        case 5:
        case "end":
          return _context4.stop();
      }
    }
  });
}

function getOrientationLockAsync() {
  return _regenerator.default.async(function getOrientationLockAsync$(_context5) {
    while (1) {
      switch (_context5.prev = _context5.next) {
        case 0:
          if (_ExpoScreenOrientation.default.getOrientationLockAsync) {
            _context5.next = 2;
            break;
          }

          return _context5.abrupt("return", _lastOrientationLock);

        case 2:
          _context5.next = 4;
          return _regenerator.default.awrap(_ExpoScreenOrientation.default.getOrientationLockAsync());

        case 4:
          return _context5.abrupt("return", _context5.sent);

        case 5:
        case "end":
          return _context5.stop();
      }
    }
  });
}

function getPlatformOrientationLockAsync() {
  var platformOrientationLock;
  return _regenerator.default.async(function getPlatformOrientationLockAsync$(_context6) {
    while (1) {
      switch (_context6.prev = _context6.next) {
        case 0:
          _context6.next = 2;
          return _regenerator.default.awrap(_ExpoScreenOrientation.default.getPlatformOrientationLockAsync());

        case 2:
          platformOrientationLock = _context6.sent;

          if (!(_core.Platform.OS === 'android')) {
            _context6.next = 7;
            break;
          }

          return _context6.abrupt("return", {
            screenOrientationConstantAndroid: platformOrientationLock
          });

        case 7:
          if (!(_core.Platform.OS === 'ios')) {
            _context6.next = 11;
            break;
          }

          return _context6.abrupt("return", {
            screenOrientationArrayIOS: platformOrientationLock
          });

        case 11:
          if (!(_core.Platform.OS === 'web')) {
            _context6.next = 15;
            break;
          }

          return _context6.abrupt("return", {
            screenOrientationLockWeb: platformOrientationLock
          });

        case 15:
          return _context6.abrupt("return", {});

        case 16:
        case "end":
          return _context6.stop();
      }
    }
  });
}

function supportsOrientationLockAsync(orientationLock) {
  var orientationLocks;
  return _regenerator.default.async(function supportsOrientationLockAsync$(_context7) {
    while (1) {
      switch (_context7.prev = _context7.next) {
        case 0:
          if (_ExpoScreenOrientation.default.supportsOrientationLockAsync) {
            _context7.next = 2;
            break;
          }

          throw new _core.UnavailabilityError('ScreenOrientation', 'supportsOrientationLockAsync');

        case 2:
          orientationLocks = Object.values(_ScreenOrientation.OrientationLock);

          if (orientationLocks.includes(orientationLock)) {
            _context7.next = 5;
            break;
          }

          throw new TypeError("Invalid Orientation Lock: " + orientationLock);

        case 5:
          _context7.next = 7;
          return _regenerator.default.awrap(_ExpoScreenOrientation.default.supportsOrientationLockAsync(orientationLock));

        case 7:
          return _context7.abrupt("return", _context7.sent);

        case 8:
        case "end":
          return _context7.stop();
      }
    }
  });
}

function getEventName() {
  return _core.Platform.OS === 'ios' || _core.Platform.OS === 'web' ? 'expoDidUpdateDimensions' : 'didUpdateDimensions';
}

function addOrientationChangeListener(listener) {
  if (typeof listener !== 'function') {
    throw new TypeError("addOrientationChangeListener cannot be called with " + listener);
  }

  var subscription = _orientationChangeEmitter.addListener(getEventName(), function _callee(update) {
    var orientationInfo, orientationLock, _ref2, _ref3;

    return _regenerator.default.async(function _callee$(_context8) {
      while (1) {
        switch (_context8.prev = _context8.next) {
          case 0:
            if (!(_core.Platform.OS === 'ios' || _core.Platform.OS === 'web')) {
              _context8.next = 5;
              break;
            }

            orientationLock = update.orientationLock;
            orientationInfo = update.orientationInfo;
            _context8.next = 11;
            break;

          case 5:
            _context8.next = 7;
            return _regenerator.default.awrap(Promise.all([getOrientationLockAsync(), getOrientationAsync()]));

          case 7:
            _ref2 = _context8.sent;
            _ref3 = (0, _slicedToArray2.default)(_ref2, 2);
            orientationLock = _ref3[0];
            orientationInfo = _ref3[1];

          case 11:
            listener({
              orientationInfo: orientationInfo,
              orientationLock: orientationLock
            });

          case 12:
          case "end":
            return _context8.stop();
        }
      }
    });
  });

  _orientationChangeSubscribers.push(subscription);

  return subscription;
}

function removeOrientationChangeListeners() {
  var i = _orientationChangeSubscribers.length;

  while (i--) {
    var subscriber = _orientationChangeSubscribers[i];
    subscriber.remove();

    _orientationChangeSubscribers.pop();
  }
}

function removeOrientationChangeListener(subscription) {
  if (!subscription || !subscription.remove) {
    throw new TypeError("Must pass in a valid subscription");
  }

  subscription.remove();
  _orientationChangeSubscribers = _orientationChangeSubscribers.filter(function (sub) {
    return sub !== subscription;
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9TY3JlZW5PcmllbnRhdGlvbi9TY3JlZW5PcmllbnRhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQXNCQSxJQUFNLHlCQUF5QixHQUFHLElBQUksa0JBQUosQ0FBaUIsOEJBQWpCLENBQWxDOztBQUNBLElBQUksNkJBQTZCLEdBQW1CLEVBQXBEO0FBRUEsSUFBSSxvQkFBb0IsR0FBb0IsbUNBQWdCLE9BQTVEOztBQUVPLFNBQWUsU0FBZixDQUF5QixlQUF6QjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxjQUNBLCtCQUFzQixTQUR0QjtBQUFBO0FBQUE7QUFBQTs7QUFBQSxnQkFFRyxJQUFJLHlCQUFKLENBQXdCLG1CQUF4QixFQUE2QyxXQUE3QyxDQUZIOztBQUFBO0FBS0MsVUFBQSxnQkFMRCxHQUtvQixNQUFNLENBQUMsTUFBUCxDQUFjLGtDQUFkLENBTHBCOztBQUFBLGNBTUEsZ0JBQWdCLENBQUMsUUFBakIsQ0FBMEIsZUFBMUIsQ0FOQTtBQUFBO0FBQUE7QUFBQTs7QUFBQSxnQkFPRyxJQUFJLFNBQUosZ0NBQTJDLGVBQTNDLENBUEg7O0FBQUE7QUFBQSxnQkFVRCxlQUFlLEtBQUssbUNBQWdCLEtBVm5DO0FBQUE7QUFBQTtBQUFBOztBQUFBOztBQUFBO0FBQUE7QUFBQSw0Q0FjQywrQkFBc0IsU0FBdEIsQ0FBZ0MsZUFBaEMsQ0FkRDs7QUFBQTtBQWVMLFVBQUEsb0JBQW9CLEdBQUcsZUFBdkI7O0FBZks7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBa0JBLFNBQWUsaUJBQWYsQ0FBaUMsT0FBakM7QUFBQTs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGNBQ0EsK0JBQXNCLGlCQUR0QjtBQUFBO0FBQUE7QUFBQTs7QUFBQSxnQkFFRyxJQUFJLHlCQUFKLENBQXdCLG1CQUF4QixF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a0JBLEVBQUEsNkJBQTZCLENBQUMsSUFBOUIsQ0FBbUMsWUFBbkM7O0FBQ0EsU0FBTyxZQUFQO0FBQ0Q7O0FBS0ssU0FBVSxnQ0FBVixHQUEwQztBQUU5QyxNQUFJLENBQUMsR0FBRyw2QkFBNkIsQ0FBQyxNQUF0Qzs7QUFDQSxTQUFPLENBQUMsRUFBUixFQUFZO0FBQ1YsUUFBTSxVQUFVLEdBQUcsNkJBQTZCLENBQUMsQ0FBRCxDQUFoRDtBQUNBLElBQUEsVUFBVSxDQUFDLE1BQVg7O0FBR0EsSUFBQSw2QkFBNkIsQ0FBQyxHQUE5QjtBQUNEO0FBQ0Y7O0FBRUssU0FBVSwrQkFBVixDQUEwQyxZQUExQyxFQUFvRTtBQUN4RSxNQUFJLENBQUMsWUFBRCxJQUFpQixDQUFDLFlBQVksQ0FBQyxNQUFuQyxFQUEyQztBQUN6QyxVQUFNLElBQUksU0FBSixxQ0FBTjtBQUNEOztBQUNELEVBQUEsWUFBWSxDQUFDLE1BQWI7QUFDQSxFQUFBLDZCQUE2QixHQUFHLDZCQUE2QixDQUFDLE1BQTlCLENBQXFDLFVBQUEsR0FBRztBQUFBLFdBQUksR0FBRyxLQUFLLFlBQVo7QUFBQSxHQUF4QyxDQUFoQztBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBQbGF0Zm9ybSwgU3Vic2NyaXB0aW9uLCBVbmF2YWlsYWJpbGl0eUVycm9yIH0gZnJvbSAnQHVuaW1vZHVsZXMvY29yZSc7XG5cbmltcG9ydCBFeHBvU2NyZWVuT3JpZW50YXRpb24gZnJvbSAnLi9FeHBvU2NyZWVuT3JpZW50YXRpb24nO1xuaW1wb3J0IHtcbiAgT3JpZW50YXRpb24sXG4gIE9yaWVudGF0aW9uQ2hhbmdlRXZlbnQsXG4gIE9yaWVudGF0aW9uQ2hhbmdlTGlzdGVuZXIsXG4gIE9yaWVudGF0aW9uSW5mbyxcbiAgT3JpZW50YXRpb25Mb2NrLFxuICBQbGF0Zm9ybU9yaWVudGF0aW9uSW5mbyxcbiAgU2l6ZUNsYXNzSU9TLFxuICBXZWJPcmllbnRhdGlvbkxvY2ssXG59IGZyb20gJy4vU2NyZWVuT3JpZW50YXRpb24udHlwZXMnO1xuXG5leHBvcnQge1xuICBPcmllbnRhdGlvbixcbiAgT3JpZW50YXRpb25Mb2NrLFxuICBTaXplQ2xhc3NJT1MsXG4gIE9yaWVudGF0aW9uSW5mbyxcbiAgUGxhdGZvcm1PcmllbnRhdGlvbkluZm8sXG4gIE9yaWVudGF0aW9uQ2hhbmdlTGlzdGVuZXIsXG4gIE9yaWVudGF0aW9uQ2hhbmdlRXZlbnQsXG4gIFdlYk9yaWVudGF0aW9uTG9jayxcbn07XG5cbmNvbnN0IF9vcmllbnRhdGlvbkNoYW5nZUVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKEV4cG9TY3JlZW5PcmllbnRhdGlvbik7XG5sZXQgX29yaWVudGF0aW9uQ2hhbmdlU3Vic2NyaWJlcnM6IFN1YnNjcmlwdGlvbltdID0gW107XG5cbmxldCBfbGFzdE9yaWVudGF0aW9uTG9jazogT3JpZW50YXRpb25Mb2NrID0gT3JpZW50YXRpb25Mb2NrLlVOS05PV047XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2NrQXN5bmMob3JpZW50YXRpb25Mb2NrOiBPcmllbnRhdGlvbkxvY2spOiBQcm9taXNlPHZvaWQ+IHtcbiAgaWYgKCFFeHBvU2NyZWVuT3JpZW50YXRpb24ubG9ja0FzeW5jKSB7XG4gICAgdGhyb3cgbmV3IFVuYXZhaWxhYmlsaXR5RXJyb3IoJ1NjcmVlbk9yaWVudGF0aW9uJywgJ2xvY2tBc3luYycpO1xuICB9XG5cbiAgY29uc3Qgb3JpZW50YXRpb25Mb2NrcyA9IE9iamVjdC52YWx1ZXMoT3JpZW50YXRpb25Mb2NrKTtcbiAgaWYgKCFvcmllbnRhdGlvbkxvY2tzLmluY2x1ZGVzKG9yaWVudGF0aW9uTG9jaykpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIE9yaWVudGF0aW9uIExvY2s6ICR7b3JpZW50YXRpb25Mb2NrfWApO1xuICB9XG5cbiAgaWYgKG9yaWVudGF0aW9uTG9jayA9PT0gT3JpZW50YXRpb25Mb2NrLk9USEVSKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgYXdhaXQgRXhwb1NjcmVlbk9yaWVudGF0aW9uLmxvY2tBc3luYyhvcmllbnRhdGlvbkxvY2spO1xuICBfbGFzdE9yaWVudGF0aW9uTG9jayA9IG9yaWVudGF0aW9uTG9jaztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvY2tQbGF0Zm9ybUFzeW5jKG9wdGlvbnM6IFBsYXRmb3JtT3JpZW50YXRpb25JbmZvKTogUHJvbWlzZTx2b2lkPiB7XG4gIGlmICghRXhwb1NjcmVlbk9yaWVudGF0aW9uLmxvY2tQbGF0Zm9ybUFzeW5jKSB7XG4gICAgdGhyb3cgbmV3IFVuYXZhaWxhYmlsaXR5RXJyb3IoJ1NjcmVlbk9yaWVudGF0aW9uJywgJ2xvY2tQbGF0Zm9ybUFzeW5jJyk7XG4gIH1cblxuICBjb25zdCB7XG4gICAgc2NyZWVuT3JpZW50YXRpb25Db25zdGFudEFuZHJvaWQsXG4gICAgc2NyZWVuT3JpZW50YXRpb25BcnJheUlPUyxcbiAgICBzY3JlZW5PcmllbnRhdGlvbkxvY2tXZWIsXG4gIH0gPSBvcHRpb25zO1xuICBsZXQgcGxhdGZvcm1PcmllbnRhdGlvblBhcmFtOiBhbnk7XG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnICYmIHNjcmVlbk9yaWVudGF0aW9uQ29uc3RhbnRBbmRyb2lkKSB7XG4gICAgaWYgKGlzTmFOKHNjcmVlbk9yaWVudGF0aW9uQ29uc3RhbnRBbmRyb2lkKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgICAgYGxvY2tQbGF0Zm9ybUFzeW5jIEFuZHJvaWQgcGxhdGZvcm06IHNjcmVlbk9yaWVudGF0aW9uQ29uc3RhbnRBbmRyb2lkIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCAke3NjcmVlbk9yaWVudGF0aW9uQ29uc3RhbnRBbmRyb2lkfWBcbiAgICAgICk7XG4gICAgfVxuICAgIHBsYXRmb3JtT3JpZW50YXRpb25QYXJhbSA9IHNjcmVlbk9yaWVudGF0aW9uQ29uc3RhbnRBbmRyb2lkO1xuICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJyAmJiBzY3JlZW5PcmllbnRhdGlvbkFycmF5SU9TKSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KHNjcmVlbk9yaWVudGF0aW9uQXJyYXlJT1MpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICBgbG9ja1BsYXRmb3JtQXN5bmMgaU9TIHBsYXRmb3JtOiBzY3JlZW5PcmllbnRhdGlvbkFycmF5SU9TIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCAke3NjcmVlbk9yaWVudGF0aW9uQXJyYXlJT1N9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBvcmllbnRhdGlvbnMgPSBPYmplY3QudmFsdWVzKE9yaWVudGF0aW9uKTtcbiAgICBmb3IgKGxldCBvcmllbnRhdGlvbiBvZiBzY3JlZW5PcmllbnRhdGlvbkFycmF5SU9TKSB7XG4gICAgICBpZiAoIW9yaWVudGF0aW9ucy5pbmNsdWRlcyhvcmllbnRhdGlvbikpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgICAgICBgbG9ja1BsYXRmb3JtQXN5bmMgaU9TIHBsYXRmb3JtOiAke29yaWVudGF0aW9ufSBpcyBub3QgYSB2YWxpZCBPcmllbnRhdGlvbmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcGxhdGZvcm1PcmllbnRhdGlvblBhcmFtID0gc2NyZWVuT3JpZW50YXRpb25BcnJheUlPUztcbiAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicgJiYgc2NyZWVuT3JpZW50YXRpb25Mb2NrV2ViKSB7XG4gICAgY29uc3Qgd2ViT3JpZW50YXRpb25Mb2NrcyA9IE9iamVjdC52YWx1ZXMoV2ViT3JpZW50YXRpb25Mb2NrKTtcbiAgICBpZiAoIXdlYk9yaWVudGF0aW9uTG9ja3MuaW5jbHVkZXMoc2NyZWVuT3JpZW50YXRpb25Mb2NrV2ViKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgSW52YWxpZCBXZWIgT3JpZW50YXRpb24gTG9jazogJHtzY3JlZW5PcmllbnRhdGlvbkxvY2tXZWJ9YCk7XG4gICAgfVxuICAgIHBsYXRmb3JtT3JpZW50YXRpb25QYXJhbSA9IHNjcmVlbk9yaWVudGF0aW9uTG9ja1dlYjtcbiAgfVxuXG4gIGlmICghcGxhdGZvcm1PcmllbnRhdGlvblBhcmFtKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignbG9ja1BsYXRmb3JtQXN5bmMgY2Fubm90IGJlIGNhbGxlZCB3aXRoIHVuZGVmaW5lZCBvcHRpb24gcHJvcGVydGllcycpO1xuICB9XG4gIGF3YWl0IEV4cG9TY3JlZW5PcmllbnRhdGlvbi5sb2NrUGxhdGZvcm1Bc3luYyhwbGF0Zm9ybU9yaWVudGF0aW9uUGFyYW0pO1xuICBfbGFzdE9yaWVudGF0aW9uTG9jayA9IE9yaWVudGF0aW9uTG9jay5PVEhFUjtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVubG9ja0FzeW5jKCk6IFByb21pc2U8dm9pZD4ge1xuICBpZiAoIUV4cG9TY3JlZW5PcmllbnRhdGlvbi51bmxvY2tBc3luYykge1xuICAgIHRocm93IG5ldyBVbmF2YWlsYWJpbGl0eUVycm9yKCdTY3JlZW5PcmllbnRhdGlvbicsICd1bmxvY2tBc3luYycpO1xuICB9XG4gIGF3YWl0IEV4cG9TY3JlZW5PcmllbnRhdGlvbi51bmxvY2tBc3luYygpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JpZW50YXRpb25Bc3luYygpOiBQcm9taXNlPE9yaWVudGF0aW9uSW5mbz4ge1xuICBpZiAoIUV4cG9TY3JlZW5PcmllbnRhdGlvbi5nZXRPcmllbnRhdGlvbkFzeW5jKSB7XG4gICAgdGhyb3cgbmV3IFVuYXZhaWxhYmlsaXR5RXJyb3IoJ1NjcmVlbk9yaWVudGF0aW9uJywgJ2dldE9yaWVudGF0aW9uQXN5bmMnKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgRXhwb1NjcmVlbk9yaWVudGF0aW9uLmdldE9yaWVudGF0aW9uQXN5bmMoKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE9yaWVudGF0aW9uTG9ja0FzeW5jKCk6IFByb21pc2U8T3JpZW50YXRpb25Mb2NrPiB7XG4gIGlmICghRXhwb1NjcmVlbk9yaWVudGF0aW9uLmdldE9yaWVudGF0aW9uTG9ja0FzeW5jKSB7XG4gICAgcmV0dXJuIF9sYXN0T3JpZW50YXRpb25Mb2NrO1xuICB9XG4gIHJldHVybiBhd2FpdCBFeHBvU2NyZWVuT3JpZW50YXRpb24uZ2V0T3JpZW50YXRpb25Mb2NrQXN5bmMoKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBsYXRmb3JtT3JpZW50YXRpb25Mb2NrQXN5bmMoKTogUHJvbWlzZTxQbGF0Zm9ybU9yaWVudGF0aW9uSW5mbz4ge1xuICBjb25zdCBwbGF0Zm9ybU9yaWVudGF0aW9uTG9jayA9IGF3YWl0IEV4cG9TY3JlZW5PcmllbnRhdGlvbi5nZXRQbGF0Zm9ybU9yaWVudGF0aW9uTG9ja0FzeW5jKCk7XG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjcmVlbk9yaWVudGF0aW9uQ29uc3RhbnRBbmRyb2lkOiBwbGF0Zm9ybU9yaWVudGF0aW9uTG9jayxcbiAgICB9O1xuICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgIHJldHVybiB7XG4gICAgICBzY3JlZW5PcmllbnRhdGlvbkFycmF5SU9TOiBwbGF0Zm9ybU9yaWVudGF0aW9uTG9jayxcbiAgICB9O1xuICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnd2ViJykge1xuICAgIHJldHVybiB7XG4gICAgICBzY3JlZW5PcmllbnRhdGlvbkxvY2tXZWI6IHBsYXRmb3JtT3JpZW50YXRpb25Mb2NrLFxuICAgIH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdXBwb3J0c09yaWVudGF0aW9uTG9ja0FzeW5jKFxuICBvcmllbnRhdGlvbkxvY2s6IE9yaWVudGF0aW9uTG9ja1xuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGlmICghRXhwb1NjcmVlbk9yaWVudGF0aW9uLnN1cHBvcnRzT3JpZW50YXRpb25Mb2NrQXN5bmMpIHtcbiAgICB0aHJvdyBuZXcgVW5hdmFpbGFiaWxpdHlFcnJvcignU2NyZWVuT3JpZW50YXRpb24nLCAnc3VwcG9ydHNPcmllbnRhdGlvbkxvY2tBc3luYycpO1xuICB9XG5cbiAgY29uc3Qgb3JpZW50YXRpb25Mb2NrcyA9IE9iamVjdC52YWx1ZXMoT3JpZW50YXRpb25Mb2NrKTtcbiAgaWYgKCFvcmllbnRhdGlvbkxvY2tzLmluY2x1ZGVzKG9yaWVudGF0aW9uTG9jaykpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIE9yaWVudGF0aW9uIExvY2s6ICR7b3JpZW50YXRpb25Mb2NrfWApO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IEV4cG9TY3JlZW5PcmllbnRhdGlvbi5zdXBwb3J0c09yaWVudGF0aW9uTG9ja0FzeW5jKG9yaWVudGF0aW9uTG9jayk7XG59XG5cbi8vIERldGVybWluZSB0aGUgZXZlbnQgbmFtZSBsYXppbHkgc28gSmVzdCBjYW4gc2V0IHVwIG1vY2tzIGluIGFkdmFuY2VcbmZ1bmN0aW9uIGdldEV2ZW50TmFtZSgpOiBzdHJpbmcge1xuICByZXR1cm4gUGxhdGZvcm0uT1MgPT09ICdpb3MnIHx8IFBsYXRmb3JtLk9TID09PSAnd2ViJ1xuICAgID8gJ2V4cG9EaWRVcGRhdGVEaW1lbnNpb25zJ1xuICAgIDogJ2RpZFVwZGF0ZURpbWVuc2lvbnMnO1xufVxuXG4vLyBXZSByZWx5IG9uIFJOIHRvIGVtaXQgYGRpZFVwZGF0ZURpbWVuc2lvbnNgXG4vLyBJZiB0aGlzIG1ldGhvZCBubyBsb25nZXIgd29ya3MsIGl0J3MgcG9zc2libGUgdGhhdCB0aGUgdW5kZXJseWluZyBSTiBpbXBsZW1lbnRhdGlvbiBoYXMgY2hhbmdlZFxuLy8gc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC1uYXRpdmUvYmxvYi9jMzFmNzlmZTQ3OGI4ODI1NDBkN2ZkMzFlZTM3YjUzZGRiZDYwYTE3L1JlYWN0QW5kcm9pZC9zcmMvbWFpbi9qYXZhL2NvbS9mYWNlYm9vay9yZWFjdC9tb2R1bGVzL2RldmljZWluZm8vRGV2aWNlSW5mb01vZHVsZS5qYXZhI0w5MFxuZXhwb3J0IGZ1bmN0aW9uIGFkZE9yaWVudGF0aW9uQ2hhbmdlTGlzdGVuZXIobGlzdGVuZXI6IE9yaWVudGF0aW9uQ2hhbmdlTGlzdGVuZXIpOiBTdWJzY3JpcHRpb24ge1xuICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgYWRkT3JpZW50YXRpb25DaGFuZ2VMaXN0ZW5lciBjYW5ub3QgYmUgY2FsbGVkIHdpdGggJHtsaXN0ZW5lcn1gKTtcbiAgfVxuICBjb25zdCBzdWJzY3JpcHRpb24gPSBfb3JpZW50YXRpb25DaGFuZ2VFbWl0dGVyLmFkZExpc3RlbmVyKFxuICAgIGdldEV2ZW50TmFtZSgpLFxuICAgIGFzeW5jICh1cGRhdGU6IE9yaWVudGF0aW9uQ2hhbmdlRXZlbnQpID0+IHtcbiAgICAgIGxldCBvcmllbnRhdGlvbkluZm8sIG9yaWVudGF0aW9uTG9jaztcbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2lvcycgfHwgUGxhdGZvcm0uT1MgPT09ICd3ZWInKSB7XG4gICAgICAgIC8vIEZvciBpT1MsIFJOIHJlbGllcyBvbiBzdGF0dXNCYXJPcmllbnRhdGlvbiAoZGVwcmVjYXRlZCkgdG8gZW1pdCBgZGlkVXBkYXRlRGltZW5zaW9uc2AgZXZlbnQsIHNvIHdlIGVtaXQgb3VyIG93biBgZXhwb0RpZFVwZGF0ZURpbWVuc2lvbnNgIGV2ZW50IGluc3RlYWRcbiAgICAgICAgb3JpZW50YXRpb25Mb2NrID0gdXBkYXRlLm9yaWVudGF0aW9uTG9jaztcbiAgICAgICAgb3JpZW50YXRpb25JbmZvID0gdXBkYXRlLm9yaWVudGF0aW9uSW5mbztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFdlIHJlbHkgb24gdGhlIFJOIERpbWVuc2lvbnMgdG8gZW1pdCB0aGUgYGRpZFVwZGF0ZURpbWVuc2lvbnNgIGV2ZW50IG9uIEFuZHJvaWRcbiAgICAgICAgW29yaWVudGF0aW9uTG9jaywgb3JpZW50YXRpb25JbmZvXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICBnZXRPcmllbnRhdGlvbkxvY2tBc3luYygpLFxuICAgICAgICAgIGdldE9yaWVudGF0aW9uQXN5bmMoKSxcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgICBsaXN0ZW5lcih7IG9yaWVudGF0aW9uSW5mbywgb3JpZW50YXRpb25Mb2NrIH0pO1xuICAgIH1cbiAgKTtcbiAgX29yaWVudGF0aW9uQ2hhbmdlU3Vic2NyaWJlcnMucHVzaChzdWJzY3JpcHRpb24pO1xuICByZXR1cm4gc3Vic2NyaXB0aW9uO1xufVxuXG4vLyBXZSBuZWVkIHRvIGtlZXAgdHJhY2sgb2Ygb3VyIG93biBzdWJzY3JpYmVycyBiZWNhdXNlIEV2ZW50RW1pdHRlciB1c2VzIGEgc2hhcmVkIHN1YnNjcmliZXJcbi8vIGZyb20gTmF0aXZlRXZlbnRFbWl0dGVyIHRoYXQgaXMgcmVnaXN0ZXJlZCB0byB0aGUgc2FtZSBldmVudFR5cGVzIGFzIHVzLiBEaXJlY3RseSBjYWxsaW5nXG4vLyByZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnROYW1lKSB3aWxsIHJlbW92ZSBvdGhlciBtb2R1bGUncyBzdWJzY3JpYmVycy5cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVPcmllbnRhdGlvbkNoYW5nZUxpc3RlbmVycygpOiB2b2lkIHtcbiAgLy8gUmVtb3ZlIGxpc3RlbmVyIGJ5IHN1YnNjcmlwdGlvbiBpbnN0ZWFkIG9mIGV2ZW50VHlwZSB0byBhdm9pZCBjbG9iYmVyaW5nIERpbWVuc2lvbiBtb2R1bGUncyBzdWJzY3JpcHRpb24gb2YgZGlkVXBkYXRlRGltZW5zaW9uc1xuICBsZXQgaSA9IF9vcmllbnRhdGlvbkNoYW5nZVN1YnNjcmliZXJzLmxlbmd0aDtcbiAgd2hpbGUgKGktLSkge1xuICAgIGNvbnN0IHN1YnNjcmliZXIgPSBfb3JpZW50YXRpb25DaGFuZ2VTdWJzY3JpYmVyc1tpXTtcbiAgICBzdWJzY3JpYmVyLnJlbW92ZSgpO1xuXG4gICAgLy8gcmVtb3ZlIGFmdGVyIGEgc3VjY2Vzc2Z1bCB1bnN1YnNjcmliZVxuICAgIF9vcmllbnRhdGlvbkNoYW5nZVN1YnNjcmliZXJzLnBvcCgpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW1vdmVPcmllbnRhdGlvbkNoYW5nZUxpc3RlbmVyKHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uKTogdm9pZCB7XG4gIGlmICghc3Vic2NyaXB0aW9uIHx8ICFzdWJzY3JpcHRpb24ucmVtb3ZlKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgTXVzdCBwYXNzIGluIGEgdmFsaWQgc3Vic2NyaXB0aW9uYCk7XG4gIH1cbiAgc3Vic2NyaXB0aW9uLnJlbW92ZSgpO1xuICBfb3JpZW50YXRpb25DaGFuZ2VTdWJzY3JpYmVycyA9IF9vcmllbnRhdGlvbkNoYW5nZVN1YnNjcmliZXJzLmZpbHRlcihzdWIgPT4gc3ViICE9PSBzdWJzY3JpcHRpb24pO1xufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==