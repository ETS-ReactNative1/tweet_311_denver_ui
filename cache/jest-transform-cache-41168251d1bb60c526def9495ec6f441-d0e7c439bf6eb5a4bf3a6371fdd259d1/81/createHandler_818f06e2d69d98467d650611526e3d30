8da9d37f647b8ef912212c55c894ae13
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createHandler;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _reactNative = require("react-native");

var _areEqual = _interopRequireDefault(require("fbjs/lib/areEqual"));

var _RNGestureHandlerModule = _interopRequireDefault(require("./RNGestureHandlerModule"));

var _State = _interopRequireDefault(require("./State"));

var _stateToPropMappings;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function findNodeHandle(node) {
  if (_reactNative.Platform.OS === 'web') return node;
  return (0, _reactNative.findNodeHandle)(node);
}

var _NativeModules$UIMana = _reactNative.NativeModules.UIManager,
    UIManager = _NativeModules$UIMana === void 0 ? {} : _NativeModules$UIMana;
var customGHEventsConfig = {
  onGestureHandlerEvent: {
    registrationName: 'onGestureHandlerEvent'
  },
  onGestureHandlerStateChange: {
    registrationName: 'onGestureHandlerStateChange'
  }
};
UIManager.genericDirectEventTypes = _objectSpread({}, UIManager.genericDirectEventTypes, {}, customGHEventsConfig);

if (UIManager.getConstants) {
  UIManager.getConstants().genericDirectEventTypes = _objectSpread({}, UIManager.getConstants().genericDirectEventTypes, {}, customGHEventsConfig);
}

var _UIManager$setJSRespo = UIManager.setJSResponder,
    oldSetJSResponder = _UIManager$setJSRespo === void 0 ? function () {} : _UIManager$setJSRespo,
    _UIManager$clearJSRes = UIManager.clearJSResponder,
    oldClearJSResponder = _UIManager$clearJSRes === void 0 ? function () {} : _UIManager$clearJSRes;

UIManager.setJSResponder = function (tag, blockNativeResponder) {
  _RNGestureHandlerModule.default.handleSetJSResponder(tag, blockNativeResponder);

  oldSetJSResponder(tag, blockNativeResponder);
};

UIManager.clearJSResponder = function () {
  _RNGestureHandlerModule.default.handleClearJSResponder();

  oldClearJSResponder();
};

var handlerTag = 1;
var handlerIDToTag = {};

function isConfigParam(param, name) {
  return param !== undefined && (param !== Object(param) || !('__isNative' in param)) && name !== 'onHandlerStateChange' && name !== 'onGestureEvent';
}

function filterConfig(props, validProps) {
  var defaults = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

  var res = _objectSpread({}, defaults);

  Object.keys(validProps).forEach(function (key) {
    var value = props[key];

    if (isConfigParam(value, key)) {
      var _value = props[key];

      if (key === 'simultaneousHandlers' || key === 'waitFor') {
        _value = transformIntoHandlerTags(props[key]);
      } else if (key === 'hitSlop') {
        if (typeof _value !== 'object') {
          _value = {
            top: _value,
            left: _value,
            bottom: _value,
            right: _value
          };
        }
      }

      res[key] = _value;
    }
  });
  return res;
}

function transformIntoHandlerTags(handlerIDs) {
  if (!Array.isArray(handlerIDs)) {
    handlerIDs = [handlerIDs];
  }

  if (_reactNative.Platform.OS === 'web') {
    return handlerIDs.map(function (_ref) {
      var current = _ref.current;
      return current;
    }).filter(function (handle) {
      return handle;
    });
  }

  return handlerIDs.map(function (handlerID) {
    return handlerIDToTag[handlerID] || handlerID.current && handlerID.current._handlerTag || -1;
  }).filter(function (handlerTag) {
    return handlerTag > 0;
  });
}

function hasUnresolvedRefs(props) {
  var extract = function extract(refs) {
    if (!Array.isArray(refs)) {
      return refs && refs.current === null;
    }

    return refs.some(function (r) {
      return r && r.current === null;
    });
  };

  return extract(props['simultaneousHandlers']) || extract(props['waitFor']);
}

var stateToPropMappings = (_stateToPropMappings = {}, (0, _defineProperty2.default)(_stateToPropMappings, _State.default.BEGAN, 'onBegan'), (0, _defineProperty2.default)(_stateToPropMappings, _State.default.FAILED, 'onFailed'), (0, _defineProperty2.default)(_stateToPropMappings, _State.default.CANCELLED, 'onCancelled'), (0, _defineProperty2.default)(_stateToPropMappings, _State.default.ACTIVE, 'onActivated'), (0, _defineProperty2.default)(_stateToPropMappings, _State.default.END, 'onEnded'), _stateToPropMappings);

function createHandler(handlerName) {
  var propTypes = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var config = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var transformProps = arguments.length > 3 ? arguments[3] : undefined;
  var customNativeProps = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};

  var Handler = function (_React$Component) {
    (0, _inherits2.default)(Handler, _React$Component);

    function Handler(props) {
      var _this;

      (0, _classCallCheck2.default)(this, Handler);
      _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(Handler).call(this, props));

      _this._onGestureHandlerEvent = function (event) {
        if (event.nativeEvent.handlerTag === _this._handlerTag) {
          _this.props.onGestureEvent && _this.props.onGestureEvent(event);
        } else {
          _this.props.onGestureHandlerEvent && _this.props.onGestureHandlerEvent(event);
        }
      };

      _this._onGestureHandlerStateChange = function (event) {
        if (event.nativeEvent.handlerTag === _this._handlerTag) {
          _this.props.onHandlerStateChange && _this.props.onHandlerStateChange(event);
          var stateEventName = stateToPropMappings[event.nativeEvent.state];

          if (typeof _this.props[stateEventName] === 'function') {
            _this.props[stateEventName](event);
          }
        } else {
          _this.props.onGestureHandlerStateChange && _this.props.onGestureHandlerStateChange(event);
        }
      };

      _this._refHandler = function (node) {
        _this._viewNode = node;

        var child = _react.default.Children.only(_this.props.children);

        var ref = child.ref;

        if (ref !== null) {
          if (typeof ref === 'function') {
            ref(node);
          } else {
            ref.current = node;
          }
        }
      };

      _this._createGestureHandler = function (newConfig) {
        _this._config = newConfig;

        _RNGestureHandlerModule.default.createGestureHandler(handlerName, _this._handlerTag, newConfig);
      };

      _this._attachGestureHandler = function (newViewTag) {
        _this._viewTag = newViewTag;

        _RNGestureHandlerModule.default.attachGestureHandler(_this._handlerTag, newViewTag);
      };

      _this._updateGestureHandler = function (newConfig) {
        _this._config = newConfig;

        _RNGestureHandlerModule.default.updateGestureHandler(_this._handlerTag, newConfig);
      };

      _this._handlerTag = handlerTag++;
      _this._config = {};

      if (props.id) {
        if (handlerIDToTag[props.id] !== undefined) {
          throw new Error("Handler with ID \"" + props.id + "\" already registered");
        }

        handlerIDToTag[props.id] = _this._handlerTag;
      }

      return _this;
    }

    (0, _createClass2.default)(Handler, [{
      key: "componentWillUnmount",
      value: function componentWillUnmount() {
        _RNGestureHandlerModule.default.dropGestureHandler(this._handlerTag);

        if (this._updateEnqueued) {
          clearImmediate(this._updateEnqueued);
        }

        if (this.props.id) {
          delete handlerIDToTag[this.props.id];
        }
      }
    }, {
      key: "componentDidMount",
      value: function componentDidMount() {
        var _this2 = this;

        if (hasUnresolvedRefs(this.props)) {
          this._updateEnqueued = setImmediate(function () {
            _this2._updateEnqueued = null;

            _this2._update();
          });
        }

        this._createGestureHandler(filterConfig(transformProps ? transformProps(this.props) : this.props, _objectSpread({}, this.constructor.propTypes, {}, customNativeProps), config));

        this._attachGestureHandler(findNodeHandle(this._viewNode));
      }
    }, {
      key: "componentDidUpdate",
      value: function componentDidUpdate() {
        var viewTag = findNodeHandle(this._viewNode);

        if (this._viewTag !== viewTag) {
          this._attachGestureHandler(viewTag);
        }

        this._update();
      }
    }, {
      key: "_update",
      value: function _update() {
        var newConfig = filterConfig(transformProps ? transformProps(this.props) : this.props, _objectSpread({}, this.constructor.propTypes, {}, customNativeProps), config);

        if (!(0, _areEqual.default)(this._config, newConfig)) {
          this._updateGestureHandler(newConfig);
        }
      }
    }, {
      key: "setNativeProps",
      value: function setNativeProps(updates) {
        var mergedProps = _objectSpread({}, this.props, {}, updates);

        var newConfig = filterConfig(transformProps ? transformProps(mergedProps) : mergedProps, _objectSpread({}, this.constructor.propTypes, {}, customNativeProps), config);

        this._updateGestureHandler(newConfig);
      }
    }, {
      key: "render",
      value: function render() {
        var gestureEventHandler = this._onGestureHandlerEvent;
        var _this$props = this.props,
            onGestureEvent = _this$props.onGestureEvent,
            onGestureHandlerEvent = _this$props.onGestureHandlerEvent;

        if (onGestureEvent && typeof onGestureEvent !== 'function') {
          if (onGestureHandlerEvent) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureEventHandler = this.props.onGestureEvent;
        } else {
          if (onGestureHandlerEvent && typeof onGestureHandlerEvent !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var gestureStateEventHandler = this._onGestureHandlerStateChange;
        var _this$props2 = this.props,
            onHandlerStateChange = _this$props2.onHandlerStateChange,
            onGestureHandlerStateChange = _this$props2.onGestureHandlerStateChange;

        if (onHandlerStateChange && typeof onHandlerStateChange !== 'function') {
          if (onGestureHandlerStateChange) {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }

          gestureStateEventHandler = this.props.onHandlerStateChange;
        } else {
          if (onGestureHandlerStateChange && typeof onGestureHandlerStateChange !== 'function') {
            throw new Error('Nesting touch handlers with native animated driver is not supported yet');
          }
        }

        var child = _react.default.Children.only(this.props.children);

        var grandChildren = child.props.children;

        if (_reactNative.Touchable.TOUCH_TARGET_DEBUG && child.type && (child.type === 'RNGestureHandlerButton' || child.type.name === 'View' || child.type.displayName === 'View')) {
          grandChildren = _react.default.Children.toArray(grandChildren);
          grandChildren.push(_reactNative.Touchable.renderDebugView({
            color: 'mediumspringgreen',
            hitSlop: child.props.hitSlop
          }));
        }

        return _react.default.cloneElement(child, {
          ref: this._refHandler,
          collapsable: false,
          onGestureHandlerEvent: gestureEventHandler,
          onGestureHandlerStateChange: gestureStateEventHandler
        }, grandChildren);
      }
    }]);
    return Handler;
  }(_react.default.Component);

  Handler.displayName = handlerName;
  Handler.propTypes = propTypes;
  return Handler;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUhhbmRsZXIuanMiXSwibmFtZXMiOlsiZmluZE5vZGVIYW5kbGUiLCJub2RlIiwiUGxhdGZvcm0iLCJPUyIsIk5hdGl2ZU1vZHVsZXMiLCJVSU1hbmFnZXIiLCJjdXN0b21HSEV2ZW50c0NvbmZpZyIsIm9uR2VzdHVyZUhhbmRsZXJFdmVudCIsInJlZ2lzdHJhdGlvbk5hbWUiLCJvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UiLCJnZW5lcmljRGlyZWN0RXZlbnRUeXBlcyIsImdldENvbnN0YW50cyIsInNldEpTUmVzcG9uZGVyIiwib2xkU2V0SlNSZXNwb25kZXIiLCJjbGVhckpTUmVzcG9uZGVyIiwib2xkQ2xlYXJKU1Jlc3BvbmRlciIsInRhZyIsImJsb2NrTmF0aXZlUmVzcG9uZGVyIiwiUk5HZXN0dXJlSGFuZGxlck1vZHVsZSIsImhhbmRsZVNldEpTUmVzcG9uZGVyIiwiaGFuZGxlQ2xlYXJKU1Jlc3BvbmRlciIsImhhbmRsZXJUYWciLCJoYW5kbGVySURUb1RhZyIsImlzQ29uZmlnUGFyYW0iLCJwYXJhbSIsIm5hbWUiLCJ1bmRlZmluZWQiLCJPYmplY3QiLCJmaWx0ZXJDb25maWciLCJwcm9wcyIsInZhbGlkUHJvcHMiLCJkZWZhdWx0cyIsInJlcyIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwidmFsdWUiLCJ0cmFuc2Zvcm1JbnRvSGFuZGxlclRhZ3MiLCJ0b3AiLCJsZWZ0IiwiYm90dG9tIiwicmlnaHQiLCJoYW5kbGVySURzIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiY3VycmVudCIsImZpbHRlciIsImhhbmRsZSIsImhhbmRsZXJJRCIsIl9oYW5kbGVyVGFnIiwiaGFzVW5yZXNvbHZlZFJlZnMiLCJleHRyYWN0IiwicmVmcyIsInNvbWUiLCJyIiwic3RhdGVUb1Byb3BNYXBwaW5ncyIsIlN0YXRlIiwiQkVHQU4iLCJGQUlMRUQiLCJDQU5DRUxMRUQiLCJBQ1RJVkUiLCJFTkQiLCJjcmVhdGVIYW5kbGVyIiwiaGFuZGxlck5hbWUiLCJwcm9wVHlwZXMiLCJjb25maWciLCJ0cmFuc2Zvcm1Qcm9wcyIsImN1c3RvbU5hdGl2ZVByb3BzIiwiSGFuZGxlciIsIl9vbkdlc3R1cmVIYW5kbGVyRXZlbnQiLCJldmVudCIsIm5hdGl2ZUV2ZW50Iiwib25HZXN0dXJlRXZlbnQiLCJfb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlIiwib25IYW5kbGVyU3RhdGVDaGFuZ2UiLCJzdGF0ZUV2ZW50TmFtZSIsInN0YXRlIiwiX3JlZkhhbmRsZXIiLCJfdmlld05vZGUiLCJjaGlsZCIsIlJlYWN0IiwiQ2hpbGRyZW4iLCJvbmx5IiwiY2hpbGRyZW4iLCJyZWYiLCJfY3JlYXRlR2VzdHVyZUhhbmRsZXIiLCJuZXdDb25maWciLCJfY29uZmlnIiwiY3JlYXRlR2VzdHVyZUhhbmRsZXIiLCJfYXR0YWNoR2VzdHVyZUhhbmRsZXIiLCJuZXdWaWV3VGFnIiwiX3ZpZXdUYWciLCJhdHRhY2hHZXN0dXJlSGFuZGxlciIsIl91cGRhdGVHZXN0dXJlSGFuZGxlciIsInVwZGF0ZUdlc3R1cmVIYW5kbGVyIiwiaWQiLCJFcnJvciIsImRyb3BHZXN0dXJlSGFuZGxlciIsIl91cGRhdGVFbnF1ZXVlZCIsImNsZWFySW1tZWRpYXRlIiwic2V0SW1tZWRpYXRlIiwiX3VwZGF0ZSIsImNvbnN0cnVjdG9yIiwidmlld1RhZyIsInVwZGF0ZXMiLCJtZXJnZWRQcm9wcyIsImdlc3R1cmVFdmVudEhhbmRsZXIiLCJnZXN0dXJlU3RhdGVFdmVudEhhbmRsZXIiLCJncmFuZENoaWxkcmVuIiwiVG91Y2hhYmxlIiwiVE9VQ0hfVEFSR0VUX0RFQlVHIiwidHlwZSIsImRpc3BsYXlOYW1lIiwidG9BcnJheSIsInB1c2giLCJyZW5kZXJEZWJ1Z1ZpZXciLCJjb2xvciIsImhpdFNsb3AiLCJjbG9uZUVsZW1lbnQiLCJjb2xsYXBzYWJsZSIsIkNvbXBvbmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQU1BOztBQUNBOztBQUNBOzs7Ozs7OztBQUVBLFNBQVNBLGNBQVQsQ0FBd0JDLElBQXhCLEVBQThCO0FBQzVCLE1BQUlDLHNCQUFTQyxFQUFULEtBQWdCLEtBQXBCLEVBQTJCLE9BQU9GLElBQVA7QUFDM0IsU0FBTyxpQ0FBaUJBLElBQWpCLENBQVA7QUFDRDs7NEJBRTBCRywwQixDQUFuQkMsUztJQUFBQSxTLHNDQUFZLEU7QUFFcEIsSUFBTUMsb0JBQW9CLEdBQUc7QUFDM0JDLEVBQUFBLHFCQUFxQixFQUFFO0FBQUVDLElBQUFBLGdCQUFnQixFQUFFO0FBQXBCLEdBREk7QUFFM0JDLEVBQUFBLDJCQUEyQixFQUFFO0FBQzNCRCxJQUFBQSxnQkFBZ0IsRUFBRTtBQURTO0FBRkYsQ0FBN0I7QUFXQUgsU0FBUyxDQUFDSyx1QkFBVixxQkFDS0wsU0FBUyxDQUFDSyx1QkFEZixNQUVLSixvQkFGTDs7QUFPQSxJQUFJRCxTQUFTLENBQUNNLFlBQWQsRUFBNEI7QUFDMUJOLEVBQUFBLFNBQVMsQ0FBQ00sWUFBVixHQUF5QkQsdUJBQXpCLHFCQUNLTCxTQUFTLENBQUNNLFlBQVYsR0FBeUJELHVCQUQ5QixNQUVLSixvQkFGTDtBQUlEOzs0QkFNR0QsUyxDQUZGTyxjO0lBQWdCQyxpQixzQ0FBb0IsWUFBTSxDQUFFLEM7NEJBRTFDUixTLENBREZTLGdCO0lBQWtCQyxtQixzQ0FBc0IsWUFBTSxDQUFFLEM7O0FBRWxEVixTQUFTLENBQUNPLGNBQVYsR0FBMkIsVUFBQ0ksR0FBRCxFQUFNQyxvQkFBTixFQUErQjtBQUN4REMsa0NBQXVCQyxvQkFBdkIsQ0FBNENILEdBQTVDLEVBQWlEQyxvQkFBakQ7O0FBQ0FKLEVBQUFBLGlCQUFpQixDQUFDRyxHQUFELEVBQU1DLG9CQUFOLENBQWpCO0FBQ0QsQ0FIRDs7QUFJQVosU0FBUyxDQUFDUyxnQkFBVixHQUE2QixZQUFNO0FBQ2pDSSxrQ0FBdUJFLHNCQUF2Qjs7QUFDQUwsRUFBQUEsbUJBQW1CO0FBQ3BCLENBSEQ7O0FBS0EsSUFBSU0sVUFBVSxHQUFHLENBQWpCO0FBQ0EsSUFBTUMsY0FBYyxHQUFHLEVBQXZCOztBQUVBLFNBQVNDLGFBQVQsQ0FBdUJDLEtBQXZCLEVBQThCQyxJQUE5QixFQUFvQztBQUdsQyxTQUNFRCxLQUFLLEtBQUtFLFNBQVYsS0FDQ0YsS0FBSyxLQUFLRyxNQUFNLENBQUNILEtBQUQsQ0FBaEIsSUFBMkIsRUFBRSxnQkFBZ0JBLEtBQWxCLENBRDVCLEtBRUFDLElBQUksS0FBSyxzQkFGVCxJQUdBQSxJQUFJLEtBQUssZ0JBSlg7QUFNRDs7QUFFRCxTQUFTRyxZQUFULENBQXNCQyxLQUF0QixFQUE2QkMsVUFBN0IsRUFBd0Q7QUFBQSxNQUFmQyxRQUFlLHVFQUFKLEVBQUk7O0FBQ3RELE1BQU1DLEdBQUcscUJBQVFELFFBQVIsQ0FBVDs7QUFDQUosRUFBQUEsTUFBTSxDQUFDTSxJQUFQLENBQVlILFVBQVosRUFBd0JJLE9BQXhCLENBQWdDLFVBQUFDLEdBQUcsRUFBSTtBQUNyQyxRQUFNQyxLQUFLLEdBQUdQLEtBQUssQ0FBQ00sR0FBRCxDQUFuQjs7QUFDQSxRQUFJWixhQUFhLENBQUNhLEtBQUQsRUFBUUQsR0FBUixDQUFqQixFQUErQjtBQUM3QixVQUFJQyxNQUFLLEdBQUdQLEtBQUssQ0FBQ00sR0FBRCxDQUFqQjs7QUFDQSxVQUFJQSxHQUFHLEtBQUssc0JBQVIsSUFBa0NBLEdBQUcsS0FBSyxTQUE5QyxFQUF5RDtBQUN2REMsUUFBQUEsTUFBSyxHQUFHQyx3QkFBd0IsQ0FBQ1IsS0FBSyxDQUFDTSxHQUFELENBQU4sQ0FBaEM7QUFDRCxPQUZELE1BRU8sSUFBSUEsR0FBRyxLQUFLLFNBQVosRUFBdUI7QUFDNUIsWUFBSSxPQUFPQyxNQUFQLEtBQWlCLFFBQXJCLEVBQStCO0FBQzdCQSxVQUFBQSxNQUFLLEdBQUc7QUFBRUUsWUFBQUEsR0FBRyxFQUFFRixNQUFQO0FBQWNHLFlBQUFBLElBQUksRUFBRUgsTUFBcEI7QUFBMkJJLFlBQUFBLE1BQU0sRUFBRUosTUFBbkM7QUFBMENLLFlBQUFBLEtBQUssRUFBRUw7QUFBakQsV0FBUjtBQUNEO0FBQ0Y7O0FBQ0RKLE1BQUFBLEdBQUcsQ0FBQ0csR0FBRCxDQUFILEdBQVdDLE1BQVg7QUFDRDtBQUNGLEdBYkQ7QUFjQSxTQUFPSixHQUFQO0FBQ0Q7O0FBRUQsU0FBU0ssd0JBQVQsQ0FBa0NLLFVBQWxDLEVBQThDO0FBQzVDLE1BQUksQ0FBQ0MsS0FBSyxDQUFDQyxPQUFOLENBQWNGLFVBQWQsQ0FBTCxFQUFnQztBQUM5QkEsSUFBQUEsVUFBVSxHQUFHLENBQUNBLFVBQUQsQ0FBYjtBQUNEOztBQUVELE1BQUl4QyxzQkFBU0MsRUFBVCxLQUFnQixLQUFwQixFQUEyQjtBQUN6QixXQUFPdUMsVUFBVSxDQUFDRyxHQUFYLENBQWU7QUFBQSxVQUFHQyxPQUFILFFBQUdBLE9BQUg7QUFBQSxhQUFpQkEsT0FBakI7QUFBQSxLQUFmLEVBQXlDQyxNQUF6QyxDQUFnRCxVQUFBQyxNQUFNO0FBQUEsYUFBSUEsTUFBSjtBQUFBLEtBQXRELENBQVA7QUFDRDs7QUFFRCxTQUFPTixVQUFVLENBQ2RHLEdBREksQ0FFSCxVQUFBSSxTQUFTO0FBQUEsV0FDUDNCLGNBQWMsQ0FBQzJCLFNBQUQsQ0FBZCxJQUNDQSxTQUFTLENBQUNILE9BQVYsSUFBcUJHLFNBQVMsQ0FBQ0gsT0FBVixDQUFrQkksV0FEeEMsSUFFQSxDQUFDLENBSE07QUFBQSxHQUZOLEVBT0pILE1BUEksQ0FPRyxVQUFBMUIsVUFBVTtBQUFBLFdBQUlBLFVBQVUsR0FBRyxDQUFqQjtBQUFBLEdBUGIsQ0FBUDtBQVFEOztBQUVELFNBQVM4QixpQkFBVCxDQUEyQnRCLEtBQTNCLEVBQWtDO0FBQ2hDLE1BQU11QixPQUFPLEdBQUcsU0FBVkEsT0FBVSxDQUFBQyxJQUFJLEVBQUk7QUFDdEIsUUFBSSxDQUFDVixLQUFLLENBQUNDLE9BQU4sQ0FBY1MsSUFBZCxDQUFMLEVBQTBCO0FBQ3hCLGFBQU9BLElBQUksSUFBSUEsSUFBSSxDQUFDUCxPQUFMLEtBQWlCLElBQWhDO0FBQ0Q7O0FBQ0QsV0FBT08sSUFBSSxDQUFDQyxJQUFMLENBQVUsVUFBQUMsQ0FBQztBQUFBLGFBQUlBLENBQUMsSUFBSUEsQ0FBQyxDQUFDVCxPQUFGLEtBQWMsSUFBdkI7QUFBQSxLQUFYLENBQVA7QUFDRCxHQUxEOztBQU1BLFNBQU9NLE9BQU8sQ0FBQ3ZCLEtBQUssQ0FBQyxzQkFBRCxDQUFOLENBQVAsSUFBMEN1QixPQUFPLENBQUN2QixLQUFLLENBQUMsU0FBRCxDQUFOLENBQXhEO0FBQ0Q7O0FBRUQsSUFBTTJCLG1CQUFtQixtRkFDdEJDLGVBQU1DLEtBRGdCLEVBQ1IsU0FEUSx1REFFdEJELGVBQU1FLE1BRmdCLEVBRVAsVUFGTyx1REFHdEJGLGVBQU1HLFNBSGdCLEVBR0osYUFISSx1REFJdEJILGVBQU1JLE1BSmdCLEVBSVAsYUFKTyx1REFLdEJKLGVBQU1LLEdBTGdCLEVBS1YsU0FMVSx3QkFBekI7O0FBUWUsU0FBU0MsYUFBVCxDQUNiQyxXQURhLEVBTWI7QUFBQSxNQUpBQyxTQUlBLHVFQUpZLEVBSVo7QUFBQSxNQUhBQyxNQUdBLHVFQUhTLEVBR1Q7QUFBQSxNQUZBQyxjQUVBO0FBQUEsTUFEQUMsaUJBQ0EsdUVBRG9CLEVBQ3BCOztBQUFBLE1BQ01DLE9BRE47QUFBQTs7QUFNRSxxQkFBWXhDLEtBQVosRUFBbUI7QUFBQTs7QUFBQTtBQUNqQiwrR0FBTUEsS0FBTjs7QUFEaUIsWUFZbkJ5QyxzQkFabUIsR0FZTSxVQUFBQyxLQUFLLEVBQUk7QUFDaEMsWUFBSUEsS0FBSyxDQUFDQyxXQUFOLENBQWtCbkQsVUFBbEIsS0FBaUMsTUFBSzZCLFdBQTFDLEVBQXVEO0FBQ3JELGdCQUFLckIsS0FBTCxDQUFXNEMsY0FBWCxJQUE2QixNQUFLNUMsS0FBTCxDQUFXNEMsY0FBWCxDQUEwQkYsS0FBMUIsQ0FBN0I7QUFDRCxTQUZELE1BRU87QUFDTCxnQkFBSzFDLEtBQUwsQ0FBV3RCLHFCQUFYLElBQ0UsTUFBS3NCLEtBQUwsQ0FBV3RCLHFCQUFYLENBQWlDZ0UsS0FBakMsQ0FERjtBQUVEO0FBQ0YsT0FuQmtCOztBQUFBLFlBcUJuQkcsNEJBckJtQixHQXFCWSxVQUFBSCxLQUFLLEVBQUk7QUFDdEMsWUFBSUEsS0FBSyxDQUFDQyxXQUFOLENBQWtCbkQsVUFBbEIsS0FBaUMsTUFBSzZCLFdBQTFDLEVBQXVEO0FBQ3JELGdCQUFLckIsS0FBTCxDQUFXOEMsb0JBQVgsSUFDRSxNQUFLOUMsS0FBTCxDQUFXOEMsb0JBQVgsQ0FBZ0NKLEtBQWhDLENBREY7QUFHQSxjQUFNSyxjQUFjLEdBQUdwQixtQkFBbUIsQ0FBQ2UsS0FBSyxDQUFDQyxXQUFOLENBQWtCSyxLQUFuQixDQUExQzs7QUFDQSxjQUFJLE9BQU8sTUFBS2hELEtBQUwsQ0FBVytDLGNBQVgsQ0FBUCxLQUFzQyxVQUExQyxFQUFzRDtBQUNwRCxrQkFBSy9DLEtBQUwsQ0FBVytDLGNBQVgsRUFBMkJMLEtBQTNCO0FBQ0Q7QUFDRixTQVJELE1BUU87QUFDTCxnQkFBSzFDLEtBQUwsQ0FBV3BCLDJCQUFYLElBQ0UsTUFBS29CLEtBQUwsQ0FBV3BCLDJCQUFYLENBQXVDOEQsS0FBdkMsQ0FERjtBQUVEO0FBQ0YsT0FsQ2tCOztBQUFBLFlBb0NuQk8sV0FwQ21CLEdBb0NMLFVBQUE3RSxJQUFJLEVBQUk7QUFDcEIsY0FBSzhFLFNBQUwsR0FBaUI5RSxJQUFqQjs7QUFFQSxZQUFNK0UsS0FBSyxHQUFHQyxlQUFNQyxRQUFOLENBQWVDLElBQWYsQ0FBb0IsTUFBS3RELEtBQUwsQ0FBV3VELFFBQS9CLENBQWQ7O0FBSG9CLFlBSVpDLEdBSlksR0FJSkwsS0FKSSxDQUlaSyxHQUpZOztBQUtwQixZQUFJQSxHQUFHLEtBQUssSUFBWixFQUFrQjtBQUNoQixjQUFJLE9BQU9BLEdBQVAsS0FBZSxVQUFuQixFQUErQjtBQUM3QkEsWUFBQUEsR0FBRyxDQUFDcEYsSUFBRCxDQUFIO0FBQ0QsV0FGRCxNQUVPO0FBQ0xvRixZQUFBQSxHQUFHLENBQUN2QyxPQUFKLEdBQWM3QyxJQUFkO0FBQ0Q7QUFDRjtBQUNGLE9BaERrQjs7QUFBQSxZQWtEbkJxRixxQkFsRG1CLEdBa0RLLFVBQUFDLFNBQVMsRUFBSTtBQUNuQyxjQUFLQyxPQUFMLEdBQWVELFNBQWY7O0FBRUFyRSx3Q0FBdUJ1RSxvQkFBdkIsQ0FDRXpCLFdBREYsRUFFRSxNQUFLZCxXQUZQLEVBR0VxQyxTQUhGO0FBS0QsT0ExRGtCOztBQUFBLFlBNERuQkcscUJBNURtQixHQTRESyxVQUFBQyxVQUFVLEVBQUk7QUFDcEMsY0FBS0MsUUFBTCxHQUFnQkQsVUFBaEI7O0FBRUF6RSx3Q0FBdUIyRSxvQkFBdkIsQ0FBNEMsTUFBSzNDLFdBQWpELEVBQThEeUMsVUFBOUQ7QUFDRCxPQWhFa0I7O0FBQUEsWUFrRW5CRyxxQkFsRW1CLEdBa0VLLFVBQUFQLFNBQVMsRUFBSTtBQUNuQyxjQUFLQyxPQUFMLEdBQWVELFNBQWY7O0FBRUFyRSx3Q0FBdUI2RSxvQkFBdkIsQ0FBNEMsTUFBSzdDLFdBQWpELEVBQThEcUMsU0FBOUQ7QUFDRCxPQXRFa0I7O0FBRWpCLFlBQUtyQyxXQUFMLEdBQW1CN0IsVUFBVSxFQUE3QjtBQUNBLFlBQUttRSxPQUFMLEdBQWUsRUFBZjs7QUFDQSxVQUFJM0QsS0FBSyxDQUFDbUUsRUFBVixFQUFjO0FBQ1osWUFBSTFFLGNBQWMsQ0FBQ08sS0FBSyxDQUFDbUUsRUFBUCxDQUFkLEtBQTZCdEUsU0FBakMsRUFBNEM7QUFDMUMsZ0JBQU0sSUFBSXVFLEtBQUosd0JBQThCcEUsS0FBSyxDQUFDbUUsRUFBcEMsMkJBQU47QUFDRDs7QUFDRDFFLFFBQUFBLGNBQWMsQ0FBQ08sS0FBSyxDQUFDbUUsRUFBUCxDQUFkLEdBQTJCLE1BQUs5QyxXQUFoQztBQUNEOztBQVRnQjtBQVVsQjs7QUFoQkg7QUFBQTtBQUFBLDZDQThFeUI7QUFDckJoQyx3Q0FBdUJnRixrQkFBdkIsQ0FBMEMsS0FBS2hELFdBQS9DOztBQUNBLFlBQUksS0FBS2lELGVBQVQsRUFBMEI7QUFDeEJDLFVBQUFBLGNBQWMsQ0FBQyxLQUFLRCxlQUFOLENBQWQ7QUFDRDs7QUFDRCxZQUFJLEtBQUt0RSxLQUFMLENBQVdtRSxFQUFmLEVBQW1CO0FBQ2pCLGlCQUFPMUUsY0FBYyxDQUFDLEtBQUtPLEtBQUwsQ0FBV21FLEVBQVosQ0FBckI7QUFDRDtBQUNGO0FBdEZIO0FBQUE7QUFBQSwwQ0F3RnNCO0FBQUE7O0FBQ2xCLFlBQUk3QyxpQkFBaUIsQ0FBQyxLQUFLdEIsS0FBTixDQUFyQixFQUFtQztBQU9qQyxlQUFLc0UsZUFBTCxHQUF1QkUsWUFBWSxDQUFDLFlBQU07QUFDeEMsWUFBQSxNQUFJLENBQUNGLGVBQUwsR0FBdUIsSUFBdkI7O0FBQ0EsWUFBQSxNQUFJLENBQUNHLE9BQUw7QUFDRCxXQUhrQyxDQUFuQztBQUlEOztBQUVELGFBQUtoQixxQkFBTCxDQUNFMUQsWUFBWSxDQUNWdUMsY0FBYyxHQUFHQSxjQUFjLENBQUMsS0FBS3RDLEtBQU4sQ0FBakIsR0FBZ0MsS0FBS0EsS0FEekMsb0JBRUwsS0FBSzBFLFdBQUwsQ0FBaUJ0QyxTQUZaLE1BRTBCRyxpQkFGMUIsR0FHVkYsTUFIVSxDQURkOztBQU9BLGFBQUt3QixxQkFBTCxDQUEyQjFGLGNBQWMsQ0FBQyxLQUFLK0UsU0FBTixDQUF6QztBQUNEO0FBOUdIO0FBQUE7QUFBQSwyQ0FnSHVCO0FBQ25CLFlBQU15QixPQUFPLEdBQUd4RyxjQUFjLENBQUMsS0FBSytFLFNBQU4sQ0FBOUI7O0FBQ0EsWUFBSSxLQUFLYSxRQUFMLEtBQWtCWSxPQUF0QixFQUErQjtBQUM3QixlQUFLZCxxQkFBTCxDQUEyQmMsT0FBM0I7QUFDRDs7QUFDRCxhQUFLRixPQUFMO0FBQ0Q7QUF0SEg7QUFBQTtBQUFBLGdDQXdIWTtBQUNSLFlBQU1mLFNBQVMsR0FBRzNELFlBQVksQ0FDNUJ1QyxjQUFjLEdBQUdBLGNBQWMsQ0FBQyxLQUFLdEMsS0FBTixDQUFqQixHQUFnQyxLQUFLQSxLQUR2QixvQkFFdkIsS0FBSzBFLFdBQUwsQ0FBaUJ0QyxTQUZNLE1BRVFHLGlCQUZSLEdBRzVCRixNQUg0QixDQUE5Qjs7QUFLQSxZQUFJLENBQUMsdUJBQVUsS0FBS3NCLE9BQWYsRUFBd0JELFNBQXhCLENBQUwsRUFBeUM7QUFDdkMsZUFBS08scUJBQUwsQ0FBMkJQLFNBQTNCO0FBQ0Q7QUFDRjtBQWpJSDtBQUFBO0FBQUEscUNBbUlpQmtCLE9BbklqQixFQW1JMEI7QUFDdEIsWUFBTUMsV0FBVyxxQkFBUSxLQUFLN0UsS0FBYixNQUF1QjRFLE9BQXZCLENBQWpCOztBQUNBLFlBQU1sQixTQUFTLEdBQUczRCxZQUFZLENBQzVCdUMsY0FBYyxHQUFHQSxjQUFjLENBQUN1QyxXQUFELENBQWpCLEdBQWlDQSxXQURuQixvQkFFdkIsS0FBS0gsV0FBTCxDQUFpQnRDLFNBRk0sTUFFUUcsaUJBRlIsR0FHNUJGLE1BSDRCLENBQTlCOztBQUtBLGFBQUs0QixxQkFBTCxDQUEyQlAsU0FBM0I7QUFDRDtBQTNJSDtBQUFBO0FBQUEsK0JBNklXO0FBQ1AsWUFBSW9CLG1CQUFtQixHQUFHLEtBQUtyQyxzQkFBL0I7QUFETywwQkFFMkMsS0FBS3pDLEtBRmhEO0FBQUEsWUFFQzRDLGNBRkQsZUFFQ0EsY0FGRDtBQUFBLFlBRWlCbEUscUJBRmpCLGVBRWlCQSxxQkFGakI7O0FBR1AsWUFBSWtFLGNBQWMsSUFBSSxPQUFPQSxjQUFQLEtBQTBCLFVBQWhELEVBQTREO0FBSTFELGNBQUlsRSxxQkFBSixFQUEyQjtBQUN6QixrQkFBTSxJQUFJMEYsS0FBSixDQUNKLHlFQURJLENBQU47QUFHRDs7QUFDRFUsVUFBQUEsbUJBQW1CLEdBQUcsS0FBSzlFLEtBQUwsQ0FBVzRDLGNBQWpDO0FBQ0QsU0FWRCxNQVVPO0FBQ0wsY0FDRWxFLHFCQUFxQixJQUNyQixPQUFPQSxxQkFBUCxLQUFpQyxVQUZuQyxFQUdFO0FBQ0Esa0JBQU0sSUFBSTBGLEtBQUosQ0FDSix5RUFESSxDQUFOO0FBR0Q7QUFDRjs7QUFFRCxZQUFJVyx3QkFBd0IsR0FBRyxLQUFLbEMsNEJBQXBDO0FBeEJPLDJCQXlCdUQsS0FBSzdDLEtBekI1RDtBQUFBLFlBeUJDOEMsb0JBekJELGdCQXlCQ0Esb0JBekJEO0FBQUEsWUF5QnVCbEUsMkJBekJ2QixnQkF5QnVCQSwyQkF6QnZCOztBQTBCUCxZQUFJa0Usb0JBQW9CLElBQUksT0FBT0Esb0JBQVAsS0FBZ0MsVUFBNUQsRUFBd0U7QUFJdEUsY0FBSWxFLDJCQUFKLEVBQWlDO0FBQy9CLGtCQUFNLElBQUl3RixLQUFKLENBQ0oseUVBREksQ0FBTjtBQUdEOztBQUNEVyxVQUFBQSx3QkFBd0IsR0FBRyxLQUFLL0UsS0FBTCxDQUFXOEMsb0JBQXRDO0FBQ0QsU0FWRCxNQVVPO0FBQ0wsY0FDRWxFLDJCQUEyQixJQUMzQixPQUFPQSwyQkFBUCxLQUF1QyxVQUZ6QyxFQUdFO0FBQ0Esa0JBQU0sSUFBSXdGLEtBQUosQ0FDSix5RUFESSxDQUFOO0FBR0Q7QUFDRjs7QUFFRCxZQUFNakIsS0FBSyxHQUFHQyxlQUFNQyxRQUFOLENBQWVDLElBQWYsQ0FBb0IsS0FBS3RELEtBQUwsQ0FBV3VELFFBQS9CLENBQWQ7O0FBQ0EsWUFBSXlCLGFBQWEsR0FBRzdCLEtBQUssQ0FBQ25ELEtBQU4sQ0FBWXVELFFBQWhDOztBQUNBLFlBQ0UwQix1QkFBVUMsa0JBQVYsSUFDQS9CLEtBQUssQ0FBQ2dDLElBRE4sS0FFQ2hDLEtBQUssQ0FBQ2dDLElBQU4sS0FBZSx3QkFBZixJQUNDaEMsS0FBSyxDQUFDZ0MsSUFBTixDQUFXdkYsSUFBWCxLQUFvQixNQURyQixJQUVDdUQsS0FBSyxDQUFDZ0MsSUFBTixDQUFXQyxXQUFYLEtBQTJCLE1BSjdCLENBREYsRUFNRTtBQUNBSixVQUFBQSxhQUFhLEdBQUc1QixlQUFNQyxRQUFOLENBQWVnQyxPQUFmLENBQXVCTCxhQUF2QixDQUFoQjtBQUNBQSxVQUFBQSxhQUFhLENBQUNNLElBQWQsQ0FDRUwsdUJBQVVNLGVBQVYsQ0FBMEI7QUFDeEJDLFlBQUFBLEtBQUssRUFBRSxtQkFEaUI7QUFFeEJDLFlBQUFBLE9BQU8sRUFBRXRDLEtBQUssQ0FBQ25ELEtBQU4sQ0FBWXlGO0FBRkcsV0FBMUIsQ0FERjtBQU1EOztBQUNELGVBQU9yQyxlQUFNc0MsWUFBTixDQUNMdkMsS0FESyxFQUVMO0FBQ0VLLFVBQUFBLEdBQUcsRUFBRSxLQUFLUCxXQURaO0FBRUUwQyxVQUFBQSxXQUFXLEVBQUUsS0FGZjtBQUdFakgsVUFBQUEscUJBQXFCLEVBQUVvRyxtQkFIekI7QUFJRWxHLFVBQUFBLDJCQUEyQixFQUFFbUc7QUFKL0IsU0FGSyxFQVFMQyxhQVJLLENBQVA7QUFVRDtBQXZOSDtBQUFBO0FBQUEsSUFDc0I1QixlQUFNd0MsU0FENUI7O0FBQ01wRCxFQUFBQSxPQUROLENBRVM0QyxXQUZULEdBRXVCakQsV0FGdkI7QUFDTUssRUFBQUEsT0FETixDQUlTSixTQUpULEdBSXFCQSxTQUpyQjtBQXlOQSxTQUFPSSxPQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgZmluZE5vZGVIYW5kbGUgYXMgZmluZE5vZGVIYW5kbGVSTixcbiAgTmF0aXZlTW9kdWxlcyxcbiAgVG91Y2hhYmxlLFxuICBQbGF0Zm9ybSxcbn0gZnJvbSAncmVhY3QtbmF0aXZlJztcbmltcG9ydCBkZWVwRXF1YWwgZnJvbSAnZmJqcy9saWIvYXJlRXF1YWwnO1xuaW1wb3J0IFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUgZnJvbSAnLi9STkdlc3R1cmVIYW5kbGVyTW9kdWxlJztcbmltcG9ydCBTdGF0ZSBmcm9tICcuL1N0YXRlJztcblxuZnVuY3Rpb24gZmluZE5vZGVIYW5kbGUobm9kZSkge1xuICBpZiAoUGxhdGZvcm0uT1MgPT09ICd3ZWInKSByZXR1cm4gbm9kZTtcbiAgcmV0dXJuIGZpbmROb2RlSGFuZGxlUk4obm9kZSk7XG59XG5cbmNvbnN0IHsgVUlNYW5hZ2VyID0ge30gfSA9IE5hdGl2ZU1vZHVsZXM7XG5cbmNvbnN0IGN1c3RvbUdIRXZlbnRzQ29uZmlnID0ge1xuICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ6IHsgcmVnaXN0cmF0aW9uTmFtZTogJ29uR2VzdHVyZUhhbmRsZXJFdmVudCcgfSxcbiAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlOiB7XG4gICAgcmVnaXN0cmF0aW9uTmFtZTogJ29uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZScsXG4gIH0sXG59O1xuXG4vLyBBZGQgZ2VzdHVyZSBzcGVjaWZpYyBldmVudHMgdG8gZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMgb2JqZWN0IGV4cG9ydGVkIGZyb20gVUlNYW5hZ2VyXG4vLyBuYXRpdmUgbW9kdWxlLlxuLy8gT25jZSBuZXcgZXZlbnQgdHlwZXMgYXJlIHJlZ2lzdGVyZWQgd2l0aCByZWFjdCBpdCBpcyBwb3NzaWJsZSB0byBkaXNwYXRjaCB0aGVzZVxuLy8gZXZlbnRzIHRvIGFsbCBraW5kIG9mIG5hdGl2ZSB2aWV3cy5cblVJTWFuYWdlci5nZW5lcmljRGlyZWN0RXZlbnRUeXBlcyA9IHtcbiAgLi4uVUlNYW5hZ2VyLmdlbmVyaWNEaXJlY3RFdmVudFR5cGVzLFxuICAuLi5jdXN0b21HSEV2ZW50c0NvbmZpZyxcbn07XG4vLyBJbiBuZXdlciB2ZXJzaW9ucyBvZiBSTiB0aGUgYGdlbmVyaWNEaXJlY3RFdmVudFR5cGVzYCBpcyBsb2NhdGVkIGluIHRoZSBvYmplY3Rcbi8vIHJldHVybmVkIGJ5IFVJTWFuYWdlci5nZXRDb25zdGFudHMoKSwgd2UgbmVlZCB0byBhZGQgaXQgdGhlcmUgYXMgd2VsbCB0byBtYWtlXG4vLyBpdCBjb21wYXRpYmxlIHdpdGggUk4gNjErXG5pZiAoVUlNYW5hZ2VyLmdldENvbnN0YW50cykge1xuICBVSU1hbmFnZXIuZ2V0Q29uc3RhbnRzKCkuZ2VuZXJpY0RpcmVjdEV2ZW50VHlwZXMgPSB7XG4gICAgLi4uVUlNYW5hZ2VyLmdldENvbnN0YW50cygpLmdlbmVyaWNEaXJlY3RFdmVudFR5cGVzLFxuICAgIC4uLmN1c3RvbUdIRXZlbnRzQ29uZmlnLFxuICB9O1xufVxuXG4vLyBXcmFwIEpTIHJlc3BvbmRlciBjYWxscyBhbmQgbm90aWZ5IGdlc3R1cmUgaGFuZGxlciBtYW5hZ2VyXG5jb25zdCB7XG4gIHNldEpTUmVzcG9uZGVyOiBvbGRTZXRKU1Jlc3BvbmRlciA9ICgpID0+IHt9LFxuICBjbGVhckpTUmVzcG9uZGVyOiBvbGRDbGVhckpTUmVzcG9uZGVyID0gKCkgPT4ge30sXG59ID0gVUlNYW5hZ2VyO1xuVUlNYW5hZ2VyLnNldEpTUmVzcG9uZGVyID0gKHRhZywgYmxvY2tOYXRpdmVSZXNwb25kZXIpID0+IHtcbiAgUk5HZXN0dXJlSGFuZGxlck1vZHVsZS5oYW5kbGVTZXRKU1Jlc3BvbmRlcih0YWcsIGJsb2NrTmF0aXZlUmVzcG9uZGVyKTtcbiAgb2xkU2V0SlNSZXNwb25kZXIodGFnLCBibG9ja05hdGl2ZVJlc3BvbmRlcik7XG59O1xuVUlNYW5hZ2VyLmNsZWFySlNSZXNwb25kZXIgPSAoKSA9PiB7XG4gIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuaGFuZGxlQ2xlYXJKU1Jlc3BvbmRlcigpO1xuICBvbGRDbGVhckpTUmVzcG9uZGVyKCk7XG59O1xuXG5sZXQgaGFuZGxlclRhZyA9IDE7XG5jb25zdCBoYW5kbGVySURUb1RhZyA9IHt9O1xuXG5mdW5jdGlvbiBpc0NvbmZpZ1BhcmFtKHBhcmFtLCBuYW1lKSB7XG4gIC8vIHBhcmFtICE9PSBPYmplY3QocGFyYW0pIHJldHVybnMgZmFsc2UgaWYgYHBhcmFtYCBpcyBhIGZ1bmN0aW9uXG4gIC8vIG9yIGFuIG9iamVjdCBhbmQgcmV0dXJucyB0cnVlIGlmIGBwYXJhbWAgaXMgbnVsbFxuICByZXR1cm4gKFxuICAgIHBhcmFtICE9PSB1bmRlZmluZWQgJiZcbiAgICAocGFyYW0gIT09IE9iamVjdChwYXJhbSkgfHwgISgnX19pc05hdGl2ZScgaW4gcGFyYW0pKSAmJlxuICAgIG5hbWUgIT09ICdvbkhhbmRsZXJTdGF0ZUNoYW5nZScgJiZcbiAgICBuYW1lICE9PSAnb25HZXN0dXJlRXZlbnQnXG4gICk7XG59XG5cbmZ1bmN0aW9uIGZpbHRlckNvbmZpZyhwcm9wcywgdmFsaWRQcm9wcywgZGVmYXVsdHMgPSB7fSkge1xuICBjb25zdCByZXMgPSB7IC4uLmRlZmF1bHRzIH07XG4gIE9iamVjdC5rZXlzKHZhbGlkUHJvcHMpLmZvckVhY2goa2V5ID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IHByb3BzW2tleV07XG4gICAgaWYgKGlzQ29uZmlnUGFyYW0odmFsdWUsIGtleSkpIHtcbiAgICAgIGxldCB2YWx1ZSA9IHByb3BzW2tleV07XG4gICAgICBpZiAoa2V5ID09PSAnc2ltdWx0YW5lb3VzSGFuZGxlcnMnIHx8IGtleSA9PT0gJ3dhaXRGb3InKSB7XG4gICAgICAgIHZhbHVlID0gdHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzKHByb3BzW2tleV0pO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdoaXRTbG9wJykge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgIHZhbHVlID0geyB0b3A6IHZhbHVlLCBsZWZ0OiB2YWx1ZSwgYm90dG9tOiB2YWx1ZSwgcmlnaHQ6IHZhbHVlIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJlc1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHJlcztcbn1cblxuZnVuY3Rpb24gdHJhbnNmb3JtSW50b0hhbmRsZXJUYWdzKGhhbmRsZXJJRHMpIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGhhbmRsZXJJRHMpKSB7XG4gICAgaGFuZGxlcklEcyA9IFtoYW5kbGVySURzXTtcbiAgfVxuXG4gIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ3dlYicpIHtcbiAgICByZXR1cm4gaGFuZGxlcklEcy5tYXAoKHsgY3VycmVudCB9KSA9PiBjdXJyZW50KS5maWx0ZXIoaGFuZGxlID0+IGhhbmRsZSk7XG4gIH1cbiAgLy8gY29udmVydHMgaGFuZGxlciBzdHJpbmcgSURzIGludG8gdGhlaXIgbnVtZXJpYyB0YWdzXG4gIHJldHVybiBoYW5kbGVySURzXG4gICAgLm1hcChcbiAgICAgIGhhbmRsZXJJRCA9PlxuICAgICAgICBoYW5kbGVySURUb1RhZ1toYW5kbGVySURdIHx8XG4gICAgICAgIChoYW5kbGVySUQuY3VycmVudCAmJiBoYW5kbGVySUQuY3VycmVudC5faGFuZGxlclRhZykgfHxcbiAgICAgICAgLTFcbiAgICApXG4gICAgLmZpbHRlcihoYW5kbGVyVGFnID0+IGhhbmRsZXJUYWcgPiAwKTtcbn1cblxuZnVuY3Rpb24gaGFzVW5yZXNvbHZlZFJlZnMocHJvcHMpIHtcbiAgY29uc3QgZXh0cmFjdCA9IHJlZnMgPT4ge1xuICAgIGlmICghQXJyYXkuaXNBcnJheShyZWZzKSkge1xuICAgICAgcmV0dXJuIHJlZnMgJiYgcmVmcy5jdXJyZW50ID09PSBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcmVmcy5zb21lKHIgPT4gciAmJiByLmN1cnJlbnQgPT09IG51bGwpO1xuICB9O1xuICByZXR1cm4gZXh0cmFjdChwcm9wc1snc2ltdWx0YW5lb3VzSGFuZGxlcnMnXSkgfHwgZXh0cmFjdChwcm9wc1snd2FpdEZvciddKTtcbn1cblxuY29uc3Qgc3RhdGVUb1Byb3BNYXBwaW5ncyA9IHtcbiAgW1N0YXRlLkJFR0FOXTogJ29uQmVnYW4nLFxuICBbU3RhdGUuRkFJTEVEXTogJ29uRmFpbGVkJyxcbiAgW1N0YXRlLkNBTkNFTExFRF06ICdvbkNhbmNlbGxlZCcsXG4gIFtTdGF0ZS5BQ1RJVkVdOiAnb25BY3RpdmF0ZWQnLFxuICBbU3RhdGUuRU5EXTogJ29uRW5kZWQnLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlSGFuZGxlcihcbiAgaGFuZGxlck5hbWUsXG4gIHByb3BUeXBlcyA9IHt9LFxuICBjb25maWcgPSB7fSxcbiAgdHJhbnNmb3JtUHJvcHMsXG4gIGN1c3RvbU5hdGl2ZVByb3BzID0ge31cbikge1xuICBjbGFzcyBIYW5kbGVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgICBzdGF0aWMgZGlzcGxheU5hbWUgPSBoYW5kbGVyTmFtZTtcblxuICAgIHN0YXRpYyBwcm9wVHlwZXMgPSBwcm9wVHlwZXM7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgc3VwZXIocHJvcHMpO1xuICAgICAgdGhpcy5faGFuZGxlclRhZyA9IGhhbmRsZXJUYWcrKztcbiAgICAgIHRoaXMuX2NvbmZpZyA9IHt9O1xuICAgICAgaWYgKHByb3BzLmlkKSB7XG4gICAgICAgIGlmIChoYW5kbGVySURUb1RhZ1twcm9wcy5pZF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSGFuZGxlciB3aXRoIElEIFwiJHtwcm9wcy5pZH1cIiBhbHJlYWR5IHJlZ2lzdGVyZWRgKTtcbiAgICAgICAgfVxuICAgICAgICBoYW5kbGVySURUb1RhZ1twcm9wcy5pZF0gPSB0aGlzLl9oYW5kbGVyVGFnO1xuICAgICAgfVxuICAgIH1cblxuICAgIF9vbkdlc3R1cmVIYW5kbGVyRXZlbnQgPSBldmVudCA9PiB7XG4gICAgICBpZiAoZXZlbnQubmF0aXZlRXZlbnQuaGFuZGxlclRhZyA9PT0gdGhpcy5faGFuZGxlclRhZykge1xuICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUV2ZW50ICYmIHRoaXMucHJvcHMub25HZXN0dXJlRXZlbnQoZXZlbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkdlc3R1cmVIYW5kbGVyRXZlbnQgJiZcbiAgICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUhhbmRsZXJFdmVudChldmVudCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIF9vbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UgPSBldmVudCA9PiB7XG4gICAgICBpZiAoZXZlbnQubmF0aXZlRXZlbnQuaGFuZGxlclRhZyA9PT0gdGhpcy5faGFuZGxlclRhZykge1xuICAgICAgICB0aGlzLnByb3BzLm9uSGFuZGxlclN0YXRlQ2hhbmdlICYmXG4gICAgICAgICAgdGhpcy5wcm9wcy5vbkhhbmRsZXJTdGF0ZUNoYW5nZShldmVudCk7XG5cbiAgICAgICAgY29uc3Qgc3RhdGVFdmVudE5hbWUgPSBzdGF0ZVRvUHJvcE1hcHBpbmdzW2V2ZW50Lm5hdGl2ZUV2ZW50LnN0YXRlXTtcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnByb3BzW3N0YXRlRXZlbnROYW1lXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIHRoaXMucHJvcHNbc3RhdGVFdmVudE5hbWVdKGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5wcm9wcy5vbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UgJiZcbiAgICAgICAgICB0aGlzLnByb3BzLm9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZShldmVudCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIF9yZWZIYW5kbGVyID0gbm9kZSA9PiB7XG4gICAgICB0aGlzLl92aWV3Tm9kZSA9IG5vZGU7XG5cbiAgICAgIGNvbnN0IGNoaWxkID0gUmVhY3QuQ2hpbGRyZW4ub25seSh0aGlzLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgIGNvbnN0IHsgcmVmIH0gPSBjaGlsZDtcbiAgICAgIGlmIChyZWYgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKHR5cGVvZiByZWYgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICByZWYobm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVmLmN1cnJlbnQgPSBub2RlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIF9jcmVhdGVHZXN0dXJlSGFuZGxlciA9IG5ld0NvbmZpZyA9PiB7XG4gICAgICB0aGlzLl9jb25maWcgPSBuZXdDb25maWc7XG5cbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuY3JlYXRlR2VzdHVyZUhhbmRsZXIoXG4gICAgICAgIGhhbmRsZXJOYW1lLFxuICAgICAgICB0aGlzLl9oYW5kbGVyVGFnLFxuICAgICAgICBuZXdDb25maWdcbiAgICAgICk7XG4gICAgfTtcblxuICAgIF9hdHRhY2hHZXN0dXJlSGFuZGxlciA9IG5ld1ZpZXdUYWcgPT4ge1xuICAgICAgdGhpcy5fdmlld1RhZyA9IG5ld1ZpZXdUYWc7XG5cbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUuYXR0YWNoR2VzdHVyZUhhbmRsZXIodGhpcy5faGFuZGxlclRhZywgbmV3Vmlld1RhZyk7XG4gICAgfTtcblxuICAgIF91cGRhdGVHZXN0dXJlSGFuZGxlciA9IG5ld0NvbmZpZyA9PiB7XG4gICAgICB0aGlzLl9jb25maWcgPSBuZXdDb25maWc7XG5cbiAgICAgIFJOR2VzdHVyZUhhbmRsZXJNb2R1bGUudXBkYXRlR2VzdHVyZUhhbmRsZXIodGhpcy5faGFuZGxlclRhZywgbmV3Q29uZmlnKTtcbiAgICB9O1xuXG4gICAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgICBSTkdlc3R1cmVIYW5kbGVyTW9kdWxlLmRyb3BHZXN0dXJlSGFuZGxlcih0aGlzLl9oYW5kbGVyVGFnKTtcbiAgICAgIGlmICh0aGlzLl91cGRhdGVFbnF1ZXVlZCkge1xuICAgICAgICBjbGVhckltbWVkaWF0ZSh0aGlzLl91cGRhdGVFbnF1ZXVlZCk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5wcm9wcy5pZCkge1xuICAgICAgICBkZWxldGUgaGFuZGxlcklEVG9UYWdbdGhpcy5wcm9wcy5pZF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgICBpZiAoaGFzVW5yZXNvbHZlZFJlZnModGhpcy5wcm9wcykpIHtcbiAgICAgICAgLy8gSWYgdGhlcmUgYXJlIHVucmVzb2x2ZWQgcmVmcyAoZS5nLiBcIi5jdXJyZW50XCIgaGFzIG5vdCB5ZXQgYmVlbiBzZXQpXG4gICAgICAgIC8vIHBhc3NlZCBhcyBgc2ltdWx0YW5lb3VzSGFuZGxlcnNgIG9yIGB3YWl0Rm9yYCwgd2UgZW5xdWV1ZSBhIGNhbGwgdG9cbiAgICAgICAgLy8gX3VwZGF0ZSBtZXRob2QgdGhhdCB3aWxsIHRyeSB0byB1cGRhdGUgbmF0aXZlIGhhbmRsZXIgcHJvcHMgdXNpbmdcbiAgICAgICAgLy8gc2V0SW1tZWRpYXRlLiBUaGlzIG1ha2VzIGl0IHNvIF91cGRhdGUgZnVuY3Rpb24gZ2V0cyBjYWxsZWQgYWZ0ZXIgYWxsXG4gICAgICAgIC8vIHJlYWN0IGNvbXBvbmVudHMgYXJlIG1vdW50ZWQgYW5kIHdlIGV4cGVjdCB0aGUgbWlzc2luZyByZWYgb2JqZWN0IHRvXG4gICAgICAgIC8vIGJlIHJlc29sdmVkIGJ5IHRoZW4uXG4gICAgICAgIHRoaXMuX3VwZGF0ZUVucXVldWVkID0gc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLl91cGRhdGVFbnF1ZXVlZCA9IG51bGw7XG4gICAgICAgICAgdGhpcy5fdXBkYXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9jcmVhdGVHZXN0dXJlSGFuZGxlcihcbiAgICAgICAgZmlsdGVyQ29uZmlnKFxuICAgICAgICAgIHRyYW5zZm9ybVByb3BzID8gdHJhbnNmb3JtUHJvcHModGhpcy5wcm9wcykgOiB0aGlzLnByb3BzLFxuICAgICAgICAgIHsgLi4udGhpcy5jb25zdHJ1Y3Rvci5wcm9wVHlwZXMsIC4uLmN1c3RvbU5hdGl2ZVByb3BzIH0sXG4gICAgICAgICAgY29uZmlnXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICB0aGlzLl9hdHRhY2hHZXN0dXJlSGFuZGxlcihmaW5kTm9kZUhhbmRsZSh0aGlzLl92aWV3Tm9kZSkpO1xuICAgIH1cblxuICAgIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICAgIGNvbnN0IHZpZXdUYWcgPSBmaW5kTm9kZUhhbmRsZSh0aGlzLl92aWV3Tm9kZSk7XG4gICAgICBpZiAodGhpcy5fdmlld1RhZyAhPT0gdmlld1RhZykge1xuICAgICAgICB0aGlzLl9hdHRhY2hHZXN0dXJlSGFuZGxlcih2aWV3VGFnKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3VwZGF0ZSgpO1xuICAgIH1cblxuICAgIF91cGRhdGUoKSB7XG4gICAgICBjb25zdCBuZXdDb25maWcgPSBmaWx0ZXJDb25maWcoXG4gICAgICAgIHRyYW5zZm9ybVByb3BzID8gdHJhbnNmb3JtUHJvcHModGhpcy5wcm9wcykgOiB0aGlzLnByb3BzLFxuICAgICAgICB7IC4uLnRoaXMuY29uc3RydWN0b3IucHJvcFR5cGVzLCAuLi5jdXN0b21OYXRpdmVQcm9wcyB9LFxuICAgICAgICBjb25maWdcbiAgICAgICk7XG4gICAgICBpZiAoIWRlZXBFcXVhbCh0aGlzLl9jb25maWcsIG5ld0NvbmZpZykpIHtcbiAgICAgICAgdGhpcy5fdXBkYXRlR2VzdHVyZUhhbmRsZXIobmV3Q29uZmlnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzZXROYXRpdmVQcm9wcyh1cGRhdGVzKSB7XG4gICAgICBjb25zdCBtZXJnZWRQcm9wcyA9IHsgLi4udGhpcy5wcm9wcywgLi4udXBkYXRlcyB9O1xuICAgICAgY29uc3QgbmV3Q29uZmlnID0gZmlsdGVyQ29uZmlnKFxuICAgICAgICB0cmFuc2Zvcm1Qcm9wcyA/IHRyYW5zZm9ybVByb3BzKG1lcmdlZFByb3BzKSA6IG1lcmdlZFByb3BzLFxuICAgICAgICB7IC4uLnRoaXMuY29uc3RydWN0b3IucHJvcFR5cGVzLCAuLi5jdXN0b21OYXRpdmVQcm9wcyB9LFxuICAgICAgICBjb25maWdcbiAgICAgICk7XG4gICAgICB0aGlzLl91cGRhdGVHZXN0dXJlSGFuZGxlcihuZXdDb25maWcpO1xuICAgIH1cblxuICAgIHJlbmRlcigpIHtcbiAgICAgIGxldCBnZXN0dXJlRXZlbnRIYW5kbGVyID0gdGhpcy5fb25HZXN0dXJlSGFuZGxlckV2ZW50O1xuICAgICAgY29uc3QgeyBvbkdlc3R1cmVFdmVudCwgb25HZXN0dXJlSGFuZGxlckV2ZW50IH0gPSB0aGlzLnByb3BzO1xuICAgICAgaWYgKG9uR2VzdHVyZUV2ZW50ICYmIHR5cGVvZiBvbkdlc3R1cmVFdmVudCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAvLyBJZiBpdCdzIG5vdCBhIG1ldGhvZCBpdCBzaG91bGQgYmUgYW4gbmF0aXZlIEFuaW1hdGVkLmV2ZW50XG4gICAgICAgIC8vIG9iamVjdC4gV2Ugc2V0IGl0IGRpcmVjdGx5IGFzIHRoZSBoYW5kbGVyIGZvciB0aGUgdmlld1xuICAgICAgICAvLyBJbiB0aGlzIGNhc2UgbmVzdGVkIGhhbmRsZXJzIGFyZSBub3QgZ29pbmcgdG8gYmUgc3VwcG9ydGVkXG4gICAgICAgIGlmIChvbkdlc3R1cmVIYW5kbGVyRXZlbnQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBnZXN0dXJlRXZlbnRIYW5kbGVyID0gdGhpcy5wcm9wcy5vbkdlc3R1cmVFdmVudDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQgJiZcbiAgICAgICAgICB0eXBlb2Ygb25HZXN0dXJlSGFuZGxlckV2ZW50ICE9PSAnZnVuY3Rpb24nXG4gICAgICAgICkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICdOZXN0aW5nIHRvdWNoIGhhbmRsZXJzIHdpdGggbmF0aXZlIGFuaW1hdGVkIGRyaXZlciBpcyBub3Qgc3VwcG9ydGVkIHlldCdcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCBnZXN0dXJlU3RhdGVFdmVudEhhbmRsZXIgPSB0aGlzLl9vbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICBjb25zdCB7IG9uSGFuZGxlclN0YXRlQ2hhbmdlLCBvbkdlc3R1cmVIYW5kbGVyU3RhdGVDaGFuZ2UgfSA9IHRoaXMucHJvcHM7XG4gICAgICBpZiAob25IYW5kbGVyU3RhdGVDaGFuZ2UgJiYgdHlwZW9mIG9uSGFuZGxlclN0YXRlQ2hhbmdlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIC8vIElmIGl0J3Mgbm90IGEgbWV0aG9kIGl0IHNob3VsZCBiZSBhbiBuYXRpdmUgQW5pbWF0ZWQuZXZlbnRcbiAgICAgICAgLy8gb2JqZWN0LiBXZSBzZXQgaXQgZGlyZWN0bHkgYXMgdGhlIGhhbmRsZXIgZm9yIHRoZSB2aWV3XG4gICAgICAgIC8vIEluIHRoaXMgY2FzZSBuZXN0ZWQgaGFuZGxlcnMgYXJlIG5vdCBnb2luZyB0byBiZSBzdXBwb3J0ZWRcbiAgICAgICAgaWYgKG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICdOZXN0aW5nIHRvdWNoIGhhbmRsZXJzIHdpdGggbmF0aXZlIGFuaW1hdGVkIGRyaXZlciBpcyBub3Qgc3VwcG9ydGVkIHlldCdcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGdlc3R1cmVTdGF0ZUV2ZW50SGFuZGxlciA9IHRoaXMucHJvcHMub25IYW5kbGVyU3RhdGVDaGFuZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlICYmXG4gICAgICAgICAgdHlwZW9mIG9uR2VzdHVyZUhhbmRsZXJTdGF0ZUNoYW5nZSAhPT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAnTmVzdGluZyB0b3VjaCBoYW5kbGVycyB3aXRoIG5hdGl2ZSBhbmltYXRlZCBkcml2ZXIgaXMgbm90IHN1cHBvcnRlZCB5ZXQnXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBjaGlsZCA9IFJlYWN0LkNoaWxkcmVuLm9ubHkodGhpcy5wcm9wcy5jaGlsZHJlbik7XG4gICAgICBsZXQgZ3JhbmRDaGlsZHJlbiA9IGNoaWxkLnByb3BzLmNoaWxkcmVuO1xuICAgICAgaWYgKFxuICAgICAgICBUb3VjaGFibGUuVE9VQ0hfVEFSR0VUX0RFQlVHICYmXG4gICAgICAgIGNoaWxkLnR5cGUgJiZcbiAgICAgICAgKGNoaWxkLnR5cGUgPT09ICdSTkdlc3R1cmVIYW5kbGVyQnV0dG9uJyB8fFxuICAgICAgICAgIGNoaWxkLnR5cGUubmFtZSA9PT0gJ1ZpZXcnIHx8XG4gICAgICAgICAgY2hpbGQudHlwZS5kaXNwbGF5TmFtZSA9PT0gJ1ZpZXcnKVxuICAgICAgKSB7XG4gICAgICAgIGdyYW5kQ2hpbGRyZW4gPSBSZWFjdC5DaGlsZHJlbi50b0FycmF5KGdyYW5kQ2hpbGRyZW4pO1xuICAgICAgICBncmFuZENoaWxkcmVuLnB1c2goXG4gICAgICAgICAgVG91Y2hhYmxlLnJlbmRlckRlYnVnVmlldyh7XG4gICAgICAgICAgICBjb2xvcjogJ21lZGl1bXNwcmluZ2dyZWVuJyxcbiAgICAgICAgICAgIGhpdFNsb3A6IGNoaWxkLnByb3BzLmhpdFNsb3AsXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoXG4gICAgICAgIGNoaWxkLFxuICAgICAgICB7XG4gICAgICAgICAgcmVmOiB0aGlzLl9yZWZIYW5kbGVyLFxuICAgICAgICAgIGNvbGxhcHNhYmxlOiBmYWxzZSxcbiAgICAgICAgICBvbkdlc3R1cmVIYW5kbGVyRXZlbnQ6IGdlc3R1cmVFdmVudEhhbmRsZXIsXG4gICAgICAgICAgb25HZXN0dXJlSGFuZGxlclN0YXRlQ2hhbmdlOiBnZXN0dXJlU3RhdGVFdmVudEhhbmRsZXIsXG4gICAgICAgIH0sXG4gICAgICAgIGdyYW5kQ2hpbGRyZW5cbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHJldHVybiBIYW5kbGVyO1xufVxuIl19