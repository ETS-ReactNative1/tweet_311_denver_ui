f1b5db6e1cb27a7e7c25583b4a67cf46
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.coalesceStatuses = coalesceStatuses;
exports.coalesceExpirations = coalesceExpirations;
exports.coalesceCanAskAgain = coalesceCanAskAgain;
exports.coalesceGranted = coalesceGranted;

var _Permissions = require("./Permissions.types");

function coalesceStatuses(permissions) {
  var statuses = Object.keys(permissions).map(function (type) {
    return permissions[type].status;
  });
  statuses.sort(function (status1, status2) {
    return _getStatusWeight(status1) - _getStatusWeight(status2);
  });
  return statuses[statuses.length - 1];
}

function _getStatusWeight(status) {
  switch (status) {
    case _Permissions.PermissionStatus.GRANTED:
      return 0;

    case _Permissions.PermissionStatus.DENIED:
      return 1;

    case _Permissions.PermissionStatus.UNDETERMINED:
      return 2;

    default:
      return 100;
  }
}

function coalesceExpirations(permissions) {
  var maxExpiration = 9007199254740991;
  var expirations = Object.keys(permissions).map(function (type) {
    return permissions[type].expires;
  });
  expirations.sort(function (e1, e2) {
    return (e1 == null || e1 === 'never' ? maxExpiration : e1) - (e2 == null || e2 === 'never' ? maxExpiration : e2);
  });
  return expirations[0];
}

function coalesceCanAskAgain(permissions) {
  return Object.keys(permissions).reduce(function (canAskAgain, type) {
    return canAskAgain && permissions[type].canAskAgain;
  }, true);
}

function coalesceGranted(permissions) {
  return Object.keys(permissions).reduce(function (granted, type) {
    return granted && permissions[type].granted;
  }, true);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Db2FsZXNjZWRQZXJtaXNzaW9ucy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUVNLFNBQVUsZ0JBQVYsQ0FBMkIsV0FBM0IsRUFBcUQ7QUFDekQsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQVAsQ0FBWSxXQUFaLEVBQXlCLEdBQXpCLENBQTZCLFVBQUEsSUFBSTtBQUFBLFdBQUksV0FBVyxDQUFDLElBQUQsQ0FBWCxDQUFrQixNQUF0QjtBQUFBLEdBQWpDLENBQWpCO0FBQ0EsRUFBQSxRQUFRLENBQUMsSUFBVCxDQUFjLFVBQUMsT0FBRCxFQUFVLE9BQVY7QUFBQSxXQUFzQixnQkFBZ0IsQ0FBQyxPQUFELENBQWhCLEdBQTRCLGdCQUFnQixDQUFDLE9BQUQsQ0FBbEU7QUFBQSxHQUFkO0FBRUEsU0FBTyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQVQsR0FBa0IsQ0FBbkIsQ0FBZjtBQUNEOztBQUVELFNBQVMsZ0JBQVQsQ0FBMEIsTUFBMUIsRUFBa0Q7QUFJaEQsVUFBUSxNQUFSO0FBQ0UsU0FBSyw4QkFBaUIsT0FBdEI7QUFDRSxhQUFPLENBQVA7O0FBQ0YsU0FBSyw4QkFBaUIsTUFBdEI7QUFDRSxhQUFPLENBQVA7O0FBQ0YsU0FBSyw4QkFBaUIsWUFBdEI7QUFDRSxhQUFPLENBQVA7O0FBQ0Y7QUFDRSxhQUFPLEdBQVA7QUFSSjtBQVVEOztBQUVLLFNBQVUsbUJBQVYsQ0FBOEIsV0FBOUIsRUFBd0Q7QUFDNUQsTUFBTSxhQUFhLEdBQUcsZ0JBQXRCO0FBQ0EsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQVAsQ0FBWSxXQUFaLEVBQXlCLEdBQXpCLENBQTZCLFVBQUEsSUFBSTtBQUFBLFdBQUksV0FBVyxDQUFDLElBQUQsQ0FBWCxDQUFrQixPQUF0QjtBQUFBLEdBQWpDLENBQXBCO0FBQ0EsRUFBQSxXQUFXLENBQUMsSUFBWixDQUNFLFVBQUMsRUFBRCxFQUFLLEVBQUw7QUFBQSxXQUNFLENBQUMsRUFBRSxJQUFJLElBQU4sSUFBYyxFQUFFLEtBQUssT0FBckIsR0FBK0IsYUFBL0IsR0FBK0MsRUFBaEQsS0FDQyxFQUFFLElBQUksSUFBTixJQUFjLEVBQUUsS0FBSyxPQUFyQixHQUErQixhQUEvQixHQUErQyxFQURoRCxDQURGO0FBQUEsR0FERjtBQU1BLFNBQU8sV0FBVyxDQUFDLENBQUQsQ0FBbEI7QUFDRDs7QUFFSyxTQUFVLG1CQUFWLENBQThCLFdBQTlCLEVBQXdEO0FBQzVELFNBQU8sTUFBTSxDQUFDLElBQVAsQ0FBWSxXQUFaLEVBQXlCLE1BQXpCLENBQ0wsVUFBQyxXQUFELEVBQWMsSUFBZDtBQUFBLFdBQXVCLFdBQVcsSUFBSSxXQUFXLENBQUMsSUFBRCxDQUFYLENBQWtCLFdBQXhEO0FBQUEsR0FESyxFQUVMLElBRkssQ0FBUDtBQUlEOztBQUVLLFNBQVUsZUFBVixDQUEwQixXQUExQixFQUFvRDtBQUN4RCxTQUFPLE1BQU0sQ0FBQyxJQUFQLENBQVksV0FBWixFQUF5QixNQUF6QixDQUNMLFVBQUMsT0FBRCxFQUFVLElBQVY7QUFBQSxXQUFtQixPQUFPLElBQUksV0FBVyxDQUFDLElBQUQsQ0FBWCxDQUFrQixPQUFoRDtBQUFBLEdBREssRUFFTCxJQUZLLENBQVA7QUFJRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBlcm1pc3Npb25FeHBpcmF0aW9uLCBQZXJtaXNzaW9uTWFwLCBQZXJtaXNzaW9uU3RhdHVzIH0gZnJvbSAnLi9QZXJtaXNzaW9ucy50eXBlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2FsZXNjZVN0YXR1c2VzKHBlcm1pc3Npb25zOiBQZXJtaXNzaW9uTWFwKTogUGVybWlzc2lvblN0YXR1cyB7XG4gIGNvbnN0IHN0YXR1c2VzID0gT2JqZWN0LmtleXMocGVybWlzc2lvbnMpLm1hcCh0eXBlID0+IHBlcm1pc3Npb25zW3R5cGVdLnN0YXR1cyk7XG4gIHN0YXR1c2VzLnNvcnQoKHN0YXR1czEsIHN0YXR1czIpID0+IF9nZXRTdGF0dXNXZWlnaHQoc3RhdHVzMSkgLSBfZ2V0U3RhdHVzV2VpZ2h0KHN0YXR1czIpKTtcbiAgLy8gV2UgY2hvb3NlIHRoZSBcImhlYXZpZXN0XCIgc3RhdHVzIHdpdGggdGhlIG1vc3QgaW1wbGljYXRpb25zXG4gIHJldHVybiBzdGF0dXNlc1tzdGF0dXNlcy5sZW5ndGggLSAxXTtcbn1cblxuZnVuY3Rpb24gX2dldFN0YXR1c1dlaWdodChzdGF0dXM6IFBlcm1pc3Npb25TdGF0dXMpOiBudW1iZXIge1xuICAvLyBJbiB0ZXJtcyBvZiB3ZWlnaHQsIHdlIHRyZWF0IFVOREVURVJNSU5FRCA+IERFTklFRCA+IEdSQU5URUQgc2luY2UgVU5ERVRFUk1JTkVEIHJlcXVpcmVzIHRoZVxuICAvLyBtb3N0IGFtb3VudCBvZiBmdXJ0aGVyIGhhbmRsaW5nIChwcm9tcHRpbmcgZm9yIHBlcm1pc3Npb24gYW5kIHRoZW4gY2hlY2tpbmcgdGhhdCBwZXJtaXNzaW9uKVxuICAvLyBhbmQgR1JBTlRFRCByZXF1aXJlcyB0aGUgbGVhc3RcbiAgc3dpdGNoIChzdGF0dXMpIHtcbiAgICBjYXNlIFBlcm1pc3Npb25TdGF0dXMuR1JBTlRFRDpcbiAgICAgIHJldHVybiAwO1xuICAgIGNhc2UgUGVybWlzc2lvblN0YXR1cy5ERU5JRUQ6XG4gICAgICByZXR1cm4gMTtcbiAgICBjYXNlIFBlcm1pc3Npb25TdGF0dXMuVU5ERVRFUk1JTkVEOlxuICAgICAgcmV0dXJuIDI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiAxMDA7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvYWxlc2NlRXhwaXJhdGlvbnMocGVybWlzc2lvbnM6IFBlcm1pc3Npb25NYXApOiBQZXJtaXNzaW9uRXhwaXJhdGlvbiB7XG4gIGNvbnN0IG1heEV4cGlyYXRpb24gPSA5MDA3MTk5MjU0NzQwOTkxOyAvLyBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUlxuICBjb25zdCBleHBpcmF0aW9ucyA9IE9iamVjdC5rZXlzKHBlcm1pc3Npb25zKS5tYXAodHlwZSA9PiBwZXJtaXNzaW9uc1t0eXBlXS5leHBpcmVzKTtcbiAgZXhwaXJhdGlvbnMuc29ydChcbiAgICAoZTEsIGUyKSA9PlxuICAgICAgKGUxID09IG51bGwgfHwgZTEgPT09ICduZXZlcicgPyBtYXhFeHBpcmF0aW9uIDogZTEpIC1cbiAgICAgIChlMiA9PSBudWxsIHx8IGUyID09PSAnbmV2ZXInID8gbWF4RXhwaXJhdGlvbiA6IGUyKVxuICApO1xuICAvLyBXZSBjaG9vc2UgdGhlIGVhcmxpZXN0IGV4cGlyYXRpb25cbiAgcmV0dXJuIGV4cGlyYXRpb25zWzBdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29hbGVzY2VDYW5Bc2tBZ2FpbihwZXJtaXNzaW9uczogUGVybWlzc2lvbk1hcCk6IGJvb2xlYW4ge1xuICByZXR1cm4gT2JqZWN0LmtleXMocGVybWlzc2lvbnMpLnJlZHVjZTxib29sZWFuPihcbiAgICAoY2FuQXNrQWdhaW4sIHR5cGUpID0+IGNhbkFza0FnYWluICYmIHBlcm1pc3Npb25zW3R5cGVdLmNhbkFza0FnYWluLFxuICAgIHRydWVcbiAgKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvYWxlc2NlR3JhbnRlZChwZXJtaXNzaW9uczogUGVybWlzc2lvbk1hcCk6IGJvb2xlYW4ge1xuICByZXR1cm4gT2JqZWN0LmtleXMocGVybWlzc2lvbnMpLnJlZHVjZTxib29sZWFuPihcbiAgICAoZ3JhbnRlZCwgdHlwZSkgPT4gZ3JhbnRlZCAmJiBwZXJtaXNzaW9uc1t0eXBlXS5ncmFudGVkLFxuICAgIHRydWVcbiAgKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiIn0=