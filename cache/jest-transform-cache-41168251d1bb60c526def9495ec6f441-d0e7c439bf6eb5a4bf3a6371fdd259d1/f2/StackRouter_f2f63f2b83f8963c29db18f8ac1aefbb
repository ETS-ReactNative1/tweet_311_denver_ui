c86544d44b83837fb582f3cd72c36f8f
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault2(require("@babel/runtime/helpers/toConsumableArray"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = StackRouter;
exports.StackActions = void 0;

var _shortid = _interopRequireDefault(require("shortid"));

var _BaseRouter = _interopRequireDefault(require("./BaseRouter"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function ownKeys(object, enumerableOnly) {
  var keys = Object.keys(object);

  if (Object.getOwnPropertySymbols) {
    var symbols = Object.getOwnPropertySymbols(object);
    if (enumerableOnly) symbols = symbols.filter(function (sym) {
      return Object.getOwnPropertyDescriptor(object, sym).enumerable;
    });
    keys.push.apply(keys, symbols);
  }

  return keys;
}

function _objectSpread(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};

    if (i % 2) {
      ownKeys(Object(source), true).forEach(function (key) {
        _defineProperty(target, key, source[key]);
      });
    } else if (Object.getOwnPropertyDescriptors) {
      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));
    } else {
      ownKeys(Object(source)).forEach(function (key) {
        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));
      });
    }
  }

  return target;
}

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var StackActions = {
  replace: function replace(name, params) {
    return {
      type: 'REPLACE',
      payload: {
        name: name,
        params: params
      }
    };
  },
  push: function push(name, params) {
    return {
      type: 'PUSH',
      payload: {
        name: name,
        params: params
      }
    };
  },
  pop: function pop() {
    var count = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    return {
      type: 'POP',
      payload: {
        count: count
      }
    };
  },
  popToTop: function popToTop() {
    return {
      type: 'POP_TO_TOP'
    };
  }
};
exports.StackActions = StackActions;

function StackRouter(options) {
  var router = _objectSpread({}, _BaseRouter.default, {
    type: 'stack',
    getInitialState: function getInitialState(_ref) {
      var routeNames = _ref.routeNames,
          routeParamList = _ref.routeParamList;
      var initialRouteName = options.initialRouteName !== undefined && routeNames.includes(options.initialRouteName) ? options.initialRouteName : routeNames[0];
      return {
        stale: false,
        type: 'stack',
        key: "stack-".concat((0, _shortid.default)()),
        index: 0,
        routeNames: routeNames,
        routes: [{
          key: "".concat(initialRouteName, "-").concat((0, _shortid.default)()),
          name: initialRouteName,
          params: routeParamList[initialRouteName]
        }]
      };
    },
    getRehydratedState: function getRehydratedState(partialState, _ref2) {
      var routeNames = _ref2.routeNames,
          routeParamList = _ref2.routeParamList;
      var state = partialState;

      if (state.stale === false) {
        return state;
      }

      var routes = state.routes.filter(function (route) {
        return routeNames.includes(route.name);
      }).map(function (route) {
        return _objectSpread({}, route, {
          key: route.key || "".concat(route.name, "-").concat((0, _shortid.default)()),
          params: routeParamList[route.name] !== undefined ? _objectSpread({}, routeParamList[route.name], {}, route.params) : route.params
        });
      });

      if (routes.length === 0) {
        var initialRouteName = options.initialRouteName !== undefined ? options.initialRouteName : routeNames[0];
        routes.push({
          key: "".concat(initialRouteName, "-").concat((0, _shortid.default)()),
          name: initialRouteName,
          params: routeParamList[initialRouteName]
        });
      }

      return {
        stale: false,
        type: 'stack',
        key: "stack-".concat((0, _shortid.default)()),
        index: routes.length - 1,
        routeNames: routeNames,
        routes: routes
      };
    },
    getStateForRouteNamesChange: function getStateForRouteNamesChange(state, _ref3) {
      var routeNames = _ref3.routeNames,
          routeParamList = _ref3.routeParamList;
      var routes = state.routes.filter(function (route) {
        return routeNames.includes(route.name);
      });

      if (routes.length === 0) {
        var initialRouteName = options.initialRouteName !== undefined && routeNames.includes(options.initialRouteName) ? options.initialRouteName : routeNames[0];
        routes.push({
          key: "".concat(initialRouteName, "-").concat((0, _shortid.default)()),
          name: initialRouteName,
          params: routeParamList[initialRouteName]
        });
      }

      return _objectSpread({}, state, {
        routeNames: routeNames,
        routes: routes,
        index: Math.min(state.index, routes.length - 1)
      });
    },
    getStateForRouteFocus: function getStateForRouteFocus(state, key) {
      var index = state.routes.findIndex(function (r) {
        return r.key === key;
      });

      if (index === -1 || index === state.index) {
        return state;
      }

      return _objectSpread({}, state, {
        index: index,
        routes: state.routes.slice(0, index + 1)
      });
    },
    getStateForAction: function getStateForAction(state, action, options) {
      var routeParamList = options.routeParamList;

      switch (action.type) {
        case 'REPLACE':
          {
            var index = action.source ? state.routes.findIndex(function (r) {
              return r.key === action.source;
            }) : state.index;

            if (index === -1) {
              return null;
            }

            var _action$payload = action.payload,
                name = _action$payload.name,
                key = _action$payload.key,
                params = _action$payload.params;

            if (!state.routeNames.includes(name)) {
              return null;
            }

            return _objectSpread({}, state, {
              routes: state.routes.map(function (route, i) {
                return i === index ? {
                  key: key !== undefined ? key : "".concat(name, "-").concat((0, _shortid.default)()),
                  name: name,
                  params: routeParamList[name] !== undefined ? _objectSpread({}, routeParamList[name], {}, params) : params
                } : route;
              })
            });
          }

        case 'PUSH':
          if (state.routeNames.includes(action.payload.name)) {
            return _objectSpread({}, state, {
              index: state.index + 1,
              routes: [].concat((0, _toConsumableArray2.default)(state.routes), [{
                key: action.payload.key === undefined ? "".concat(action.payload.name, "-").concat((0, _shortid.default)()) : action.payload.key,
                name: action.payload.name,
                params: routeParamList[action.payload.name] !== undefined ? _objectSpread({}, routeParamList[action.payload.name], {}, action.payload.params) : action.payload.params
              }])
            });
          }

          return null;

        case 'POP':
          {
            var _index = action.target === state.key && action.source ? state.routes.findIndex(function (r) {
              return r.key === action.source;
            }) : state.index;

            if (_index > 0) {
              var count = Math.max(_index - action.payload.count + 1, 1);
              var routes = state.routes.slice(0, count).concat(state.routes.slice(_index + 1));
              return _objectSpread({}, state, {
                index: routes.length - 1,
                routes: routes
              });
            }

            return null;
          }

        case 'POP_TO_TOP':
          return router.getStateForAction(state, {
            type: 'POP',
            payload: {
              count: state.routes.length - 1
            }
          }, options);

        case 'NAVIGATE':
          if (action.payload.key || action.payload.name && state.routeNames.includes(action.payload.name)) {
            var _index2 = -1;

            if (state.routes[state.index].name === action.payload.name && action.payload.key === undefined || state.routes[state.index].key === action.payload.key) {
              _index2 = state.index;
            } else {
              for (var i = state.routes.length - 1; i >= 0; i--) {
                if (state.routes[i].name === action.payload.name && action.payload.key === undefined || state.routes[i].key === action.payload.key) {
                  _index2 = i;
                  break;
                }
              }
            }

            if (_index2 === -1 && action.payload.key && action.payload.name === undefined) {
              return null;
            }

            if (_index2 === -1 && action.payload.name !== undefined) {
              return router.getStateForAction(state, {
                type: 'PUSH',
                payload: {
                  key: action.payload.key,
                  name: action.payload.name,
                  params: action.payload.params
                }
              }, options);
            }

            return _objectSpread({}, state, {
              index: _index2,
              routes: [].concat((0, _toConsumableArray2.default)(state.routes.slice(0, _index2)), [action.payload.params !== undefined ? _objectSpread({}, state.routes[_index2], {
                params: _objectSpread({}, state.routes[_index2].params, {}, action.payload.params)
              }) : state.routes[_index2]])
            });
          }

          return null;

        case 'GO_BACK':
          if (state.index > 0) {
            return router.getStateForAction(state, {
              type: 'POP',
              payload: {
                count: 1
              },
              target: action.target,
              source: action.source
            }, options);
          }

          return null;

        default:
          return _BaseRouter.default.getStateForAction(state, action);
      }
    },
    actionCreators: StackActions
  });

  return router;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YWNrUm91dGVyLnRzeCJdLCJuYW1lcyI6WyJTdGFja0FjdGlvbnMiLCJyZXBsYWNlIiwidHlwZSIsInBheWxvYWQiLCJuYW1lIiwicGFyYW1zIiwicHVzaCIsInBvcCIsImNvdW50IiwicG9wVG9Ub3AiLCJyb3V0ZXIiLCJCYXNlUm91dGVyIiwiZ2V0SW5pdGlhbFN0YXRlIiwicm91dGVQYXJhbUxpc3QiLCJpbml0aWFsUm91dGVOYW1lIiwib3B0aW9ucyIsInJvdXRlTmFtZXMiLCJzdGFsZSIsImtleSIsImluZGV4Iiwicm91dGVzIiwiZ2V0UmVoeWRyYXRlZFN0YXRlIiwic3RhdGUiLCJyb3V0ZSIsImdldFN0YXRlRm9yUm91dGVOYW1lc0NoYW5nZSIsIk1hdGgiLCJnZXRTdGF0ZUZvclJvdXRlRm9jdXMiLCJyIiwiZ2V0U3RhdGVGb3JBY3Rpb24iLCJhY3Rpb24iLCJpIiwidGFyZ2V0Iiwic291cmNlIiwiYWN0aW9uQ3JlYXRvcnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsV0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxnQkFBQSxDQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQ08sSUFBTUEsWUFBWSxHQUFHO0FBQzFCQyxFQUFBQSxPQUQwQixtQkFDbkIsSUFEbUIsRUFDbkIsTUFEbUIsRUFDOEI7QUFDdEQsV0FBTztBQUFFQyxNQUFBQSxJQUFJLEVBQU4sU0FBQTtBQUFtQkMsTUFBQUEsT0FBTyxFQUFFO0FBQUVDLFFBQUFBLElBQUYsRUFBRUEsSUFBRjtBQUFRQyxRQUFBQSxNQUFBQSxFQUFBQTtBQUFSO0FBQTVCLEtBQVA7QUFGd0IsR0FBQTtBQUkxQkMsRUFBQUEsSUFKMEIsZ0JBSXRCLElBSnNCLEVBSXRCLE1BSnNCLEVBSTJCO0FBQ25ELFdBQU87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QUEsS0FBQSxFQUVMO0FBQ0VwQixjQUFBQSxJQUFJLEVBRE4sS0FBQTtBQUVFQyxjQUFBQSxPQUFPLEVBQUU7QUFBRUssZ0JBQUFBLEtBQUssRUFBRTtBQUFULGVBRlg7QUFHRXVCLGNBQUFBLE1BQU0sRUFBRUYsTUFBTSxDQUhoQixNQUFBO0FBSUVHLGNBQUFBLE1BQU0sRUFBRUgsTUFBTSxDQUFDRztBQUpqQixhQUZLLEVBQVAsT0FBTyxDQUFQO0FBVUQ7O0FBRUQsaUJBQUEsSUFBQTs7QUFFRjtBQUNFLGlCQUFPckIsV0FBQUEsQ0FBQUEsT0FBQUEsQ0FBQUEsaUJBQUFBLENBQUFBLEtBQUFBLEVBQVAsTUFBT0EsQ0FBUDtBQXZMSjtBQXZISCxLQUFBO0FBa1RDc0IsSUFBQUEsY0FBYyxFQUFFakM7QUFsVGpCLEdBQUEsQ0FIRDs7QUF3VEEsU0FBQSxNQUFBO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgc2hvcnRpZCBmcm9tICdzaG9ydGlkJztcbmltcG9ydCBCYXNlUm91dGVyIGZyb20gJy4vQmFzZVJvdXRlcic7XG5pbXBvcnQge1xuICBOYXZpZ2F0aW9uU3RhdGUsXG4gIENvbW1vbk5hdmlnYXRpb25BY3Rpb24sXG4gIFJvdXRlcixcbiAgRGVmYXVsdFJvdXRlck9wdGlvbnMsXG4gIFJvdXRlLFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IHR5cGUgU3RhY2tBY3Rpb25UeXBlID1cbiAgfCB7XG4gICAgICB0eXBlOiAnUkVQTEFDRSc7XG4gICAgICBwYXlsb2FkOiB7IG5hbWU6IHN0cmluZzsga2V5Pzogc3RyaW5nIHwgdW5kZWZpbmVkOyBwYXJhbXM/OiBvYmplY3QgfTtcbiAgICAgIHNvdXJjZT86IHN0cmluZztcbiAgICAgIHRhcmdldD86IHN0cmluZztcbiAgICB9XG4gIHwge1xuICAgICAgdHlwZTogJ1BVU0gnO1xuICAgICAgcGF5bG9hZDogeyBuYW1lOiBzdHJpbmc7IGtleT86IHN0cmluZyB8IHVuZGVmaW5lZDsgcGFyYW1zPzogb2JqZWN0IH07XG4gICAgICBzb3VyY2U/OiBzdHJpbmc7XG4gICAgICB0YXJnZXQ/OiBzdHJpbmc7XG4gICAgfVxuICB8IHtcbiAgICAgIHR5cGU6ICdQT1AnO1xuICAgICAgcGF5bG9hZDogeyBjb3VudDogbnVtYmVyIH07XG4gICAgICBzb3VyY2U/OiBzdHJpbmc7XG4gICAgICB0YXJnZXQ/OiBzdHJpbmc7XG4gICAgfVxuICB8IHtcbiAgICAgIHR5cGU6ICdQT1BfVE9fVE9QJztcbiAgICAgIHNvdXJjZT86IHN0cmluZztcbiAgICAgIHRhcmdldD86IHN0cmluZztcbiAgICB9O1xuXG5leHBvcnQgdHlwZSBTdGFja1JvdXRlck9wdGlvbnMgPSBEZWZhdWx0Um91dGVyT3B0aW9ucztcblxuZXhwb3J0IHR5cGUgU3RhY2tOYXZpZ2F0aW9uU3RhdGUgPSBOYXZpZ2F0aW9uU3RhdGUgJiB7XG4gIC8qKlxuICAgKiBUeXBlIG9mIHRoZSByb3V0ZXIsIGluIHRoaXMgY2FzZSwgaXQncyBzdGFjay5cbiAgICovXG4gIHR5cGU6ICdzdGFjayc7XG59O1xuXG5leHBvcnQgY29uc3QgU3RhY2tBY3Rpb25zID0ge1xuICByZXBsYWNlKG5hbWU6IHN0cmluZywgcGFyYW1zPzogb2JqZWN0KTogU3RhY2tBY3Rpb25UeXBlIHtcbiAgICByZXR1cm4geyB0eXBlOiAnUkVQTEFDRScsIHBheWxvYWQ6IHsgbmFtZSwgcGFyYW1zIH0gfTtcbiAgfSxcbiAgcHVzaChuYW1lOiBzdHJpbmcsIHBhcmFtcz86IG9iamVjdCk6IFN0YWNrQWN0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHsgdHlwZTogJ1BVU0gnLCBwYXlsb2FkOiB7IG5hbWUsIHBhcmFtcyB9IH07XG4gIH0sXG4gIHBvcChjb3VudDogbnVtYmVyID0gMSk6IFN0YWNrQWN0aW9uVHlwZSB7XG4gICAgcmV0dXJuIHsgdHlwZTogJ1BPUCcsIHBheWxvYWQ6IHsgY291bnQgfSB9O1xuICB9LFxuICBwb3BUb1RvcCgpOiBTdGFja0FjdGlvblR5cGUge1xuICAgIHJldHVybiB7IHR5cGU6ICdQT1BfVE9fVE9QJyB9O1xuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gU3RhY2tSb3V0ZXIob3B0aW9uczogU3RhY2tSb3V0ZXJPcHRpb25zKSB7XG4gIGNvbnN0IHJvdXRlcjogUm91dGVyPFxuICAgIFN0YWNrTmF2aWdhdGlvblN0YXRlLFxuICAgIENvbW1vbk5hdmlnYXRpb25BY3Rpb24gfCBTdGFja0FjdGlvblR5cGVcbiAgPiA9IHtcbiAgICAuLi5CYXNlUm91dGVyLFxuXG4gICAgdHlwZTogJ3N0YWNrJyxcblxuICAgIGdldEluaXRpYWxTdGF0ZSh7IHJvdXRlTmFtZXMsIHJvdXRlUGFyYW1MaXN0IH0pIHtcbiAgICAgIGNvbnN0IGluaXRpYWxSb3V0ZU5hbWUgPVxuICAgICAgICBvcHRpb25zLmluaXRpYWxSb3V0ZU5hbWUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICByb3V0ZU5hbWVzLmluY2x1ZGVzKG9wdGlvbnMuaW5pdGlhbFJvdXRlTmFtZSlcbiAgICAgICAgICA/IG9wdGlvbnMuaW5pdGlhbFJvdXRlTmFtZVxuICAgICAgICAgIDogcm91dGVOYW1lc1swXTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3RhbGU6IGZhbHNlLFxuICAgICAgICB0eXBlOiAnc3RhY2snLFxuICAgICAgICBrZXk6IGBzdGFjay0ke3Nob3J0aWQoKX1gLFxuICAgICAgICBpbmRleDogMCxcbiAgICAgICAgcm91dGVOYW1lcyxcbiAgICAgICAgcm91dGVzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAga2V5OiBgJHtpbml0aWFsUm91dGVOYW1lfS0ke3Nob3J0aWQoKX1gLFxuICAgICAgICAgICAgbmFtZTogaW5pdGlhbFJvdXRlTmFtZSxcbiAgICAgICAgICAgIHBhcmFtczogcm91dGVQYXJhbUxpc3RbaW5pdGlhbFJvdXRlTmFtZV0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH07XG4gICAgfSxcblxuICAgIGdldFJlaHlkcmF0ZWRTdGF0ZShwYXJ0aWFsU3RhdGUsIHsgcm91dGVOYW1lcywgcm91dGVQYXJhbUxpc3QgfSkge1xuICAgICAgbGV0IHN0YXRlID0gcGFydGlhbFN0YXRlO1xuXG4gICAgICBpZiAoc3RhdGUuc3RhbGUgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgcm91dGVzID0gc3RhdGUucm91dGVzXG4gICAgICAgIC5maWx0ZXIocm91dGUgPT4gcm91dGVOYW1lcy5pbmNsdWRlcyhyb3V0ZS5uYW1lKSlcbiAgICAgICAgLm1hcChcbiAgICAgICAgICByb3V0ZSA9PlxuICAgICAgICAgICAgKHtcbiAgICAgICAgICAgICAgLi4ucm91dGUsXG4gICAgICAgICAgICAgIGtleTogcm91dGUua2V5IHx8IGAke3JvdXRlLm5hbWV9LSR7c2hvcnRpZCgpfWAsXG4gICAgICAgICAgICAgIHBhcmFtczpcbiAgICAgICAgICAgICAgICByb3V0ZVBhcmFtTGlzdFtyb3V0ZS5uYW1lXSAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAuLi5yb3V0ZVBhcmFtTGlzdFtyb3V0ZS5uYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgICAuLi5yb3V0ZS5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIDogcm91dGUucGFyYW1zLFxuICAgICAgICAgICAgfSBhcyBSb3V0ZTxzdHJpbmc+KVxuICAgICAgICApO1xuXG4gICAgICBpZiAocm91dGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zdCBpbml0aWFsUm91dGVOYW1lID1cbiAgICAgICAgICBvcHRpb25zLmluaXRpYWxSb3V0ZU5hbWUgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgPyBvcHRpb25zLmluaXRpYWxSb3V0ZU5hbWVcbiAgICAgICAgICAgIDogcm91dGVOYW1lc1swXTtcblxuICAgICAgICByb3V0ZXMucHVzaCh7XG4gICAgICAgICAga2V5OiBgJHtpbml0aWFsUm91dGVOYW1lfS0ke3Nob3J0aWQoKX1gLFxuICAgICAgICAgIG5hbWU6IGluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICAgICAgcGFyYW1zOiByb3V0ZVBhcmFtTGlzdFtpbml0aWFsUm91dGVOYW1lXSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YWxlOiBmYWxzZSxcbiAgICAgICAgdHlwZTogJ3N0YWNrJyxcbiAgICAgICAga2V5OiBgc3RhY2stJHtzaG9ydGlkKCl9YCxcbiAgICAgICAgaW5kZXg6IHJvdXRlcy5sZW5ndGggLSAxLFxuICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICByb3V0ZXMsXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICBnZXRTdGF0ZUZvclJvdXRlTmFtZXNDaGFuZ2Uoc3RhdGUsIHsgcm91dGVOYW1lcywgcm91dGVQYXJhbUxpc3QgfSkge1xuICAgICAgY29uc3Qgcm91dGVzID0gc3RhdGUucm91dGVzLmZpbHRlcihyb3V0ZSA9PlxuICAgICAgICByb3V0ZU5hbWVzLmluY2x1ZGVzKHJvdXRlLm5hbWUpXG4gICAgICApO1xuXG4gICAgICBpZiAocm91dGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zdCBpbml0aWFsUm91dGVOYW1lID1cbiAgICAgICAgICBvcHRpb25zLmluaXRpYWxSb3V0ZU5hbWUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIHJvdXRlTmFtZXMuaW5jbHVkZXMob3B0aW9ucy5pbml0aWFsUm91dGVOYW1lKVxuICAgICAgICAgICAgPyBvcHRpb25zLmluaXRpYWxSb3V0ZU5hbWVcbiAgICAgICAgICAgIDogcm91dGVOYW1lc1swXTtcblxuICAgICAgICByb3V0ZXMucHVzaCh7XG4gICAgICAgICAga2V5OiBgJHtpbml0aWFsUm91dGVOYW1lfS0ke3Nob3J0aWQoKX1gLFxuICAgICAgICAgIG5hbWU6IGluaXRpYWxSb3V0ZU5hbWUsXG4gICAgICAgICAgcGFyYW1zOiByb3V0ZVBhcmFtTGlzdFtpbml0aWFsUm91dGVOYW1lXSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICByb3V0ZU5hbWVzLFxuICAgICAgICByb3V0ZXMsXG4gICAgICAgIGluZGV4OiBNYXRoLm1pbihzdGF0ZS5pbmRleCwgcm91dGVzLmxlbmd0aCAtIDEpLFxuICAgICAgfTtcbiAgICB9LFxuXG4gICAgZ2V0U3RhdGVGb3JSb3V0ZUZvY3VzKHN0YXRlLCBrZXkpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gc3RhdGUucm91dGVzLmZpbmRJbmRleChyID0+IHIua2V5ID09PSBrZXkpO1xuXG4gICAgICBpZiAoaW5kZXggPT09IC0xIHx8IGluZGV4ID09PSBzdGF0ZS5pbmRleCkge1xuICAgICAgICByZXR1cm4gc3RhdGU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnN0YXRlLFxuICAgICAgICBpbmRleCxcbiAgICAgICAgcm91dGVzOiBzdGF0ZS5yb3V0ZXMuc2xpY2UoMCwgaW5kZXggKyAxKSxcbiAgICAgIH07XG4gICAgfSxcblxuICAgIGdldFN0YXRlRm9yQWN0aW9uKHN0YXRlLCBhY3Rpb24sIG9wdGlvbnMpIHtcbiAgICAgIGNvbnN0IHsgcm91dGVQYXJhbUxpc3QgfSA9IG9wdGlvbnM7XG5cbiAgICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnUkVQTEFDRSc6IHtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGFjdGlvbi5zb3VyY2VcbiAgICAgICAgICAgID8gc3RhdGUucm91dGVzLmZpbmRJbmRleChyID0+IHIua2V5ID09PSBhY3Rpb24uc291cmNlKVxuICAgICAgICAgICAgOiBzdGF0ZS5pbmRleDtcblxuICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHsgbmFtZSwga2V5LCBwYXJhbXMgfSA9IGFjdGlvbi5wYXlsb2FkO1xuXG4gICAgICAgICAgaWYgKCFzdGF0ZS5yb3V0ZU5hbWVzLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICByb3V0ZXM6IHN0YXRlLnJvdXRlcy5tYXAoKHJvdXRlLCBpKSA9PlxuICAgICAgICAgICAgICBpID09PSBpbmRleFxuICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICBrZXk6IGtleSAhPT0gdW5kZWZpbmVkID8ga2V5IDogYCR7bmFtZX0tJHtzaG9ydGlkKCl9YCxcbiAgICAgICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOlxuICAgICAgICAgICAgICAgICAgICAgIHJvdXRlUGFyYW1MaXN0W25hbWVdICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnJvdXRlUGFyYW1MaXN0W25hbWVdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4uLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgOiByb3V0ZVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY2FzZSAnUFVTSCc6XG4gICAgICAgICAgaWYgKHN0YXRlLnJvdXRlTmFtZXMuaW5jbHVkZXMoYWN0aW9uLnBheWxvYWQubmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICBpbmRleDogc3RhdGUuaW5kZXggKyAxLFxuICAgICAgICAgICAgICByb3V0ZXM6IFtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5yb3V0ZXMsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAga2V5OlxuICAgICAgICAgICAgICAgICAgICBhY3Rpb24ucGF5bG9hZC5rZXkgPT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgID8gYCR7YWN0aW9uLnBheWxvYWQubmFtZX0tJHtzaG9ydGlkKCl9YFxuICAgICAgICAgICAgICAgICAgICAgIDogYWN0aW9uLnBheWxvYWQua2V5LFxuICAgICAgICAgICAgICAgICAgbmFtZTogYWN0aW9uLnBheWxvYWQubmFtZSxcbiAgICAgICAgICAgICAgICAgIHBhcmFtczpcbiAgICAgICAgICAgICAgICAgICAgcm91dGVQYXJhbUxpc3RbYWN0aW9uLnBheWxvYWQubmFtZV0gIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAuLi5yb3V0ZVBhcmFtTGlzdFthY3Rpb24ucGF5bG9hZC5uYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLi4uYWN0aW9uLnBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIDogYWN0aW9uLnBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgIGNhc2UgJ1BPUCc6IHtcbiAgICAgICAgICBjb25zdCBpbmRleCA9XG4gICAgICAgICAgICBhY3Rpb24udGFyZ2V0ID09PSBzdGF0ZS5rZXkgJiYgYWN0aW9uLnNvdXJjZVxuICAgICAgICAgICAgICA/IHN0YXRlLnJvdXRlcy5maW5kSW5kZXgociA9PiByLmtleSA9PT0gYWN0aW9uLnNvdXJjZSlcbiAgICAgICAgICAgICAgOiBzdGF0ZS5pbmRleDtcblxuICAgICAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gTWF0aC5tYXgoaW5kZXggLSBhY3Rpb24ucGF5bG9hZC5jb3VudCArIDEsIDEpO1xuICAgICAgICAgICAgY29uc3Qgcm91dGVzID0gc3RhdGUucm91dGVzXG4gICAgICAgICAgICAgIC5zbGljZSgwLCBjb3VudClcbiAgICAgICAgICAgICAgLmNvbmNhdChzdGF0ZS5yb3V0ZXMuc2xpY2UoaW5kZXggKyAxKSk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgICBpbmRleDogcm91dGVzLmxlbmd0aCAtIDEsXG4gICAgICAgICAgICAgIHJvdXRlcyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBjYXNlICdQT1BfVE9fVE9QJzpcbiAgICAgICAgICByZXR1cm4gcm91dGVyLmdldFN0YXRlRm9yQWN0aW9uKFxuICAgICAgICAgICAgc3RhdGUsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6ICdQT1AnLFxuICAgICAgICAgICAgICBwYXlsb2FkOiB7IGNvdW50OiBzdGF0ZS5yb3V0ZXMubGVuZ3RoIC0gMSB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgICApO1xuXG4gICAgICAgIGNhc2UgJ05BVklHQVRFJzpcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBhY3Rpb24ucGF5bG9hZC5rZXkgfHxcbiAgICAgICAgICAgIChhY3Rpb24ucGF5bG9hZC5uYW1lICYmXG4gICAgICAgICAgICAgIHN0YXRlLnJvdXRlTmFtZXMuaW5jbHVkZXMoYWN0aW9uLnBheWxvYWQubmFtZSkpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICAvLyBJZiB0aGUgcm91dGUgYWxyZWFkeSBleGlzdHMsIG5hdmlnYXRlIHRvIHRoYXRcbiAgICAgICAgICAgIGxldCBpbmRleCA9IC0xO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIChzdGF0ZS5yb3V0ZXNbc3RhdGUuaW5kZXhdLm5hbWUgPT09IGFjdGlvbi5wYXlsb2FkLm5hbWUgJiZcbiAgICAgICAgICAgICAgICBhY3Rpb24ucGF5bG9hZC5rZXkgPT09IHVuZGVmaW5lZCkgfHxcbiAgICAgICAgICAgICAgc3RhdGUucm91dGVzW3N0YXRlLmluZGV4XS5rZXkgPT09IGFjdGlvbi5wYXlsb2FkLmtleVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGluZGV4ID0gc3RhdGUuaW5kZXg7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhdGUucm91dGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgKHN0YXRlLnJvdXRlc1tpXS5uYW1lID09PSBhY3Rpb24ucGF5bG9hZC5uYW1lICYmXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLmtleSA9PT0gdW5kZWZpbmVkKSB8fFxuICAgICAgICAgICAgICAgICAgc3RhdGUucm91dGVzW2ldLmtleSA9PT0gYWN0aW9uLnBheWxvYWQua2V5XG4gICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICBpbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBpbmRleCA9PT0gLTEgJiZcbiAgICAgICAgICAgICAgYWN0aW9uLnBheWxvYWQua2V5ICYmXG4gICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLm5hbWUgPT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xICYmIGFjdGlvbi5wYXlsb2FkLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICByZXR1cm4gcm91dGVyLmdldFN0YXRlRm9yQWN0aW9uKFxuICAgICAgICAgICAgICAgIHN0YXRlLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdQVVNIJyxcbiAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgICAgICAgICAga2V5OiBhY3Rpb24ucGF5bG9hZC5rZXksXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGFjdGlvbi5wYXlsb2FkLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogYWN0aW9uLnBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICAgIGluZGV4LFxuICAgICAgICAgICAgICByb3V0ZXM6IFtcbiAgICAgICAgICAgICAgICAuLi5zdGF0ZS5yb3V0ZXMuc2xpY2UoMCwgaW5kZXgpLFxuICAgICAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkLnBhcmFtcyAhPT0gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICAgICAgICAuLi5zdGF0ZS5yb3V0ZXNbaW5kZXhdLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4uc3RhdGUucm91dGVzW2luZGV4XS5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5hY3Rpb24ucGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgOiBzdGF0ZS5yb3V0ZXNbaW5kZXhdLFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICBjYXNlICdHT19CQUNLJzpcbiAgICAgICAgICBpZiAoc3RhdGUuaW5kZXggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcm91dGVyLmdldFN0YXRlRm9yQWN0aW9uKFxuICAgICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1AnLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IHsgY291bnQ6IDEgfSxcbiAgICAgICAgICAgICAgICB0YXJnZXQ6IGFjdGlvbi50YXJnZXQsXG4gICAgICAgICAgICAgICAgc291cmNlOiBhY3Rpb24uc291cmNlLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBudWxsO1xuXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIEJhc2VSb3V0ZXIuZ2V0U3RhdGVGb3JBY3Rpb24oc3RhdGUsIGFjdGlvbik7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGFjdGlvbkNyZWF0b3JzOiBTdGFja0FjdGlvbnMsXG4gIH07XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cbiJdfQ==